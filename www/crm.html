<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRM Dashboard - Costruzione Digitale</title>
  <!-- Caricamento Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.min.js"></script>
  <!-- Axios per le richieste HTTP -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    /* 
     * CSS Completo senza dipendenze esterne
     * Sostituisce Bootstrap e Bootstrap Icons
     */
    
    /* ===== VARIABILI ===== */
    :root {
      --primary-color: #FF6B00;
      --secondary-color: #212121;
      --text-color: #FFFFFF;
      --accent-color: #FF8C38;
      --dark-bg: #151515;
      --light-accent: #333333;
      --success-color: #27ae60;
      --warning-color: #e67e22;
      --danger-color: #e74c3c;
      --info-color: #3498db;
      --border-color: rgba(255, 255, 255, 0.1);
      --font-family: 'Montserrat', sans-serif;
      --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      --box-shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.3);
      --border-radius: 8px;
      --border-radius-lg: 10px;
      --transition: all 0.3s ease;
    }
    
    /* ===== RESET E BASE ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-family);
      touch-action: manipulation;
    }
    
    html {
      font-size: 16px;
      line-height: 1.5;
    }
    
    body {
      line-height: 1.6;
      color: var(--text-color);
      position: relative;
      background-color: var(--secondary-color);
      overflow-x: hidden;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    
    h1, h2, h3, h4, h5, h6 {
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-weight: 500;
      line-height: 1.2;
    }
    
    h1, .h1 { font-size: 2.5rem; }
    h2, .h2 { font-size: 2rem; }
    h3, .h3 { font-size: 1.75rem; }
    h4, .h4 { font-size: 1.5rem; }
    h5, .h5 { font-size: 1.25rem; }
    h6, .h6 { font-size: 1rem; }
    
    p {
      margin-top: 0;
      margin-bottom: 1rem;
    }
    
    a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    a:hover {
      color: var(--accent-color);
      text-decoration: underline;
    }
    
    small {
      font-size: 0.875em;
    }
    
    img {
      max-width: 100%;
      height: auto;
    }
    
    code, pre {
      font-family: monospace;
    }
    
    /* ===== GRID SYSTEM ===== */
    .container-fluid {
      width: 100%;
      padding-right: 15px;
      padding-left: 15px;
      margin-right: auto;
      margin-left: auto;
      position: relative;
      z-index: 1;
    }
    
    .container {
      width: 100%;
      padding-right: 15px;
      padding-left: 15px;
      margin-right: auto;
      margin-left: auto;
    }
    
    .row {
      display: flex;
      flex-wrap: wrap;
    }
    
    .g-0 {
      margin-right: 0;
      margin-left: 0;
    }
    
    .g-0 > div {
      padding-right: 0;
      padding-left: 0;
    }
    
    .col {
      flex-basis: 0;
      flex-grow: 1;
      max-width: 100%;
    }
    
    .col-auto {
      flex: 0 0 auto;
      width: auto;
      max-width: 100%;
    }
    
    .col-1 { flex: 0 0 8.333333%; max-width: 8.333333%; }
    .col-2 { flex: 0 0 16.666667%; max-width: 16.666667%; }
    .col-3 { flex: 0 0 25%; max-width: 25%; }
    .col-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
    .col-5 { flex: 0 0 41.666667%; max-width: 41.666667%; }
    .col-6 { flex: 0 0 50%; max-width: 50%; }
    .col-7 { flex: 0 0 58.333333%; max-width: 58.333333%; }
    .col-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
    .col-9 { flex: 0 0 75%; max-width: 75%; }
    .col-10 { flex: 0 0 83.333333%; max-width: 83.333333%; }
    .col-11 { flex: 0 0 91.666667%; max-width: 91.666667%; }
    .col-12 { flex: 0 0 100%; max-width: 100%; }
    
    [class^="col-"] {
      position: relative;
      width: 100%;
    }
    
    /* ===== MEDIA QUERIES ===== */
    @media (min-width: 576px) {
      .container {
        max-width: 540px;
      }
      
      .col-sm-auto { flex: 0 0 auto; width: auto; max-width: 100%; }
      .col-sm-1 { flex: 0 0 8.333333%; max-width: 8.333333%; }
      .col-sm-2 { flex: 0 0 16.666667%; max-width: 16.666667%; }
      .col-sm-3 { flex: 0 0 25%; max-width: 25%; }
      .col-sm-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
      .col-sm-5 { flex: 0 0 41.666667%; max-width: 41.666667%; }
      .col-sm-6 { flex: 0 0 50%; max-width: 50%; }
      .col-sm-7 { flex: 0 0 58.333333%; max-width: 58.333333%; }
      .col-sm-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
      .col-sm-9 { flex: 0 0 75%; max-width: 75%; }
      .col-sm-10 { flex: 0 0 83.333333%; max-width: 83.333333%; }
      .col-sm-11 { flex: 0 0 91.666667%; max-width: 91.666667%; }
      .col-sm-12 { flex: 0 0 100%; max-width: 100%; }
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 720px;
      }
      
      .col-md-auto { flex: 0 0 auto; width: auto; max-width: 100%; }
      .col-md-1 { flex: 0 0 8.333333%; max-width: 8.333333%; }
      .col-md-2 { flex: 0 0 16.666667%; max-width: 16.666667%; }
      .col-md-3 { flex: 0 0 25%; max-width: 25%; }
      .col-md-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
      .col-md-5 { flex: 0 0 41.666667%; max-width: 41.666667%; }
      .col-md-6 { flex: 0 0 50%; max-width: 50%; }
      .col-md-7 { flex: 0 0 58.333333%; max-width: 58.333333%; }
      .col-md-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
      .col-md-9 { flex: 0 0 75%; max-width: 75%; }
      .col-md-10 { flex: 0 0 83.333333%; max-width: 83.333333%; }
      .col-md-11 { flex: 0 0 91.666667%; max-width: 91.666667%; }
      .col-md-12 { flex: 0 0 100%; max-width: 100%; }
      
      .col-md-9.ms-sm-auto { margin-left: auto; }
      .col-md-9.ms-md-auto { margin-left: auto; }
    }
    
    @media (min-width: 992px) {
      .container {
        max-width: 960px;
      }
      
      .col-lg-auto { flex: 0 0 auto; width: auto; max-width: 100%; }
      .col-lg-1 { flex: 0 0 8.333333%; max-width: 8.333333%; }
      .col-lg-2 { flex: 0 0 16.666667%; max-width: 16.666667%; }
      .col-lg-3 { flex: 0 0 25%; max-width: 25%; }
      .col-lg-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
      .col-lg-5 { flex: 0 0 41.666667%; max-width: 41.666667%; }
      .col-lg-6 { flex: 0 0 50%; max-width: 50%; }
      .col-lg-7 { flex: 0 0 58.333333%; max-width: 58.333333%; }
      .col-lg-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
      .col-lg-9 { flex: 0 0 75%; max-width: 75%; }
      .col-lg-10 { flex: 0 0 83.333333%; max-width: 83.333333%; }
      .col-lg-11 { flex: 0 0 91.666667%; max-width: 91.666667%; }
      .col-lg-12 { flex: 0 0 100%; max-width: 100%; }
      .col-lg-10.ms-auto { margin-left: auto; }
    }
    
    @media (min-width: 1200px) {
      .container {
        max-width: 1140px;
      }
      
      .col-xl-auto { flex: 0 0 auto; width: auto; max-width: 100%; }
      .col-xl-1 { flex: 0 0 8.333333%; max-width: 8.333333%; }
      .col-xl-2 { flex: 0 0 16.666667%; max-width: 16.666667%; }
      .col-xl-3 { flex: 0 0 25%; max-width: 25%; }
      .col-xl-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
      .col-xl-5 { flex: 0 0 41.666667%; max-width: 41.666667%; }
      .col-xl-6 { flex: 0 0 50%; max-width: 50%; }
      .col-xl-7 { flex: 0 0 58.333333%; max-width: 58.333333%; }
      .col-xl-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
      .col-xl-9 { flex: 0 0 75%; max-width: 75%; }
      .col-xl-10 { flex: 0 0 83.333333%; max-width: 83.333333%; }
      .col-xl-11 { flex: 0 0 91.666667%; max-width: 91.666667%; }
      .col-xl-12 { flex: 0 0 100%; max-width: 100%; }
    }
    
    /* ===== UTILITIES ===== */
    /* Display */
    .d-none { display: none !important; }
    .d-inline { display: inline !important; }
    .d-inline-block { display: inline-block !important; }
    .d-block { display: block !important; }
    .d-flex { display: flex !important; }
    .d-inline-flex { display: inline-flex !important; }
    .d-grid { display: grid !important; }
    
    @media (min-width: 576px) {
      .d-sm-none { display: none !important; }
      .d-sm-inline { display: inline !important; }
      .d-sm-inline-block { display: inline-block !important; }
      .d-sm-block { display: block !important; }
      .d-sm-flex { display: flex !important; }
      .d-sm-inline-flex { display: inline-flex !important; }
      .d-sm-grid { display: grid !important; }
    }
    
    @media (min-width: 768px) {
      .d-md-none { display: none !important; }
      .d-md-inline { display: inline !important; }
      .d-md-inline-block { display: inline-block !important; }
      .d-md-block { display: block !important; }
      .d-md-flex { display: flex !important; }
      .d-md-inline-flex { display: inline-flex !important; }
      .d-md-grid { display: grid !important; }
      .d-md-table-cell { display: table-cell !important; }
    }
    
    @media (min-width: 992px) {
      .d-lg-none { display: none !important; }
      .d-lg-inline { display: inline !important; }
      .d-lg-inline-block { display: inline-block !important; }
      .d-lg-block { display: block !important; }
      .d-lg-flex { display: flex !important; }
      .d-lg-inline-flex { display: inline-flex !important; }
      .d-lg-grid { display: grid !important; }
    }
    
    /* Flexbox */
    .flex-row { flex-direction: row !important; }
    .flex-column { flex-direction: column !important; }
    .flex-wrap { flex-wrap: wrap !important; }
    .flex-nowrap { flex-wrap: nowrap !important; }
    .flex-fill { flex: 1 1 auto !important; }
    .flex-grow-0 { flex-grow: 0 !important; }
    .flex-grow-1 { flex-grow: 1 !important; }
    .flex-shrink-0 { flex-shrink: 0 !important; }
    .flex-shrink-1 { flex-shrink: 1 !important; }
    
    .justify-content-start { justify-content: flex-start !important; }
    .justify-content-end { justify-content: flex-end !important; }
    .justify-content-center { justify-content: center !important; }
    .justify-content-between { justify-content: space-between !important; }
    .justify-content-around { justify-content: space-around !important; }
    
    .align-items-start { align-items: flex-start !important; }
    .align-items-end { align-items: flex-end !important; }
    .align-items-center { align-items: center !important; }
    .align-items-baseline { align-items: baseline !important; }
    .align-items-stretch { align-items: stretch !important; }
    
    .align-content-start { align-content: flex-start !important; }
    .align-content-end { align-content: flex-end !important; }
    .align-content-center { align-content: center !important; }
    .align-content-between { align-content: space-between !important; }
    .align-content-around { align-content: space-around !important; }
    .align-content-stretch { align-content: stretch !important; }
    
    .align-self-auto { align-self: auto !important; }
    .align-self-start { align-self: flex-start !important; }
    .align-self-end { align-self: flex-end !important; }
    .align-self-center { align-self: center !important; }
    .align-self-baseline { align-self: baseline !important; }
    .align-self-stretch { align-self: stretch !important; }
    
    @media (min-width: 576px) {
      .flex-sm-row { flex-direction: row !important; }
      .flex-sm-column { flex-direction: column !important; }
      .flex-sm-row-reverse { flex-direction: row-reverse !important; }
      .flex-sm-column-reverse { flex-direction: column-reverse !important; }
      .flex-sm-wrap { flex-wrap: wrap !important; }
      .flex-sm-nowrap { flex-wrap: nowrap !important; }
      .justify-content-sm-start { justify-content: flex-start !important; }
      .justify-content-sm-end { justify-content: flex-end !important; }
      .justify-content-sm-center { justify-content: center !important; }
      .justify-content-sm-between { justify-content: space-between !important; }
      .justify-content-sm-around { justify-content: space-around !important; }
      .align-items-sm-start { align-items: flex-start !important; }
      .align-items-sm-end { align-items: flex-end !important; }
      .align-items-sm-center { align-items: center !important; }
      .align-items-sm-baseline { align-items: baseline !important; }
      .align-items-sm-stretch { align-items: stretch !important; }
    }
    
    @media (min-width: 768px) {
      .flex-md-row { flex-direction: row !important; }
      .flex-md-column { flex-direction: column !important; }
      .flex-md-row-reverse { flex-direction: row-reverse !important; }
      .flex-md-column-reverse { flex-direction: column-reverse !important; }
      .flex-md-wrap { flex-wrap: wrap !important; }
      .flex-md-nowrap { flex-wrap: nowrap !important; }
      .justify-content-md-start { justify-content: flex-start !important; }
      .justify-content-md-end { justify-content: flex-end !important; }
      .justify-content-md-center { justify-content: center !important; }
      .justify-content-md-between { justify-content: space-between !important; }
      .justify-content-md-around { justify-content: space-around !important; }
      .align-items-md-start { align-items: flex-start !important; }
      .align-items-md-end { align-items: flex-end !important; }
      .align-items-md-center { align-items: center !important; }
      .align-items-md-baseline { align-items: baseline !important; }
      .align-items-md-stretch { align-items: stretch !important; }
    }
    
    /* Position */
    .position-static { position: static !important; }
    .position-relative { position: relative !important; }
    .position-absolute { position: absolute !important; }
    .position-fixed { position: fixed !important; }
    .position-sticky { position: sticky !important; }
    
    /* Spacing (Margin & Padding) */
    .m-0 { margin: 0 !important; }
    .mt-0, .my-0 { margin-top: 0 !important; }
    .mr-0, .mx-0 { margin-right: 0 !important; }
    .mb-0, .my-0 { margin-bottom: 0 !important; }
    .ml-0, .mx-0 { margin-left: 0 !important; }
    
    .m-1 { margin: 0.25rem !important; }
    .mt-1, .my-1 { margin-top: 0.25rem !important; }
    .mr-1, .mx-1 { margin-right: 0.25rem !important; }
    .mb-1, .my-1 { margin-bottom: 0.25rem !important; }
    .ml-1, .mx-1 { margin-left: 0.25rem !important; }
    
    .m-2 { margin: 0.5rem !important; }
    .mt-2, .my-2 { margin-top: 0.5rem !important; }
    .mr-2, .mx-2 { margin-right: 0.5rem !important; }
    .mb-2, .my-2 { margin-bottom: 0.5rem !important; }
    .ml-2, .mx-2 { margin-left: 0.5rem !important; }
    
    .m-3 { margin: 1rem !important; }
    .mt-3, .my-3 { margin-top: 1rem !important; }
    .mr-3, .mx-3 { margin-right: 1rem !important; }
    .mb-3, .my-3 { margin-bottom: 1rem !important; }
    .ml-3, .mx-3 { margin-left: 1rem !important; }
    
    .m-4 { margin: 1.5rem !important; }
    .mt-4, .my-4 { margin-top: 1.5rem !important; }
    .mr-4, .mx-4 { margin-right: 1.5rem !important; }
    .mb-4, .my-4 { margin-bottom: 1.5rem !important; }
    .ml-4, .mx-4 { margin-left: 1.5rem !important; }
    
    .m-5 { margin: 3rem !important; }
    .mt-5, .my-5 { margin-top: 3rem !important; }
    .mr-5, .mx-5 { margin-right: 3rem !important; }
    .mb-5, .my-5 { margin-bottom: 3rem !important; }
    .ml-5, .mx-5 { margin-left: 3rem !important; }
    
    .p-0 { padding: 0 !important; }
    .pt-0, .py-0 { padding-top: 0 !important; }
    .pr-0, .px-0 { padding-right: 0 !important; }
    .pb-0, .py-0 { padding-bottom: 0 !important; }
    .pl-0, .px-0 { padding-left: 0 !important; }
    
    .p-1 { padding: 0.25rem !important; }
    .pt-1, .py-1 { padding-top: 0.25rem !important; }
    .pr-1, .px-1 { padding-right: 0.25rem !important; }
    .pb-1, .py-1 { padding-bottom: 0.25rem !important; }
    .pl-1, .px-1 { padding-left: 0.25rem !important; }
    
    .p-2 { padding: 0.5rem !important; }
    .pt-2, .py-2 { padding-top: 0.5rem !important; }
    .pr-2, .px-2 { padding-right: 0.5rem !important; }
    .pb-2, .py-2 { padding-bottom: 0.5rem !important; }
    .pl-2, .px-2 { padding-left: 0.5rem !important; }
    
    .p-3 { padding: 1rem !important; }
    .pt-3, .py-3 { padding-top: 1rem !important; }
    .pr-3, .px-3 { padding-right: 1rem !important; }
    .pb-3, .py-3 { padding-bottom: 1rem !important; }
    .pl-3, .px-3 { padding-left: 1rem !important; }
    
    .p-4 { padding: 1.5rem !important; }
    .pt-4, .py-4 { padding-top: 1.5rem !important; }
    .pr-4, .px-4 { padding-right: 1.5rem !important; }
    .pb-4, .py-4 { padding-bottom: 1.5rem !important; }
    .pl-4, .px-4 { padding-left: 1.5rem !important; }
    
    .p-5 { padding: 3rem !important; }
    .pt-5, .py-5 { padding-top: 3rem !important; }
    .pr-5, .px-5 { padding-right: 3rem !important; }
    .pb-5, .py-5 { padding-bottom: 3rem !important; }
    .pl-5, .px-5 { padding-left: 3rem !important; }
    
    .me-auto, .mx-auto { margin-right: auto !important; }
    .ms-auto, .mx-auto { margin-left: auto !important; }
    .ms-sm-auto { margin-left: auto !important; }
    .mx-auto { margin-left: auto !important; margin-right: auto !important; }
    
    /* Border */
    .border { border: 1px solid var(--border-color) !important; }
    .border-top { border-top: 1px solid var(--border-color) !important; }
    .border-right { border-right: 1px solid var(--border-color) !important; }
    .border-bottom { border-bottom: 1px solid var(--border-color) !important; }
    .border-left { border-left: 1px solid var(--border-color) !important; }
    
    .border-0 { border: 0 !important; }
    .border-top-0 { border-top: 0 !important; }
    .border-right-0 { border-right: 0 !important; }
    .border-bottom-0 { border-bottom: 0 !important; }
    .border-left-0 { border-left: 0 !important; }
    
    .border-primary { border-color: var(--primary-color) !important; }
    .border-secondary { border-color: var(--secondary-color) !important; }
    .border-success { border-color: var(--success-color) !important; }
    .border-warning { border-color: var(--warning-color) !important; }
    .border-danger { border-color: var(--danger-color) !important; }
    .border-info { border-color: var(--info-color) !important; }
    .border-light { border-color: rgba(255, 255, 255, 0.15) !important; }
    .border-dark { border-color: var(--dark-bg) !important; }
    
    /* Text */
    .text-primary { color: var(--primary-color) !important; }
    .text-secondary { color: var(--secondary-color) !important; }
    .text-success { color: var(--success-color) !important; }
    .text-warning { color: var(--warning-color) !important; }
    .text-danger { color: var(--danger-color) !important; }
    .text-info { color: var(--info-color) !important; }
    .text-light { color: var(--text-color) !important; }
    .text-dark { color: var(--dark-bg) !important; }
    .text-muted { color: rgba(255, 255, 255, 0.5) !important; }
    
    .text-left { text-align: left !important; }
    .text-right { text-align: right !important; }
    .text-center { text-align: center !important; }
    .text-justify { text-align: justify !important; }
    
    .font-weight-light { font-weight: 300 !important; }
    .font-weight-normal { font-weight: 400 !important; }
    .font-weight-bold { font-weight: 700 !important; }
    
    /* Background */
    .bg-primary { background-color: var(--primary-color) !important; }
    .bg-secondary { background-color: var(--secondary-color) !important; }
    .bg-success { background-color: var(--success-color) !important; }
    .bg-warning { background-color: var(--warning-color) !important; }
    .bg-danger { background-color: var(--danger-color) !important; }
    .bg-info { background-color: var(--info-color) !important; }
    .bg-light { background-color: var(--light-accent) !important; }
    .bg-dark { background-color: var(--dark-bg) !important; }
    .bg-transparent { background-color: transparent !important; }
    
    /* Rounded corners */
    .rounded { border-radius: var(--border-radius) !important; }
    .rounded-sm { border-radius: calc(var(--border-radius) / 2) !important; }
    .rounded-lg { border-radius: var(--border-radius-lg) !important; }
    .rounded-circle { border-radius: 50% !important; }
    .rounded-pill { border-radius: 50rem !important; }
    .rounded-0 { border-radius: 0 !important; }
    
    /* Gap */
    .gap-1 { gap: 0.25rem !important; }
    .gap-2 { gap: 0.5rem !important; }
    .gap-3 { gap: 1rem !important; }
    .gap-4 { gap: 1.5rem !important; }
    .gap-5 { gap: 3rem !important; }
    
    /* Overflow */
    .overflow-auto { overflow: auto !important; }
    .overflow-hidden { overflow: hidden !important; }
    .overflow-visible { overflow: visible !important; }
    .overflow-scroll { overflow: scroll !important; }
    .overflow-x-auto { overflow-x: auto !important; }
    .overflow-x-hidden { overflow-x: hidden !important; }
    .overflow-y-auto { overflow-y: auto !important; }
    .overflow-y-hidden { overflow-y: hidden !important; }
    
    /* Shadows */
    .shadow { box-shadow: var(--box-shadow) !important; }
    .shadow-sm { box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important; }
    .shadow-lg { box-shadow: var(--box-shadow-lg) !important; }
    .shadow-none { box-shadow: none !important; }
    
    /* Width and Height */
    .w-25 { width: 25% !important; }
    .w-50 { width: 50% !important; }
    .w-75 { width: 75% !important; }
    .w-100 { width: 100% !important; }
    .w-auto { width: auto !important; }
    
    .h-25 { height: 25% !important; }
    .h-50 { height: 50% !important; }
    .h-75 { height: 75% !important; }
    .h-100 { height: 100% !important; }
    .h-auto { height: auto !important; }
    
    .mw-100 { max-width: 100% !important; }
    .mh-100 { max-height: 100% !important; }
    
    /* ===== COMPONENTS ===== */
    /* Pattern di sfondo stile Costruzione */
    .construction-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(45deg, rgba(255, 107, 0, 0.05) 25%, transparent 25%, transparent 50%, rgba(255, 107, 0, 0.05) 50%, rgba(255, 107, 0, 0.05) 75%, transparent 75%, transparent);
      background-size: 100px 100px;
      opacity: 0.3;
      z-index: 0;
      pointer-events: none;
    }
    
    /* Header styling */
    header {
      background-color: var(--dark-bg);
      padding: 0 15px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      transition: var(--transition);
    }
    
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      gap: 50px;
    }
    
    .navbar-dark {
      color: var(--text-color);
    }
    
    .sticky-top {
      position: sticky;
      top: 0;
      z-index: 1020;
    }
    
    .navbar-brand {
      color: var(--text-color);
      display: flex;
      align-items: center;
      padding: 10px 15px;
      font-weight: 700;
      text-decoration: none;
    }
    
    .navbar-brand:hover {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .navbar-toggler {
      color: var(--primary-color);
      font-size: 1.8rem;
      border: none;
      padding: 8px;
      display: none;
      background-color: transparent;
      cursor: pointer;
    }
    
    .form-control-dark {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      max-width: calc(100% - 300px);
      margin-left: 15px;
      margin-right: 20px;
      border-radius: var(--border-radius);
      padding: 8px 15px;
      width: 100%;
    }
    
    .form-control-dark:focus {
      background-color: rgba(255, 255, 255, 0.2);
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(255, 107, 0, 0.25);
      color: var(--text-color);
      outline: none;
    }
    
    /* Sidebar styling */
    .sidebar {
      background-color: var(--dark-bg);
      min-height: 100vh;
      padding-top: 20px;
      transition: var(--transition);
      box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
      position: fixed;
      left: 0;
      top: 56px;
      bottom: 0;
      width: 250px;
      z-index: 99;
      padding-top: 100px;
    }
    
    .sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
    }
    
    .position-sticky {
      position: sticky;
      top: 0;
    }
    
    .nav {
      display: flex;
      flex-wrap: wrap;
      padding-left: 0;
      margin-bottom: 0;
      list-style: none;
    }
    
    .nav-item {
      margin-bottom: 0;
    }
    
    .flex-column {
      flex-direction: column !important;
    }
    
    .nav.flex-column {
      flex-direction: column;
    }
    
    .nav-link {
      color: var(--text-color);
      text-decoration: none;
      transition: color .3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 12px 15px;
      margin: 2px 0;
    }
    
    .sidebar .nav-link {
      display: flex;
      align-items: center;
    }
    
    .sidebar .nav-link:hover {
      background-color: rgba(255, 107, 0, 0.1);
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .sidebar .nav-link.active {
      background-color: rgba(255, 107, 0, 0.2);
      color: var(--primary-color);
      border-left: 3px solid var(--primary-color);
    }
    
    /* Main content */
    main {
      background-color: var(--secondary-color);
      min-height: calc(100vh - 56px);
      transition: var(--transition);
    }
    
    /* Card styling */
    .card {
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 0;
      word-wrap: break-word;
      background-color: var(--light-accent);
      border: none;
      border-radius: var(--border-radius-lg);
      margin-bottom: 20px;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
      overflow: hidden;
    }
    
    .card-header {
      background-color: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 15px 20px;
      font-weight: 600;
      border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    }
    
    .card-header:first-child {
      border-radius: calc(var(--border-radius-lg) - 1px) calc(var(--border-radius-lg) - 1px) 0 0;
    }
    
    .card-body {
      flex: 1 1 auto;
      padding: 20px;
    }
    
    .card-title {
      color: var(--text-color);
      font-weight: 600;
      margin-bottom: 15px;
      margin-top: 0;
    }
    
    .card-text {
      color: var(--text-color);
      margin-bottom: 15px;
    }
    
    /* Button styling */
    .btn {
      display: inline-block;
      font-weight: 400;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      user-select: none;
      border: 1px solid transparent;
      padding: 8px 16px;
      font-size: 1rem;
      line-height: 1.5;
      border-radius: var(--border-radius);
      transition: var(--transition);
      cursor: pointer;
      text-decoration: none;
    }
    
    .btn:focus, .btn:hover {
      text-decoration: none;
    }
    
    .btn:disabled, .btn.disabled {
      opacity: 0.65;
      pointer-events: none;
    }
    
    .btn-group {
      position: relative;
      display: inline-flex;
      vertical-align: middle;
    }
    
    .btn-group > .btn {
      position: relative;
      flex: 1 1 auto;
    }
    
    .btn-group > .btn:not(:first-child) {
      margin-left: -1px;
    }
    
    .btn-group > .btn:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    
    .btn-group > .btn:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: #fff;
    }
    
    .btn-primary:hover, .btn-primary:focus {
      background-color: var(--accent-color);
      border-color: var(--accent-color);
      color: #fff;
    }
    
    .btn-outline-primary {
      color: var(--primary-color);
      border-color: var(--primary-color);
      background-color: transparent;
    }
    
    .btn-outline-primary:hover, .btn-outline-primary:focus {
      background-color: var(--primary-color);
      color: #fff;
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
      color: var(--text-color);
    }
    
    .btn-outline-secondary {
      color: var(--text-color);
      border-color: rgba(255, 255, 255, 0.2);
      background-color: transparent;
    }
    
    .btn-outline-secondary:hover, .btn-outline-secondary:focus {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
    }
    
    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
      color: white;
    }
    
    .btn-outline-success {
      color: var(--success-color);
      border-color: var(--success-color);
      background-color: transparent;
    }
    
    .btn-outline-success:hover, .btn-outline-success:focus {
      background-color: var(--success-color);
      color: white;
    }
    
    .btn-info {
      background-color: var(--info-color);
      border-color: var(--info-color);
      color: white;
    }
    
    .btn-outline-info {
      color: var(--info-color);
      border-color: var(--info-color);
      background-color: transparent;
    }
    
    .btn-outline-info:hover, .btn-outline-info:focus {
      background-color: var(--info-color);
      color: white;
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
      color: white;
    }
    
    .btn-outline-warning {
      color: var(--warning-color);
      border-color: var(--warning-color);
      background-color: transparent;
    }
    
    .btn-outline-warning:hover, .btn-outline-warning:focus {
      background-color: var(--warning-color);
      color: white;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      border-color: var(--danger-color);
      color: white;
    }
    
    .btn-outline-danger {
      color: var(--danger-color);
      border-color: var(--danger-color);
      background-color: transparent;
    }
    
    .btn-outline-danger:hover, .btn-outline-danger:focus {
      background-color: var(--danger-color);
      color: white;
    }
    
    .btn-sm {
      padding: 4px 8px;
      font-size: 0.875rem;
      line-height: 1.5;
      border-radius: calc(var(--border-radius) - 2px);
    }
    
    .btn-lg {
      padding: 8px 16px;
      font-size: 1.25rem;
      line-height: 1.5;
      border-radius: calc(var(--border-radius) + 2px);
    }
    
    .btn-block {
      display: block;
      width: 100%;
    }
    
    .btn-toolbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
    }
    
    .btn-toolbar .btn-group {
      margin-right: 0.5rem;
    }
    
    .btn-close {
      box-sizing: content-box;
      width: 1em;
      height: 1em;
      padding: 0.25em 0.25em;
      color: var(--text-color);
      background: transparent;
      border: 0;
      border-radius: 0.25rem;
      opacity: 0.5;
      cursor: pointer;
    }
    
    .btn-close:hover {
      opacity: 1;
    }
    
    .btn-close-white {
      filter: invert(1) grayscale(100%) brightness(200%);
    }
    
    /* Table styling */
    .table {
      width: 100%;
      margin-bottom: 0;
      color: var(--text-color);
      border-color: rgba(255, 255, 255, 0.1);
      border-collapse: separate;
      border-spacing: 0;
      border-radius: var(--border-radius);
      overflow: hidden;
      font-size: 1,1rem;
      font-weight: 600;
      gap: 10px;
    }
    
    .table th,
    .table td {
      padding: 0.75rem;
      vertical-align: top;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 12px 16px;
      white-space: nowrap;
    }
    
    .table thead th {
      background-color: rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.1);
      font-weight: 600;
      white-space: nowrap;
      vertical-align: bottom;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      color: var(--primary-color);
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 0.5px;
      padding: 12px 15px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .table-responsive {
      display: block;
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-bottom: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      background-color: var(--light-accent);
      padding: 0.5rem;
      position: relative;
      max-width: 100%;
      scroll-behavior: smooth;
    }
    
    .table-hover tbody tr:hover {
      background-color: rgba(255, 107, 0, 0.05);
    }
    
    .table-bordered {
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .table-bordered th,
    .table-bordered td {
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .table td {
      border-color: rgba(255, 255, 255, 0.1);
      vertical-align: middle;
      text-align: center;
    }


    
    /* Badge */
    .badge {
      display: inline-block;
      padding: 6px 10px;
      font-size: 0.875em;
      font-weight: 500;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 4px;
      color: white;
    }
    
    /* Form styling */
    .form-label {
      margin-bottom: 0.5rem;
      color: var(--text-color);
      font-weight: 500;
    }
    
    .form-control, .form-select {
      display: block;
      width: 100%;
      padding: 10px 15px;
      font-size: 1rem;
      line-height: 1.5;
      color: var(--text-color);
      background-color: rgba(0, 0, 0, 0.2);
      background-clip: padding-box;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius);
      transition: var(--transition);
    }
    
    .form-control:focus, .form-select:focus {
      background-color: rgba(0, 0, 0, 0.3);
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(255, 107, 0, 0.25);
      color: var(--text-color);
      outline: 0;
    }
    
    .form-select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 16px 12px;
      padding-right: 2.5rem;
    }
    
    .form-select option {
      background-color: var(--secondary-color);
      color: var(--text-color);
    }
    
    .form-check {
      display: block;
      min-height: 1.5rem;
      padding-left: 1.5em;
      margin-bottom: 0.125rem;
    }
    
    .form-check-input {
      width: 1em;
      height: 1em;
      margin-top: 0.25em;
      margin-left: -1.5em;
      vertical-align: top;
      background-color: rgba(0, 0, 0, 0.2);
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      border: 1px solid rgba(255, 255, 255, 0.3);
      appearance: none;
      border-radius: 0.25em;
      transition: var(--transition);
    }
    
    .form-check-input:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='M6 10l3 3l6-6'/%3e%3c/svg%3e");
    }
    
    .form-check-label {
      color: var(--text-color);
      margin-bottom: 0;
    }
    
    .form-text {
      margin-top: 0.25rem;
      font-size: 0.875em;
    }
    
    .input-group {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      align-items: stretch;
      width: 100%;
    }
    
    .input-group > .form-control {
      position: relative;
      flex: 1 1 auto;
      width: 1%;
      min-width: 0;
    }
    
    .input-group > .btn {
      position: relative;
      z-index: 2;
    }
    
    .input-group > .form-control:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    
    .input-group > .btn:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      margin-left: -1px;
    }
    
    .was-validated .form-control:valid, .form-control.is-valid {
      border-color: var(--success-color);
    }
    
    .was-validated .form-control:invalid, .form-control.is-invalid {
      border-color: var(--danger-color);
    }
    
    .invalid-feedback {
      display: none;
      width: 100%;
      margin-top: 0.25rem;
      font-size: 0.875em;
      color: var(--danger-color);
    }
    
    .valid-feedback {
      display: none;
      width: 100%;
      margin-top: 0.25rem;
      font-size: 0.875em;
      color: var(--success-color);
    }
    
    .was-validated .form-control:invalid ~ .invalid-feedback,
    .form-control.is-invalid ~ .invalid-feedback {
      display: block;
    }
    
    .was-validated .form-control:valid ~ .valid-feedback,
    .form-control.is-valid ~ .valid-feedback {
      display: block;
    }
    
    .needs-validation .form-control:invalid {
      border-color: var(--danger-color);
    }
    
    .needs-validation .form-control:valid {
      border-color: var(--success-color);
    }
    
    /* Stats cards */
    .stats-card {
      position: relative;
      overflow: hidden;
      transition: var(--transition);
      height: 100%;
    }
    
    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--box-shadow-lg);
    }
    
    .border-primary {
      border-left: 4px solid var(--primary-color) !important;
      border-top: none !important;
      border-right: none !important;
      border-bottom: none !important;
    }
    
    .border-success {
      border-left: 4px solid var(--success-color) !important;
      border-top: none !important;
      border-right: none !important;
      border-bottom: none !important;
    }
    
    .border-info {
      border-left: 4px solid var(--info-color) !important;
      border-top: none !important;
      border-right: none !important;
      border-bottom: none !important;
    }
    
    /* Progress bars */
    .progress {
      display: flex;
      height: 10px;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }
    
    .progress-bar {
      display: flex;
      flex-direction: column;
      justify-content: center;
      color: #fff;
      text-align: center;
      background-color: var(--primary-color);
      transition: width 0.6s ease;
    }
    
    .progress-bar.bg-success {
      background-color: var(--success-color);
    }
    
    .progress-bar.bg-info {
      background-color: var(--info-color);
    }
    
    /* Alerts */
    .alert {
      position: relative;
      padding: 1rem 1rem;
      margin-bottom: 1rem;
      border: none;
      border-radius: var(--border-radius);
    }
    
    .alert-info {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--info-color);
    }
    
    .alert-danger {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--danger-color);
    }
    
    .alert-warning {
      background-color: rgba(230, 126, 34, 0.1);
      color: var(--warning-color);
    }
    
    .alert-success {
      background-color: rgba(39, 174, 96, 0.1);
      color: var(--success-color);
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1050;
      width: 100%;
      height: 100%;
      overflow: hidden;
      outline: 0;
      display: none; /* Questo rimarrà none quando il modal è nascosto */
    }
    
    .modal.show {
      display: flex !important;
      justify-content: center;
      align-items: center;
    }
    
    .modal-dialog {
      margin: 0 auto;
    }
    
    .modal-content {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      pointer-events: auto;
      background-color: var(--light-accent);
      background-clip: padding-box;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      outline: 0;
      color: var(--text-color);
      max-height: 90vh; /* Aggiungi questa riga */
      overflow-y: auto; /* Aggiungi questa riga */
    }
    
    .modal-lg {
      max-width: 800px;
    }
    
    .modal-content {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      pointer-events: auto;
      background-color: var(--light-accent);
      background-clip: padding-box;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-lg);
      outline: 0;
      color: var(--text-color);
    }
    
    .modal-header {
      display: flex;
      flex-shrink: 0;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      border-top-left-radius: calc(var(--border-radius-lg) - 1px);
      border-top-right-radius: calc(var(--border-radius-lg) - 1px);
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .modal-body {
      position: relative;
      flex: 1 1 auto;
      padding: 1rem;
    }
    
    .modal-footer {
      display: flex;
      flex-wrap: wrap;
      flex-shrink: 0;
      align-items: center;
      justify-content: flex-end;
      padding: 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background-color: rgba(0, 0, 0, 0.1);
      border-bottom-right-radius: calc(var(--border-radius-lg) - 1px);
      border-bottom-left-radius: calc(var(--border-radius-lg) - 1px);
    }
    
    .modal-footer > * {
      margin: 0.25rem;
    }
    
    .modal-title {
      margin-bottom: 0;
      line-height: 1.5;
    }
    
    .fade {
      transition: opacity 0.15s linear;
    }
    
    .collapse:not(.show) {
      display: none;
    }
    
    .collapsing {
      height: 0;
      overflow: hidden;
      transition: height 0.35s ease;
    }
    
    .fade:not(.show) {
      opacity: 0;
    }
    
    .collapse.show {
      display: block;
    }
    
    /* Navs & Tabs */
    .nav-tabs {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-wrap: wrap;
      padding-left: 0;
      margin-bottom: 0;
      list-style: none;
    }
    
    .nav-tabs .nav-link {
      color: var(--text-color);
      background-color: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      border-radius: 0;
      padding: 10px 15px;
      margin-bottom: -1px;
      text-decoration: none;
    }
    
    .nav-tabs .nav-link:hover {
      border-color: rgba(255, 107, 0, 0.5);
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .nav-tabs .nav-link.active {
      color: var(--primary-color);
      background-color: transparent;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .tab-content > .tab-pane {
      display: none;
    }
    
    .tab-content > .active {
      display: block;
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      padding-left: 0;
      list-style: none;
      border-radius: var(--border-radius);
      margin-top: 20px;
    }
    
    .pagination .page-item {
      margin: 0 2px;
    }
    
    .pagination .page-link {
      position: relative;
      display: block;
      padding: 0.5rem 0.75rem;
      margin-left: -1px;
      line-height: 1.25;
      color: var(--primary-color);
      background-color: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-decoration: none;
      border-radius: var(--border-radius);
    }
    
    .pagination .page-link:hover {
      z-index: 2;
      color: var(--primary-color);
      text-decoration: none;
      background-color: rgba(255, 107, 0, 0.1);
      border-color: rgba(255, 107, 0, 0.2);
    }
    
    .pagination .page-item.active .page-link {
      z-index: 3;
      color: #fff;
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .pagination .page-item.disabled .page-link {
      color: rgba(255, 255, 255, 0.4);
      pointer-events: none;
      cursor: auto;
      background-color: rgba(0, 0, 0, 0.1);
      border-color: rgba(255, 255, 255, 0.05);
    }
    
    .justify-content-center {
      justify-content: center !important;
    }
    
    /* Dropdown */
    .dropdown {
      position: relative;
    }
    
    .dropdown-toggle::after {
      display: inline-block;
      margin-left: 0.255em;
      vertical-align: 0.255em;
      content: "";
      border-top: 0.3em solid;
      border-right: 0.3em solid transparent;
      border-bottom: 0;
      border-left: 0.3em solid transparent;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: 1000;
      display: none;
      min-width: 10rem;
      padding: 0.5rem 0;
      margin: 0.125rem 0 0;
      font-size: 1rem;
      color: var(--text-color);
      text-align: left;
      list-style: none;
      background-color: var(--light-accent);
      background-clip: padding-box;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .dropdown-menu.show {
      display: block;
    }
    
    .dropdown-menu-end {
      right: 0;
      left: auto;
    }
    
    .dropdown-item {
      display: block;
      width: 100%;
      padding: 0.25rem 1.5rem;
      clear: both;
      font-weight: 400;
      color: var(--text-color);
      text-align: inherit;
      white-space: nowrap;
      background-color: transparent;
      border: 0;
      text-decoration: none;
    }
    
    .dropdown-item:hover, .dropdown-item:focus {
      color: var(--primary-color);
      text-decoration: none;
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .dropdown-item.active, .dropdown-item:active {
      color: #fff;
      text-decoration: none;
      background-color: var(--primary-color);
    }
    
    .dropdown-item.disabled, .dropdown-item:disabled {
      color: rgba(255, 255, 255, 0.5);
      pointer-events: none;
      background-color: transparent;
    }
    
    /* Toast notification */
    .toast-container {
      position: fixed;
      bottom: 0;
      right: 0;
      padding: 15px;
      z-index: 1500;
    }
    
    .toast {
      width: 350px;
      max-width: 100%;
      color: var(--text-color);
      background-color: var(--light-accent);
      background-clip: padding-box;
      border: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    .toast.showing {
      opacity: 0;
    }
    
    .toast:not(.showing):not(.show) {
      display: none;
    }
    
    .toast.show {
      display: block;
      opacity: 1;
    }
    
    .toast-header {
      display: flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      color: var(--text-color);
      background-color: rgba(0, 0, 0, 0.2);
      background-clip: padding-box;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .toast-body {
      padding: 0.75rem;
      color: var(--text-color);
    }
    
    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 30px;
    }
    
    .timeline:before {
      content: '';
      position: absolute;
      top: 0;
      left: 15px;
      height: 100%;
      width: 2px;
      background-color: rgba(255, 107, 0, 0.3);
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 20px;
    }
    
    .timeline-badge {
      position: absolute;
      left: -30px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      background-color: var(--primary-color);
      color: #fff;
      z-index: 1;
    }
    
    .timeline-panel {
      padding: 10px 15px;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }
    
    /* Code preview */
    .code-preview {
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      padding: 10px;
      color: #f8f9fa;
      font-family: monospace;
      overflow-x: auto;
      font-size: 0.85rem;
    }
    
    /* Table Variants */
    .table-success {
      background-color: rgba(39, 174, 96, 0.1);
    }
    
    .table-danger {
      background-color: rgba(231, 76, 60, 0.1);
    }
    
    .table-warning {
      background-color: rgba(230, 126, 34, 0.1);
    }
    
    /* Fade-in animation */
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* List Styling */
    .list-unstyled {
      padding-left: 0;
      list-style: none;
    }
    
    dl, ol, ul {
      margin-top: 0;
    }
    
    .dl-horizontal {
      display: flex;
      flex-wrap: wrap;
    }
    
    .dl-horizontal dt {
      width: 30%;
      overflow: hidden;
      clear: left;
      text-align: right;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-weight: 700;
    }
    
    .dl-horizontal dd {
      margin-left: auto;
      width: 70%;
    }
    
    .row, .dl-horizontal {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
    }
    
    dl.row {
      margin-right: -15px;
      margin-left: -15px;
    }
    
    dl.row dt {
      padding-right: 15px;
      padding-left: 15px;
    }
    
    dl.row dd {
      padding-right: 15px;
      padding-left: 15px;
    }
    
    /* Spinner Animation */
    .spinner-border {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      vertical-align: text-bottom;
      border: 0.25em solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spinner-border .75s linear infinite;
    }
    
    .spinner-border-sm {
      width: 1rem;
      height: 1rem;
      border-width: 0.2em;
    }
    
    @keyframes spinner-border {
      to { transform: rotate(360deg); }
    }
    
    /* Bootstrap Icons replacements */
    /* Icone base */
    .bi {
      display: inline-block;
      vertical-align: -0.125em;
      width: 1em;
      height: 1em;
      font-style: normal;
      font-weight: normal;
      line-height: 1;
      text-align: center;
    }
    
    .bi::before {
      display: inline-block;
    }
    
    /* Icona Facebook */
    .bi-facebook::before {
      content: "\f344";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Liste */
    .bi-list::before {
      content: "\f479";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona File Testo */
    .bi-file-text::before {
      content: "\f38e";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Calendario Prenotazione */
    .bi-calendar2-check::before {
      content: "\f273";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Condivisione */
    .bi-share::before {
      content: "\f75e";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Impostazioni */
    .bi-gear::before {
      content: "\f3e3";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Freccia Ricarica */
    .bi-arrow-clockwise::before {
      content: "\f230";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Filtro */
    .bi-funnel::before {
      content: "\f3d0";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Matita */
    .bi-pencil::before {
      content: "\f4c9";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Cronologia */
    .bi-clock-history::before {
      content: "\f294";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Ricerca */
    .bi-search::before {
      content: "\f52a";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Freccia Sinistra */
    .bi-chevron-left::before {
      content: "\f284";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Freccia Destra */
    .bi-chevron-right::before {
      content: "\f285";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Freccia Giù */
    .bi-chevron-down::before {
      content: "\f282";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Occhio */
    .bi-eye::before {
      content: "\f341";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Occhio Barrato */
    .bi-eye-slash::before {
      content: "\f340";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Info Cerchio */
    .bi-info-circle::before {
      content: "\f434";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Spunta Cerchio */
    .bi-check-circle::before {
      content: "\f28a";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona X Cerchio */
    .bi-x-circle::before {
      content: "\f623";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Persona */
    .bi-person::before {
      content: "\f4e1";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Check */
    .bi-check::before {
      content: "\f633";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Orologio */
    .bi-clock::before {
      content: "\f293";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Codice Quadrato */
    .bi-code-square::before {
      content: "\f29d";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Icona Attenzione Triangolo */
    .bi-exclamation-triangle::before, .bi-exclamation-triangle-fill::before {
      content: "\f33c";
      font-family: "bootstrap-icons" !important;
    }
    
    /* Responsive per Mobile */
    @media (max-width: 767.98px) {
      /* Header */
      .navbar-brand {
        font-size: 16px;
        padding: 8px 12px;
      }
      
      /* Sidebar */
      .sidebar {
        width: 50%;
        transform: translateX(100%);
        padding-top: 30px;
        right: 0;
        left: auto;
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .sidebar .nav-link {
        padding: 10px 15px;
        font-size: 14px;
      }
      
      .sidebar .nav-link i {
        font-size: 16px;
      }
      
      /* Main content */
      main {
        margin-left: 0;
        padding: 15px;
      }
      
      /* Typography */
      h1, .h1 {
        font-size: 24px;
      }
      
      h2, .h2 {
        font-size: 1.7rem;
        font-weight: 700;
      }
      
      .card-title {
        font-size: 16px;
      }
      
      .card-text, p {
        font-size: 14px;
      }
      
      /* Cards */
      .card-body {
        padding: 15px;
      }
      
      .form-control {
        display: none;
      }
      
      .form-label {
        font-size: 14px;
      }
      
      /* Tables */
      .table {
        min-width: 650px;
        width: calc(100% + 30px);
      }

      .table-responsive {
        margin-left: -20px;
        margin-right: -10px;
        max-width: fit-content;
        width: calc(100% + 30px);
        padding: 10px;
        background: linear-gradient(to right, var(--light-accent) 30%, rgba(51, 51, 51, 0.9));
        border-radius: 0%;
      }

      .action-buttons {
        display: flex;
        gap: 5px;
      }
      
      /* Buttons */
      .btn {
        font-size: 14px;
        padding: 6px 12px;
      }
      
      /* Dashboard */
      .dashboard-row {
        gap: 15px;
        display: flex;
        flex-wrap: wrap;
        padding: 0px !important;
      }
      
      .navbar-toggler {
        display: flex;
      }
      
      .navbar {
        padding-right: 20px;
      }
    }

    .main {
      padding-right: 20px;
      padding-top: 30px;
      padding-left: 30px;
    }

    @media (max-width: 991.98px) {
      .main {
        padding-right: 10px;
        padding-left: 10px;
      }
    }
    
    /* Very small screens */
    @media (max-width: 575.98px) {
      .sidebar {
        width: 60%;
      }
      
      .action-buttons .btn {
        padding: 4px 8px;
      }
      
      .btn-sm {
        padding: 3px 6px;
        font-size: 12px;
      }
      
      .pagination .page-link {
        padding: 4px 8px;
        font-size: 12px;
      }
    }
    
    /* Bootstrap Icons font (da sostituire con CSS custom) */
    @font-face {
      font-family: "bootstrap-icons";
      src: url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/fonts/bootstrap-icons.woff2") format("woff2"),
           url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/fonts/bootstrap-icons.woff") format("woff");
    }

    .icon {
      color: var(--primary-color);
      width: 24px;
      height: 24px;
      margin-right: 10px;
      display: inline-block;
      vertical-align: -0.125em;
      overflow: visible;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    /* ===== SALES FUNNEL STYLES ===== */
    .funnel-container {
      display: flex;
      flex-direction: column;
      width: calc(100% + 20px);
      overflow-x: auto;
      padding-bottom: 20px;
    }
    
    .funnel-columns {
      display: flex;
      min-height: calc(100vh - 160px);
      width: max-content;
    }
    
    .funnel-column {
      flex: 0 0 250px;
      margin-right: 10px;
      display: flex;
      flex-direction: column;
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    .funnel-stats-column {
      flex: 0 0 280px;
      margin-right: 0;
      display: flex;
      flex-direction: column;
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    .funnel-header {
      padding: 12px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }
    
    .funnel-count {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 50%;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .funnel-body {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      min-height: 200px;
    }
    
    .funnel-card {
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: grab;
      border-left: 3px solid var(--primary-color);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    
    .funnel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .funnel-card-header {
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .funnel-card-body {
      padding: 8px 10px;
    }
    
    .lead-name {
      font-weight: 600;
      font-size: 0.85rem;
    }
    
    .lead-details {
      display: flex;
      flex-direction: column;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .lead-value {
      font-weight: 600;
      font-size: 0.8rem;
      color: var(--primary-color);
      margin: 3px 0;
    }
    
    .lead-service {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
    }
    
    .funnel-empty {
      text-align: center;
      padding: 20px 0;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.8rem;
      font-style: italic;
    }
    
    .funnel-stats-section {
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
    }
    
    .funnel-stats-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      color: var(--primary-color);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 5px;
    }
    
    .funnel-chart-container {
      height: 150px;
      margin-bottom: 8px;
      position: relative;
    }
    
    .funnel-stats-info {
      text-align: center;
    }
    
    .stats-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-color);
    }
    
    .stats-label {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      padding: 4px 0;
      border-bottom: 1px dotted rgba(255, 255, 255, 0.1);
    }
    
    .stats-number {
      font-weight: 600;
    }
    
    /* Stile quando il lead viene trascinato */
    .funnel-card.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    
    /* Evidenzia la colonna durante il dragging */
    .funnel-body.drag-over {
      background-color: rgba(255, 107, 0, 0.1);
      box-shadow: inset 0 0 0 2px var(--primary-color);
    }
    
    /* Responsive per sales funnel */
    @media (max-width: 991.98px) {
      .funnel-columns {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 10px;
      }
      
      .funnel-column, .funnel-stats-column {
        flex: 0 0 220px;
      }
    }
    
    @media (max-width: 767.98px) {
      .funnel-container {
        margin: 0 -10px;
      }
      
      .funnel-column, .funnel-stats-column {
        flex: 0 0 180px;
        margin-right: 8px;
      }
      
      .funnel-header {
        padding: 8px 10px;
      }
      
      .funnel-header h6 {
        font-size: 0.75rem;
      }
      
      .funnel-body {
        padding: 6px;
      }
      
      .lead-name {
        font-size: 0.75rem;
      }
      
      .funnel-card-header, .funnel-card-body {
        padding: 6px 8px;
      }
      
      .funnel-chart-container {
        height: 120px;
      }
    }
    
    .bg-accent {
      background-color: #c97300 !important;
    }

    /* Stile per l'overlay di caricamento */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(33, 33, 33, 0.9);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .loading-logo {
      width: 90px;
      height: 60px;
      animation: logoSpin 0.5s infinite linear;
    }
    
    @keyframes logoSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: var(--primary-color);
      margin-top: 20px;
      font-weight: 600;
    }

    .custom-calendar-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: calc(100vh - 200px);
      min-height: 500px;
      margin-top: 20px;
      color: var(--text-color);
      background-color: transparent;
    }
    
    .custom-calendar-header {
      margin-bottom: 15px;
    }
    
    .calendar-controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.15);
      padding: 10px 15px;
    }
    
    .calendar-nav-buttons, .calendar-view-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .calendar-title {
      font-size: 1.1rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .cal-btn {
      padding: 6px 12px;
      font-size: 0.85rem;
      border-radius: 4px;
      border: none;
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    .cal-btn:hover {
      background-color: rgba(255, 107, 0, 0.15);
    }
    
    .cal-btn-active {
      background-color: var(--primary-color);
      color: white;
    }
    
    .cal-btn-today {
      white-space: nowrap;
    }
    
    .cal-btn-add {
      background-color: var(--primary-color);
      color: white;
    }
    
    .cal-btn-add:hover {
      background-color: var(--accent-color);
    }
    
    /* Layout principale del calendario */
    .custom-calendar-layout {
      display: flex;
      flex: 1;
      overflow: hidden;
      gap: 15px;
      height: 100%;
    }
    
    .custom-calendar-grid {
      flex: 1;
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 400px;
    }
    
    /* Sidebar con eventi del giorno */
    .custom-calendar-sidebar {
      width: 280px;
      display: flex;
      flex-direction: column;
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: 8px;
    }
    
    .sidebar-date {
      padding: 10px 15px;
      background-color: rgba(0, 0, 0, 0.2);
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    
    .sidebar-date h6 {
      margin: 0;
      font-size: 0.95rem;
      font-weight: 600;
    }
    
    .sidebar-events {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    
    .no-events {
      display: flex;
      height: 100%;
      align-items: center;
      justify-content: center;
      opacity: 0.5;
      font-size: 0.85rem;
    }
    
    .event-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .event-item {
      background-color: rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      padding: 10px;
      font-size: 0.85rem;
      cursor: pointer;
      position: relative;
      border-left: 3px solid var(--primary-color);
      transition: all 0.2s ease;
    }
    
    .event-item:hover {
      transform: translateX(3px);
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .event-time {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 4px;
    }
    
    .event-title {
      font-weight: 600;
      margin-bottom: 3px;
      padding-right: 50px; /* Spazio per i pulsanti di azione */
    }
    
    .event-desc {
      font-size: 0.75rem;
      opacity: 0.7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .event-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    
    .event-action-btn {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.2);
      color: var(--text-color);
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s ease;
    }
    
    .event-action-btn:hover {
      opacity: 1;
    }
    
    .edit-btn:hover {
      background-color: var(--info-color);
    }
    
    .delete-btn:hover {
      background-color: var(--danger-color);
    }
    
    /* Stati degli eventi */
    .event-status-confirmed {
      border-left-color: var(--primary-color);
    }
    
    .event-status-pending {
      border-left-color: var(--warning-color);
    }
    
    .event-status-completed {
      border-left-color: var(--success-color);
    }
    
    .event-status-cancelled {
      border-left-color: var(--danger-color);
      opacity: 0.7;
    }
    
    /* Legenda */
    .sidebar-legend {
      padding: 10px 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .sidebar-legend h6 {
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    .legend-items {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.75rem;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    
    .status-confirmed {
      background-color: var(--primary-color);
    }
    
    .status-pending {
      background-color: var(--warning-color);
    }
    
    .status-completed {
      background-color: var(--success-color);
    }
    
    .status-cancelled {
      background-color: var(--danger-color);
    }
    
    /* Timeline mobile */
    .custom-calendar-mobile {
      margin-top: 15px;
      background-color: rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .mobile-day-timeline {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding: 10px;
    }
    
    .timeline-hours {
      display: flex;
      gap: 3px;
      min-width: 100%;
    }
    
    .timeline-hour {
      flex: 0 0 85px;
      min-width: 85px;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      padding: 0 5px;
      scroll-snap-align: start;
    }
    
    .hour-label {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 3px 0;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      margin-bottom: 5px;
    }
    
    .hour-slots {
      min-height: 60px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    
    .empty-slot {
      font-size: 0.7rem;
      text-align: center;
      color: rgba(255, 255, 255, 0.4);
      padding: 5px 0;
    }
    
    .event-pill {
      background-color: var(--primary-color);
      color: white;
      font-size: 0.7rem;
      padding: 3px 5px;
      border-radius: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
    }
    
    .event-pill.event-status-pending {
      background-color: var(--warning-color);
    }
    
    .event-pill.event-status-completed {
      background-color: var(--success-color);
    }
    
    .event-pill.event-status-cancelled {
      background-color: var(--danger-color);
      text-decoration: line-through;
      opacity: 0.7;
    }
    
    /* Layout per viste specifiche del calendario */
    
    /* Vista mensile */
    .calendar-month-view {
      display: grid;
      grid-template-rows: auto 1fr;
      height: 100%;
    }
    
    .month-days-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .month-day-name {
      padding: 8px;
      text-align: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
    }
    
    .month-days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(6, 1fr);
      height: 100%;
    }
    
    .month-day-cell {
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 5px;
      overflow: hidden;
      position: relative;
    }
    
    .day-number {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .day-events {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.7rem;
    }
    
    .day-event {
      background-color: var(--primary-color);
      color: white;
      padding: 2px 5px;
      border-radius: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .other-month {
      opacity: 0.3;
    }
    
    .today-cell {
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .selected-cell {
      background-color: rgba(255, 107, 0, 0.2);
    }
    
    /* Vista giornaliera */
    .calendar-day-view {
      display: grid;
      grid-template-columns: 50px 1fr;
      height: 100%;
      overflow-y: auto;
    }
    
    .day-time-column {
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .day-time-slot {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }
    
    .day-events-column {
      display: flex;
      flex-direction: column;
    }
    
    .day-event-slot {
      height: 60px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }
    
    /* Vista settimanale */
    .calendar-week-view {
      display: grid;
      grid-template-columns: 50px repeat(7, 1fr);
      height: 100%;
      overflow-y: auto;
    }
    
    .week-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .week-day-header {
      padding: 8px 0;
      text-align: center;
      font-size: 0.75rem;
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      cursor: pointer;
    }
    
    .week-day-name {
      font-weight: 600;
    }
    
    .week-day-number {
      opacity: 0.7;
    }
    
    .week-today-header {
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .week-selected-header {
      background-color: rgba(255, 107, 0, 0.2);
    }
    
    .week-time-grid {
      display: grid;
      grid-template-columns: 50px repeat(7, 1fr);
      grid-auto-rows: 60px;
    }
    
    .week-time-label {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .week-time-slot {
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }
    
    /* Vista Lista */
    .calendar-list-view {
      padding: 15px;
      height: 100%;
      overflow-y: auto;
    }
    
    .list-date-header {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 5px 0;
      margin-top: 15px;
      margin-bottom: 5px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .list-date-header:first-child {
      margin-top: 0;
    }
    
    .list-event-item {
      display: flex;
      gap: 10px;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 5px;
      background-color: rgba(0, 0, 0, 0.1);
      transition: background-color 0.2s ease;
    }
    
    .list-event-item:hover {
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .list-event-time {
      width: 80px;
      font-size: 0.75rem;
      opacity: 0.7;
    }
    
    .list-event-details {
      flex: 1;
    }
    
    .list-event-title {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 2px;
    }
    
    .list-event-description {
      font-size: 0.75rem;
      opacity: 0.7;
    }
    
    /* Responsive */
    @media (max-width: 991.98px) {
      .custom-calendar-layout {
        flex-direction: column;
      }
      
      .custom-calendar-sidebar {
        width: 100%;
        max-height: 300px;
      }
      
      .calendar-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .calendar-nav-buttons, .calendar-view-controls {
        width: 100%;
        justify-content: space-between;
      }
      
      .cal-btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .calendar-title {
        width: 100%;
        text-align: center;
        padding: 5px 0;
      }
    }
    
    @media (max-width: 767.98px) {
      .custom-calendar-container {
        height: auto;
        min-height: auto;
      }
      
      .month-days-header {
        font-size: 0.7rem;
      }
      
      .day-number {
        font-size: 0.7rem;
      }
      
      .day-event {
        font-size: 0.65rem;
        padding: 1px 3px;
      }
    }
    
    @media (max-width: 575.98px) {
      .custom-calendar-header {
        margin-bottom: 10px;
      }
      
      .calendar-controls {
        padding: 8px;
      }
      
      .cal-btn {
        padding: 4px 6px;
        font-size: 0.75rem;
      }
      
      .calendar-view-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
      }
      
      .month-day-name {
        padding: 5px 2px;
        font-size: 0.65rem;
      }
      
      .month-day-cell {
        padding: 2px;
      }
      
      .day-events {
        max-height: 40px;
      }
    }

    .custom-appointment-modal {
      background-color: var(--light-accent);
      border: none;
      border-radius: var(--border-radius-lg);
    }
    
    .custom-appointment-modal .modal-header {
      border-bottom-color: rgba(255, 255, 255, 0.1);
      background-color: rgba(0, 0, 0, 0.2);
    }
    
    .custom-appointment-modal .modal-footer {
      border-top-color: rgba(255, 255, 255, 0.1);
      background-color: rgba(0, 0, 0, 0.1);
      justify-content: space-between;
    }
    
    .appointment-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .form-row {
      display: flex;
      gap: 12px;
    }
    
    .form-row.three-columns {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    
    .form-group {
      flex: 1;
    }
    
    .form-label {
      font-size: 0.85rem;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .form-control, .form-select {
      background-color: rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-size: 0.9rem;
    }
    
    .form-control:focus, .form-select:focus {
      background-color: rgba(0, 0, 0, 0.3);
      border-color: var(--primary-color);
      color: var(--text-color);
      box-shadow: 0 0 0 0.2rem rgba(255, 107, 0, 0.25);
    }
    
    .spacer {
      flex-grow: 1;
    }
    
    @media (max-width: 767.98px) {
      .form-row, .form-row.three-columns {
        flex-direction: column;
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>
<body>
  <div id="app">

    <div v-if="showLoading" class="loading-overlay">
      <img src="logosito.webp" class="loading-logo" alt="Caricamento...">
      <div class="loading-text">Caricamento dati in corso...</div>
    </div>

    <!-- Pattern di sfondo stile Costruzione -->
    <div style="color: #151515;"></div>

    <div v-if="sidebarVisible && isMobile" class="sidebar-overlay" @click="closeSidebar"></div>
    
    <!-- Header -->
    <header class="navbar navbar-dark sticky-top" style="flex-wrap: nowrap;">
      <a class="navbar-brand" href="#" @click.prevent="selectTab('dashboard')">
        <img src="logosito.webp" style="height: 30px; width: 45px; margin-right: 10px; display: inline-block; vertical-align: -0.125rem; overflow: visible;"> Costruzione <span style="color: var(--primary-color)">Digitale</span> CRM
      </a>
      <button class="navbar-toggler" @click="toggleSidebar" aria-label="Toggle sidebar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="1em" height="1em" fill="currentColor">
          <path d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"></path>
        </svg>
      </button>
      <input class="form-control form-control-dark w-100" type="text" placeholder="Cerca..." 
             v-model="searchQuery" @input="debounceSearch">
    </header>
  
    <div class="container-fluid p-0">
      <div class="row g-0">
        <!-- Sidebar -->
        <nav id="sidebarMenu" class="sidebar" :class="{ 'show': sidebarVisible }">
          <div class="position-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'dashboard' }" href="#" 
                    @click.prevent="selectTab('dashboard')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor"><path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm320 96c0-26.9-16.5-49.9-40-59.3L280 88c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 204.7c-23.5 9.5-40 32.5-40 59.3c0 35.3 28.7 64 64 64s64-28.7 64-64zM144 176a32 32 0 1 0 0-64 32 32 0 1 0 0 64zm-16 80a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm288 32a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM400 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg> Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'forms' }" href="#" 
                  @click.prevent="selectTab('forms')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor"><path d="M96 96c0-35.3 28.7-64 64-64l288 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L80 480c-44.2 0-80-35.8-80-80L0 128c0-17.7 14.3-32 32-32s32 14.3 32 32l0 272c0 8.8 7.2 16 16 16s16-7.2 16-16L96 96zm64 24l0 80c0 13.3 10.7 24 24 24l112 0c13.3 0 24-10.7 24-24l0-80c0-13.3-10.7-24-24-24L184 96c-13.3 0-24 10.7-24 24zm208-8c0 8.8 7.2 16 16 16l48 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-48 0c-8.8 0-16 7.2-16 16zm0 96c0 8.8 7.2 16 16 16l48 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-48 0c-8.8 0-16 7.2-16 16zM160 304c0 8.8 7.2 16 16 16l256 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-256 0c-8.8 0-16 7.2-16 16zm0 96c0 8.8 7.2 16 16 16l256 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-256 0c-8.8 0-16 7.2-16 16z"/></svg> Form di contatto
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'facebookLeads' }" href="#" 
                    @click.prevent="selectTab('facebookLeads')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor"><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z"/></svg> Lead Facebook
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'bookings' }" href="#" 
                    @click.prevent="selectTab('bookings')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="1em" height="1em" fill="currentColor"><path d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"/></svg> Prenotazioni
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'calendar' }" href="#" 
                   @click.prevent="selectTab('calendar')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="1em" height="1em" fill="currentColor"><path d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm64 80l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0c-8.8 0-16 7.2-16 16zm128 0l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0zM64 400l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0zm112 16l0 32c0 8.8 7.2 16 16 16l32 0c8.8 0 16-7.2 16-16l0-32c0-8.8-7.2-16-16-16l-32 0c-8.8 0-16 7.2-16 16z"/></svg> Calendario
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'events' }" href="#" 
                   @click.prevent="selectTab('events')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="1em" height="1em" fill="currentColor"><path d="M352 224c53 0 96-43 96-96s-43-96-96-96s-96 43-96 96c0 4 .2 8 .7 11.9l-94.1 47C145.4 170.2 121.9 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.9 0 49.4-10.2 66.6-26.9l94.1 47c-.5 3.9-.7 7.8-.7 11.9c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-25.9 0-49.4 10.2-66.6 26.9l-94.1-47c.5-3.9 .7-7.8 .7-11.9s-.2-8-.7-11.9l94.1-47C302.6 213.8 326.1 224 352 224z"/></svg> Eventi Facebook
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'salesFunnel' }" href="#" 
                   @click.prevent="selectTab('salesFunnel')">
                   <svg class="icon" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                    <path d="M296 136l0-48 48 0 0 48-48 0zM288 32c-26.5 0-48 21.5-48 48l0 4L121.6 84C111.2 62.7 89.3 48 64 48C28.7 48 0 76.7 0 112s28.7 64 64 64c25.3 0 47.2-14.7 57.6-36l66.9 0c-58.9 39.6-98.9 105-104 180L80 320c-26.5 0-48 21.5-48 48l0 64c0 26.5 21.5 48 48 48l64 0c26.5 0 48-21.5 48-48l0-64c0-26.5-21.5-48-48-48l-3.3 0c5.9-67 48.5-123.4 107.5-149.1c8.6 12.7 23.2 21.1 39.8 21.1l64 0c16.6 0 31.1-8.4 39.8-21.1c59 25.7 101.6 82.1 107.5 149.1l-3.3 0c-26.5 0-48 21.5-48 48l0 64c0 26.5 21.5 48 48 48l64 0c26.5 0 48-21.5 48-48l0-64c0-26.5-21.5-48-48-48l-4.5 0c-5-75-45.1-140.4-104-180l66.9 0c10.4 21.3 32.3 36 57.6 36c35.3 0 64-28.7 64-64s-28.7-64-64-64c-25.3 0-47.2 14.7-57.6 36L400 84l0-4c0-26.5-21.5-48-48-48l-64 0zM88 376l48 0 0 48-48 0 0-48zm416 48l0-48 48 0 0 48-48 0z"/>
                  </svg> Sales Funnel
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="{ 'active': activeTab === 'settings' }" href="#" 
                   @click.prevent="selectTab('settings')">
                   <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg> Impostazioni
                </a>
              </li>

              <!-- Separatore -->
              <div class="border-top my-4 border-light opacity-25"></div>
              
              <!-- Nuovo tasto Logout -->
              <li class="nav-item">
                <a class="nav-link" href="#" @click.prevent="logout">
                  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor">
                    <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/>
                  </svg> Logout
                </a>
              </li>
            </ul>
          </div>
        </nav>
  
        <!-- Contenuto principale -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main">
          <!-- Dashboard principale -->
          <div v-if="activeTab === 'dashboard'">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">Dashboard</h1>
            </div>
            
            <div class="row dashboard-row" style="padding-right: 40px;">
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card stats-card border-primary fade-in">
                  <div class="card-body">
                    <h5 class="card-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="1em" height="1em" fill="currentColor"><path d="M96 96c0-35.3 28.7-64 64-64l288 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L80 480c-44.2 0-80-35.8-80-80L0 128c0-17.7 14.3-32 32-32s32 14.3 32 32l0 272c0 8.8 7.2 16 16 16s16-7.2 16-16L96 96zm64 24l0 80c0 13.3 10.7 24 24 24l112 0c13.3 0 24-10.7 24-24l0-80c0-13.3-10.7-24-24-24L184 96c-13.3 0-24 10.7-24 24zm208-8c0 8.8 7.2 16 16 16l48 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-48 0c-8.8 0-16 7.2-16 16zm0 96c0 8.8 7.2 16 16 16l48 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-48 0c-8.8 0-16 7.2-16 16zM160 304c0 8.8 7.2 16 16 16l256 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-256 0c-8.8 0-16 7.2-16 16zm0 96c0 8.8 7.2 16 16 16l256 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-256 0c-8.8 0-16 7.2-16 16z"></path></svg>Form di contatto</h5>
                    <p class="card-text">Totale: {{ stats.forms.total }}</p>
                    <div class="progress mb-2">
                      <div class="progress-bar" role="progressbar" 
                           :style="{width: stats.forms.conversionRate + '%'}" 
                           :aria-valuenow="stats.forms.conversionRate" 
                           aria-valuemin="0" aria-valuemax="100">
                        {{ stats.forms.conversionRate }}%
                      </div>
                    </div>
                    <a href="#" class="btn btn-sm btn-outline-primary" @click.prevent="activeTab = 'forms'">
                      Visualizza tutti
                    </a>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card stats-card border-success fade-in">
                  <div class="card-body">
                    <h5 class="card-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="1em" height="1em" fill="var(--success-color)"><path d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"></path></svg>Prenotazioni</h5>
                    <p class="card-text">Totale: {{ stats.bookings.total }}</p>
                    <div class="progress mb-2">
                      <div class="progress-bar bg-success" role="progressbar" 
                           :style="{width: stats.bookings.conversionRate + '%'}" 
                           :aria-valuenow="stats.bookings.conversionRate" 
                           aria-valuemin="0" aria-valuemax="100">
                        {{ stats.bookings.conversionRate }}%
                      </div>
                    </div>
                    <a href="#" class="btn btn-sm btn-outline-success" @click.prevent="activeTab = 'bookings'">
                      Visualizza tutte
                    </a>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 col-sm-6 mb-4">
                <div class="card stats-card border-info fade-in">
                  <div class="card-body">
                    <h5 class="card-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="1em" height="1em" fill="var(--info-color)"><path d="M352 224c53 0 96-43 96-96s-43-96-96-96s-96 43-96 96c0 4 .2 8 .7 11.9l-94.1 47C145.4 170.2 121.9 160 96 160c-53 0-96 43-96 96s43 96 96 96c25.9 0 49.4-10.2 66.6-26.9l94.1 47c-.5 3.9-.7 7.8-.7 11.9c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-25.9 0-49.4 10.2-66.6 26.9l-94.1-47c.5-3.9 .7-7.8 .7-11.9s-.2-8-.7-11.9l94.1-47C302.6 213.8 326.1 224 352 224z"></path></svg>Eventi Facebook</h5>
                    <p class="card-text">Totale inviati: {{ stats.events.total }}</p>
                    <div class="progress mb-2">
                      <div class="progress-bar bg-info" role="progressbar" 
                           :style="{width: stats.events.successRate + '%'}" 
                           :aria-valuenow="stats.events.successRate" 
                           aria-valuemin="0" aria-valuemax="100">
                        {{ stats.events.successRate }}%
                      </div>
                    </div>
                    <a href="#" class="btn btn-sm btn-outline-info" @click.prevent="activeTab = 'events'">
                      Visualizza tutti
                    </a>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mt-3">
              <div class="col-12">
                <div class="card fade-in">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="m-0">Ultimi eventi CRM inviati a Facebook</h5>
                    <button @click="loadRecentEvents()" class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-arrow-clockwise"></i>
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>Data</th>
                            <th>Tipo lead</th>
                            <th>Evento</th>
                            <th>Stato</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr v-for="event in recentEvents || []" :key="event._id"
                              :class="{'table-success': event.success, 'table-danger': !event.success}">
                            <td>{{ formatDate(event.createdAt) }}</td>
                            <td>{{ event.leadType === 'form' ? 'Form contatto' : 'Prenotazione' }}</td>
                            <td>{{ event.eventName }}</td>
                            <td>
                              <span v-if="event.success" class="badge bg-success"><i class="bi bi-check-circle"></i> Inviato</span>
                              <span v-else class="badge bg-danger"><i class="bi bi-x-circle"></i> Errore</span>
                            </td>
                          </tr>
                          <tr v-if="recentEvents.length === 0">
                            <td colspan="4" class="text-center">Nessun evento recente</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Form di contatto -->
          <div v-if="activeTab === 'forms'">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">Form di contatto</h1>
              <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group me-2">
                  <button @click="loadForms()" class="btn btn-sm btn-outline-secondary">
                    <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                      <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
                    </svg> <span class="d-none d-sm-inline">Aggiorna</span>
                </button>
              </div>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                        type="button" id="dropdownMenuFilter" data-bs-toggle="dropdown">
                        <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                          <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/>
                        </svg> <span class="d-none d-sm-inline">Filtra</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuFilter">
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('')">Tutti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('new')">Nuovi</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('contacted')">Contattati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('qualified')">Qualificati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('opportunity')">Opportunità</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('customer')">Clienti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFormsByStatus('lost')">Persi</a></li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Nome</th>
                  <th class="d-none d-md-table-cell">Email</th>
                  <th class="d-none d-sm-table-cell">Telefono</th>
                  <th>Stato</th>
                  <th class="d-none d-md-table-cell">Fonte</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="form in forms || []" :key="form._id">
                  <td>{{ formatDate(form.createdAt) }}</td>
                  <td>{{ form.name }}</td>
                  <td class="d-none d-md-table-cell">{{ form.email }}</td>
                  <td class="d-none d-sm-table-cell">{{ form.phone }}</td>
                  <td>
                    <span class="badge" :class="getStatusBadgeClass(form.status)">
                      {{ getStatusLabel(form.status) }}
                    </span>
                  </td>
                  <td class="d-none d-md-table-cell">{{ form.source }}</td>
                  <td class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary me-1" @click="openLeadModal(form, 'form')">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-info" @click="viewEvents(form._id, 'form')">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon" width="1em" height="1em" fill="var(--info-color)"><path d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128l-368 0zm79-167l80 80c9.4 9.4 24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-39 39L344 184c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 134.1-39-39c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9z"/></svg>
                    </button>
                  </td>
                </tr>
                <tr v-if="forms.length === 0">
                  <td colspan="7" class="text-center">Nessun form trovato</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Paginazione -->
          <nav aria-label="Navigazione pagine">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" :class="{ disabled: formsPagination.page === 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('forms', formsPagination.page - 1)">
                  <i class="bi bi-chevron-left d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Precedente</span>
                </a>
              </li>
              <li v-for="page in getPageNumbers(formsPagination.pages)" 
                  :key="'form-page-' + page" 
                  class="page-item d-none d-sm-block" 
                  :class="{ active: formsPagination.page === page, 'd-block': page === 1 || page === formsPagination.pages || Math.abs(page - formsPagination.page) <= 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('forms', page)">{{ page }}</a>
              </li>
              <li class="page-item" :class="{ disabled: formsPagination.page === formsPagination.pages }">
                <a class="page-link" href="#" @click.prevent="changePage('forms', formsPagination.page + 1)">
                  <i class="bi bi-chevron-right d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Successiva</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        
        <!-- Prenotazioni -->
        <div v-if="activeTab === 'bookings'">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Prenotazioni</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <button @click="loadBookings()" class="btn btn-sm btn-outline-secondary">
                  <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
                  </svg> <span class="d-none d-sm-inline">Aggiorna</span>
                </button>
              </div>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                        type="button" id="dropdownMenuFilterBooking" data-bs-toggle="dropdown">
                        <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                          <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/>
                        </svg> <span class="d-none d-sm-inline">Filtra</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuFilterBooking">
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('')">Tutti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('pending')">In attesa</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('confirmed')">Confermati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('completed')">Completati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('cancelled')">Cancellati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('qualified')">Qualificati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('opportunity')">Opportunità</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('customer')">Clienti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterBookingsByStatus('lost')">Persi</a></li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Nome</th>
                  <th class="d-none d-md-table-cell">Email</th>
                  <th class="d-none d-sm-table-cell">Telefono</th>
                  <th>Ora</th>
                  <th>Stato</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="booking in bookings || []" :key="booking._id">
                  <td>{{ formatDate(booking.bookingTimestamp) }}</td>
                  <td>{{ booking.name }}</td>
                  <td class="d-none d-md-table-cell">{{ booking.email }}</td>
                  <td class="d-none d-sm-table-cell">{{ booking.phone }}</td>
                  <td>{{ booking.bookingTime }}</td>
                  <td>
                    <span class="badge" :class="getStatusBadgeClass(booking.status)">
                      {{ getStatusLabel(booking.status) }}
                    </span>
                  </td>
                  <td class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary me-1" @click="openLeadModal(booking, 'booking')">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon" width="1em" height="1em" fill="currentColor" style="margin-right: 0px;"><path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1 0 32c0 8.8 7.2 16 16 16l32 0zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/></svg>
                    </button>
                    <button class="btn btn-sm btn-outline-info" @click="viewEvents(booking._id, 'booking')">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon" width="1em" height="1em" fill="var(--info-color)" style="margin-right: 0px;"><path d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128l-368 0zm79-167l80 80c9.4 9.4 24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-39 39L344 184c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 134.1-39-39c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9z"/></svg>
                    </button>
                  </td>
                </tr>
                <tr v-if="bookings.length === 0">
                  <td colspan="7" class="text-center">Nessuna prenotazione trovata</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Paginazione -->
          <nav aria-label="Navigazione pagine">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" :class="{ disabled: bookingsPagination.page === 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('bookings', bookingsPagination.page - 1)">
                  <i class="bi bi-chevron-left d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Precedente</span>
                </a>
              </li>
              <li v-for="page in getPageNumbers(bookingsPagination.pages)" 
                  :key="'booking-page-' + page" 
                  class="page-item d-none d-sm-block" 
                  :class="{ active: bookingsPagination.page === page, 'd-block': page === 1 || page === bookingsPagination.pages || Math.abs(page - bookingsPagination.page) <= 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('bookings', page)">{{ page }}</a>
              </li>
              <li class="page-item" :class="{ disabled: bookingsPagination.page === bookingsPagination.pages }">
                <a class="page-link" href="#" @click.prevent="changePage('bookings', bookingsPagination.page + 1)">
                  <i class="bi bi-chevron-right d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Successiva</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        
        <!-- Eventi Facebook -->
        <div v-if="activeTab === 'events'">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Eventi Facebook</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <button @click="loadEvents()" class="btn btn-sm btn-outline-secondary">
                  <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
                  </svg> <span class="d-none d-sm-inline">Aggiorna</span>
                </button>
              </div>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                        type="button" id="dropdownMenuFilterEvents" data-bs-toggle="dropdown">
                        <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                          <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/>
                        </svg> <span class="d-none d-sm-inline">Filtra</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuFilterEvents">
                  <li><a class="dropdown-item" href="#" @click.prevent="filterEventsBySuccess('')">Tutti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterEventsBySuccess('true')">Successo</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterEventsBySuccess('false')">Errore</a></li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Data</th>
                  <th class="d-none d-md-table-cell">Tipo lead</th>
                  <th>Nome evento</th>
                  <th>Stato</th>
                  <th>Dettagli</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="event in events || []" :key="event._id"
                    :class="{'table-success': event.success, 'table-danger': !event.success}">
                  <td>{{ formatDateTime(event.createdAt) }}</td>
                  <td class="d-none d-md-table-cell">{{ event.leadType === 'form' ? 'Form contatto' : 'Prenotazione' }}</td>
                  <td>{{ event.eventName }}</td>
                  <td>
                    <span v-if="event.success" class="badge bg-success">
                      <i class="bi bi-check-circle"></i> <span class="d-none d-sm-inline">Inviato</span>
                    </span>
                    <span v-else class="badge bg-danger">
                      <i class="bi bi-x-circle"></i> <span class="d-none d-sm-inline">Errore</span>
                    </span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-outline-info" @click="openEventDetailsModal(event)">
                      <i class="bi bi-search"></i> <span class="d-none d-sm-inline">Dettagli</span>
                    </button>
                  </td>
                </tr>
                <tr v-if="events.length === 0">
                  <td colspan="5" class="text-center">Nessun evento trovato</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Paginazione -->
          <nav aria-label="Navigazione pagine">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" :class="{ disabled: eventsPagination.page === 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('events', eventsPagination.page - 1)">
                  <i class="bi bi-chevron-left d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Precedente</span>
                </a>
              </li>
              <li v-for="page in getPageNumbers(eventsPagination.pages)" 
                  :key="'event-page-' + page" 
                  class="page-item d-none d-sm-block" 
                  :class="{ active: eventsPagination.page === page, 'd-block': page === 1 || page === eventsPagination.pages || Math.abs(page - eventsPagination.page) <= 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('events', page)">{{ page }}</a>
              </li>
              <li class="page-item" :class="{ disabled: eventsPagination.page === eventsPagination.pages }">
                <a class="page-link" href="#" @click.prevent="changePage('events', eventsPagination.page + 1)">
                  <i class="bi bi-chevron-right d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Successiva</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        
        <!-- Lead Facebook -->
        <div v-if="activeTab === 'facebookLeads'">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Lead Facebook</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <button @click="loadFacebookLeads()" class="btn btn-sm btn-outline-secondary">
                  <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
                  </svg> <span class="d-none d-sm-inline">Aggiorna</span>
                </button>
              </div>
              <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                        type="button" id="dropdownMenuFilterFB" data-bs-toggle="dropdown">
                        <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                          <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/>
                        </svg> <span class="d-none d-sm-inline">Filtra</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuFilterFB">
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('')">Tutti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('new')">Nuovi</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('contacted')">Contattati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('qualified')">Qualificati</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('opportunity')">Opportunità</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('customer')">Clienti</a></li>
                  <li><a class="dropdown-item" href="#" @click.prevent="filterFacebookLeadsByStatus('lost')">Persi</a></li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Nome</th>
                  <th class="d-none d-md-table-cell">Email</th>
                  <th class="d-none d-sm-table-cell">Telefono</th>
                  <th class="d-none d-md-table-cell">Form ID</th>
                  <th>Stato</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="lead in facebookLeads || []" :key="lead._id">
                  <td>{{ formatDate(lead.createdAt) }}</td>
                  <td>{{ lead.name }}</td>
                  <td class="d-none d-md-table-cell">{{ lead.email }}</td>
                  <td class="d-none d-sm-table-cell">{{ lead.phone }}</td>
                  <td class="d-none d-md-table-cell"><small>{{ lead.formId }}</small></td>
                  <td>
                    <span class="badge" :class="getStatusBadgeClass(lead.status)">
                      {{ getStatusLabel(lead.status) }}
                    </span>
                  </td>
                  <td class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary me-1" @click="openLeadModal(lead, 'facebook')">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-info" @click="viewLeadDetails(lead)">
                      <i class="bi bi-search"></i>
                    </button>
                  </td>
                </tr>
                <tr v-if="facebookLeads.length === 0">
                  <td colspan="7" class="text-center">Nessun lead Facebook trovato</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Paginazione -->
          <nav aria-label="Navigazione pagine">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" :class="{ disabled: facebookLeadsPagination.page === 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('facebookLeads', facebookLeadsPagination.page - 1)">
                  <i class="bi bi-chevron-left d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Precedente</span>
                </a>
              </li>
              <li v-for="page in getPageNumbers(facebookLeadsPagination.pages)" 
                  :key="'fb-page-' + page" 
                  class="page-item d-none d-sm-block" 
                  :class="{ active: facebookLeadsPagination.page === page, 'd-block': page === 1 || page === facebookLeadsPagination.pages || Math.abs(page - facebookLeadsPagination.page) <= 1 }">
                <a class="page-link" href="#" @click.prevent="changePage('facebookLeads', page)">{{ page }}</a>
              </li>
              <li class="page-item" :class="{ disabled: facebookLeadsPagination.page === facebookLeadsPagination.pages }">
                <a class="page-link" href="#" @click.prevent="changePage('facebookLeads', facebookLeadsPagination.page + 1)">
                  <i class="bi bi-chevron-right d-block d-sm-none"></i>
                  <span class="d-none d-sm-block">Successiva</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        
        <!-- Impostazioni -->
        <div v-if="activeTab === 'settings'">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Impostazioni</h1>
          </div>
          
          <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
              <div class="card mb-4 fade-in">
                <div class="card-header">
                  <h5>Configurazione Facebook Conversion API</h5>
                </div>
                <div class="card-body">
                  <form @submit.prevent="saveSettings">
                    <div class="mb-3">
                      <label for="facebookAccessToken" class="form-label">Access Token</label>
                      <div class="input-group">
                        <input type="password" class="form-control" id="facebookAccessToken" 
                               v-model="settings.facebookAccessToken" required>
                        <button class="btn btn-outline-primary" type="button" @click="togglePasswordVisibility">
                          <i class="bi" :class="passwordVisible ? 'bi-eye-slash' : 'bi-eye'"></i>
                        </button>
                      </div>
                      <div class="form-text text-light opacity-75">Il token di accesso a Facebook Conversion API</div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="facebookPixelId" class="form-label">Pixel ID</label>
                      <input type="text" class="form-control" id="facebookPixelId" 
                             v-model="settings.facebookPixelId" required>
                      <div class="form-text text-light opacity-75">L'ID del tuo pixel Facebook (es. 1543790469631614)</div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="facebookTestEventCode" class="form-label">Test Event Code</label>
                      <input type="text" class="form-control" id="facebookTestEventCode" 
                             v-model="settings.facebookTestEventCode">
                      <div class="form-text text-light opacity-75">Opzionale: codice di test per l'ambiente di sviluppo</div>
                    </div>
                    
                    <div class="mb-3 form-check">
                      <input type="checkbox" class="form-check-input" id="isDevelopment" 
                             v-model="settings.isDevelopment">
                      <label class="form-check-label" for="isDevelopment">
                        Modalità sviluppo (usa il codice di test)
                      </label>
                    </div>
                    
                    <div class="d-grid gap-2">
                      <button type="submit" class="btn btn-primary" :disabled="isLoading">
                        <span v-if="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
                        Salva impostazioni
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              
              <div class="card fade-in">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="m-0">Configurazione eventi CRM</h5>
                  <button class="btn btn-sm btn-outline-secondary" 
                          type="button" 
                          data-bs-toggle="collapse" 
                          data-bs-target="#eventsInfoCollapse" 
                          aria-expanded="true">
                    <i class="bi bi-chevron-down"></i>
                  </button>
                </div>
                <div class="collapse show" id="eventsInfoCollapse">
                  <div class="card-body">
                    <div class="alert alert-info">
                      <i class="bi bi-info-circle me-2"></i>
                      Gli eventi CRM permettono di informare Facebook sulle fasi più avanzate 
                      del percorso cliente, migliorando l'ottimizzazione delle campagne pubblicitarie.
                    </div>
                    
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Nome evento</th>
                            <th>Descrizione</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><code>QualifiedLead</code></td>
                            <td>Lead qualificato dopo il contatto iniziale</td>
                          </tr>
                          <tr>
                            <td><code>Meeting</code></td>
                            <td>Cliente ha partecipato ad un meeting/chiamata</td>
                          </tr>
                          <tr>
                            <td><code>Opportunity</code></td>
                            <td>Lead trasformato in opportunità commerciale</td>
                          </tr>
                          <tr>
                            <td><code>ProposalSent</code></td>
                            <td>Preventivo/proposta inviata al cliente</td>
                          </tr>
                          <tr>
                            <td><code>Purchase</code></td>
                            <td>Cliente ha acquistato/sottoscritto un servizio</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sales Funnel -->
        <div v-if="activeTab === 'salesFunnel'">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Sales Funnel</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <button @click="loadFunnelData()" class="btn btn-sm btn-outline-secondary">
                  <svg width="10px" height="10px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
                  </svg> <span class="d-none d-sm-inline">Aggiorna</span>
                </button>
              </div>
            </div>
          </div>
          
          <div class="funnel-container">
            <div class="funnel-columns">
              <!-- Nuovo -->
              <div class="funnel-column">
                <div class="funnel-header bg-secondary">
                  <h6 class="m-0">Nuovo</h6>
                  <div class="funnel-count">{{ funnelData.new.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'new')">
                  <div v-for="lead in funnelData.new" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'new')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.new.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Contattato -->
              <div class="funnel-column">
                <div class="funnel-header bg-info">
                  <h6 class="m-0">Contattato</h6>
                  <div class="funnel-count">{{ funnelData.contacted.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'contacted')">
                  <div v-for="lead in funnelData.contacted" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'contacted')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.contacted.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Qualificato -->
              <div class="funnel-column">
                <div class="funnel-header bg-primary">
                  <h6 class="m-0">Qualificato</h6>
                  <div class="funnel-count">{{ funnelData.qualified.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'qualified')">
                  <div v-for="lead in funnelData.qualified" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'qualified')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.qualified.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Opportunità -->
              <div class="funnel-column">
                <div class="funnel-header bg-warning">
                  <h6 class="m-0">Opportunità</h6>
                  <div class="funnel-count">{{ funnelData.opportunity.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'opportunity')">
                  <div v-for="lead in funnelData.opportunity" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'opportunity')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.opportunity.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Preventivo -->
              <div class="funnel-column">
                <div class="funnel-header bg-accent">
                  <h6 class="m-0">Preventivo</h6>
                  <div class="funnel-count">{{ funnelData.proposal.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'proposal')">
                  <div v-for="lead in funnelData.proposal" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'proposal')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.proposal.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Chiuso -->
              <div class="funnel-column">
                <div class="funnel-header bg-success">
                  <h6 class="m-0">Chiuso</h6>
                  <div class="funnel-count">{{ funnelData.customer.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'customer')">
                  <div v-for="lead in funnelData.customer" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'customer')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.customer.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Perso -->
              <div class="funnel-column">
                <div class="funnel-header bg-danger">
                  <h6 class="m-0">Perso</h6>
                  <div class="funnel-count">{{ funnelData.lost.length }}</div>
                </div>
                <div class="funnel-body" @dragover.prevent @drop="onDrop($event, 'lost')">
                  <div v-for="lead in funnelData.lost" :key="lead._id" 
                       class="funnel-card" draggable="true" 
                       @dragstart="onDragStart($event, lead, 'lost')">
                    <div class="funnel-card-header">
                      <span class="lead-name">{{ lead.name }}</span>
                      <button class="btn btn-sm text-white p-0" @click="editLeadValue(lead)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                          <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                        </svg>
                      </button>
                    </div>
                    <div class="funnel-card-body">
                      <div class="lead-details">
                        <small>{{ formatDate(lead.createdAt) }}</small>
                        <div v-if="lead.value" class="lead-value">€{{ formatMoney(lead.value) }}</div>
                        <small class="lead-service">{{ lead.service || 'Non specificato' }}</small>
                      </div>
                    </div>
                  </div>
                  <div v-if="funnelData.lost.length === 0" class="funnel-empty">
                    Nessun lead
                  </div>
                </div>
              </div>
              
              <!-- Statistiche -->
              <div class="funnel-stats-column">
                <div class="funnel-header bg-dark">
                  <h6 class="m-0">Statistiche</h6>
                </div>
                <div class="funnel-body">
                  <div class="funnel-stats-section">
                    <h6 class="funnel-stats-title">Tasso conversione</h6>
                    <div class="funnel-chart-container">
                      <canvas id="conversionChart"></canvas>
                    </div>
                    <div class="funnel-stats-info">
                      <div class="stats-value">{{ funnelStats.conversionRate }}%</div>
                      <div class="stats-label">Tasso medio</div>
                    </div>
                  </div>
                  
                  <div class="funnel-stats-section">
                    <h6 class="funnel-stats-title">Valore totale</h6>
                    <div class="funnel-stats-value">
                      <div class="stats-row">
                        <div class="stats-label">Potenziale:</div>
                        <div class="stats-number">€{{ formatMoney(funnelStats.potentialValue) }}</div>
                      </div>
                      <div class="stats-row">
                        <div class="stats-label">Realizzato:</div>
                        <div class="stats-number">€{{ formatMoney(funnelStats.realizedValue) }}</div>
                      </div>
                      <div class="stats-row">
                        <div class="stats-label">Perso:</div>
                        <div class="stats-number">€{{ formatMoney(funnelStats.lostValue) }}</div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="funnel-stats-section">
                    <h6 class="funnel-stats-title">Servizi più venduti</h6>
                    <div class="funnel-chart-container">
                      <canvas id="servicesChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Sezione Calendario ridisegnata -->
        <div v-if="activeTab === 'calendar'" class="custom-calendar-container">
          <div class="custom-calendar-header">
            <div class="calendar-controls">
              <div class="calendar-nav-buttons">
                <button @click="navigateCalendar('prev')" class="cal-btn cal-btn-nav">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                  </svg>
                </button>
                <button @click="navigateCalendar('today')" class="cal-btn cal-btn-nav cal-btn-today">Oggi</button>
                <button @click="navigateCalendar('next')" class="cal-btn cal-btn-nav">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                  </svg>
                </button>
              </div>
              <div class="calendar-title">{{ formatMonthTitle(selectedDate) }}</div>
              <div class="calendar-view-controls">
                <button @click="changeCalendarView('month')" class="cal-btn cal-btn-view" :class="{'cal-btn-active': calendarView === 'month'}">Mese</button>
                <button @click="changeCalendarView('week')" class="cal-btn cal-btn-view" :class="{'cal-btn-active': calendarView === 'week'}">Settimana</button>
                <button @click="changeCalendarView('day')" class="cal-btn cal-btn-view" :class="{'cal-btn-active': calendarView === 'day'}">Giorno</button>
                <button @click="changeCalendarView('list')" class="cal-btn cal-btn-view" :class="{'cal-btn-active': calendarView === 'list'}">Lista</button>
              </div>
              <button @click="openNewAppointmentModal" class="cal-btn cal-btn-add">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
                <span class="d-none d-sm-inline">Nuovo</span>
              </button>
            </div>
          </div>
        
          <div class="custom-calendar-layout">
            <!-- Griglia Principale del Calendario -->
            <div class="custom-calendar-grid" ref="calendarEl">
              <!-- Il contenuto del calendario verrà popolato dinamicamente -->
              <!-- Placeholder per le viste: Mese, Settimana, Giorno -->
            </div>
        
            <!-- Sidebar con appuntamenti del giorno selezionato -->
            <div class="custom-calendar-sidebar">
              <div class="sidebar-date">
                <h6>{{ formatSelectedDate(selectedDate) }}</h6>
              </div>
              
              <div class="sidebar-events">
                <div v-if="selectedDateEvents.length === 0" class="no-events">
                  <p>Nessun appuntamento in questa data</p>
                </div>
                <div v-else class="event-list">
                  <div v-for="event in selectedDateEvents" :key="event.id" 
                       class="event-item" 
                       :class="'event-status-' + event.status"
                       @click="editAppointment(event)">
                    <div class="event-time">{{ formatEventTime(event) }}</div>
                    <div class="event-title">{{ event.title }}</div>
                    <div v-if="event.description" class="event-desc">{{ event.description }}</div>
                    <div class="event-actions">
                      <button class="event-action-btn edit-btn" @click.stop="editAppointment(event)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                      </button>
                      <button class="event-action-btn delete-btn" @click.stop="deleteAppointment(event)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                          <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="sidebar-legend">
                <h6>Legenda</h6>
                <div class="legend-items">
                  <div class="legend-item">
                    <span class="legend-color status-confirmed"></span>
                    <span class="legend-text">Confermato</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color status-pending"></span>
                    <span class="legend-text">In attesa</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color status-completed"></span>
                    <span class="legend-text">Completato</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color status-cancelled"></span>
                    <span class="legend-text">Cancellato</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Vista Mobile per Orari Giornalieri (Timeline orizzontale) -->
          <div class="custom-calendar-mobile d-block d-lg-none">
            <div class="mobile-day-timeline">
              <div class="timeline-hours">
                <div v-for="hour in dailyHours" :key="hour" class="timeline-hour">
                  <div class="hour-label">{{ hour }}:00</div>
                  <div class="hour-slots">
                    <div v-if="getEventsForHour(hour).length === 0" class="empty-slot">
                      Libero
                    </div>
                    <div v-for="event in getEventsForHour(hour)" 
                        :key="event.id" 
                        :class="['event-pill', 'event-status-' + event.status]"
                        @click="editAppointment(event)">
                      {{ event.title }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODALI -->
  
  <!-- Modale modifica stato lead -->
  <div class="modal fade compact-modal" id="leadModal" tabindex="-1" aria-labelledby="leadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="leadModalLabel">Aggiorna stato lead</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-lg-6 mb-3 mb-lg-0">
              <div class="card">
                <div class="card-body p-3">
                  <h6 class="card-title mb-3"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="1em" height="1em" fill="currentColor"><path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512l388.6 0c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304l-91.4 0z"/></svg>Informazioni lead</h6>
                  <dl class="row mb-0">
                    <dt class="col-sm-4">Nome:</dt>
                    <dd class="col-sm-8">{{ currentLead.name }}</dd>
                    
                    <dt class="col-sm-4">Email:</dt>
                    <dd class="col-sm-8">{{ currentLead.email }}</dd>
                    
                    <dt class="col-sm-4">Telefono:</dt>
                    <dd class="col-sm-8">{{ currentLead.phone }}</dd>
                      
                    <template v-if="currentLeadType === 'booking'">
                      <dt class="col-sm-4">Data prenotazione:</dt>
                      <dd class="col-sm-8">{{ currentLead.bookingDate }} {{ currentLead.bookingTime }}</dd>
                    </template>
                    
                    <dt class="col-sm-4">Fonte:</dt>
                    <dd class="col-sm-8">{{ currentLead.source }}</dd>
                    
                    <dt class="col-sm-4">Stato attuale:</dt>
                    <dd class="col-sm-8">
                      <span class="badge" :class="getStatusBadgeClass(currentLead.status)">
                        {{ getStatusLabel(currentLead.status) }}
                      </span>
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
            
            <div class="col-lg-6">
              <div class="card">
                <div class="card-body p-3">
                  <h6 class="card-title mb-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon" width="1em" height="1em" fill="var(--info-color)"><path d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128l-368 0zm79-167l80 80c9.4 9.4 24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-39 39L344 184c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 134.1-39-39c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9z"/></svg></i>Cronologia eventi</h6>
                  <div class="timeline-wrapper" style="max-height: 200px; overflow-y: auto;">
                    <ul class="timeline list-unstyled">
                      <li v-for="(event, index) in currentLead.crmEvents" :key="index" class="timeline-item">
                        <div class="timeline-badge bg-primary"><i class="bi bi-check"></i></div>
                        <div class="timeline-panel">
                          <div class="timeline-heading">
                            <h6 class="timeline-title">{{ event.eventName }}</h6>
                            <p><small class="text-muted"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="icon" width="1em" height="1em" fill="var(--info-color)"><path d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128l-368 0zm79-167l80 80c9.4 9.4 24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-39 39L344 184c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 134.1-39-39c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9z"/></svg> {{ formatDateTime(event.eventTime) }}</small></p>
                          </div>
                          <div class="timeline-body">
                            <p>Inviato a Facebook: 
                              <span v-if="event.sentToFacebook" class="badge bg-success">Sì</span>
                              <span v-else class="badge bg-danger">No</span>
                            </p>
                          </div>
                        </div>
                      </li>
                      <li v-if="!currentLead.crmEvents || currentLead.crmEvents.length === 0" class="text-center">
                        <p>Nessun evento registrato</p>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <hr class="border-secondary">
          
          <form @submit.prevent="updateLeadStatus" class="needs-validation" novalidate>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="newStatus" class="form-label">Nuovo stato</label>
                <select class="form-select" id="newStatus" v-model="newStatus" required>
                  <option value="" disabled>Seleziona nuovo stato</option>
                  <!-- Opzioni per Form -->
                  <template v-if="currentLeadType === 'form'">
                    <option value="new">Nuovo</option>
                    <option value="contacted">Contattato</option>
                    <option value="qualified">Qualificato</option>
                    <option value="opportunity">Opportunità</option>
                    <option value="customer">Cliente</option>
                    <option value="lost">Perso</option>
                  </template>
                  <!-- Opzioni per Prenotazioni -->
                  <template v-else>
                    <option value="pending">In attesa</option>
                    <option value="confirmed">Confermato</option>
                    <option value="completed">Completato</option>
                    <option value="cancelled">Cancellato</option>
                    <option value="qualified">Qualificato</option>
                    <option value="opportunity">Opportunità</option>
                    <option value="customer">Cliente</option>
                    <option value="lost">Perso</option>
                  </template>
                </select>
                <div class="invalid-feedback">
                  Seleziona un nuovo stato
                </div>
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="eventName" class="form-label">Evento Facebook</label>
                <select class="form-select" id="eventName" v-model="eventName" required>
                  <option value="" disabled>Seleziona evento</option>
                  <option value="QualifiedLead">Lead Qualificato</option>
                  <option value="Meeting">Meeting/Chiamata</option>
                  <option value="Opportunity">Opportunità</option>
                  <option value="ProposalSent">Preventivo Inviato</option>
                  <option value="Purchase">Acquisto</option>
                  <option value="Lost">Lead Perso</option>
                </select>
                <div class="invalid-feedback">
                  Seleziona un evento
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="eventNote" class="form-label">Note (opzionale)</label>
              <textarea class="form-control" id="eventNote" v-model="eventNote" rows="3"></textarea>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="hasFbclid" v-model="hasFbclid">
              <label class="form-check-label" for="hasFbclid">
                Il lead ha un fbclid associato
              </label>
            </div>

            <div class="mb-3" v-if="eventName === 'Purchase'">
              <label for="purchaseValue" class="form-label">Valore dell'acquisto</label>
              <div class="input-group">
                <input type="number" class="form-control" id="purchaseValue" v-model="purchaseValue" placeholder="0.00" step="0.01">
                <span class="input-group-text">€</span>
              </div>
            </div>
            
            <div class="mb-3" v-if="hasFbclid">
              <label for="fbclid" class="form-label">Facebook Click ID (fbclid)</label>
              <input type="text" class="form-control" id="fbclid" v-model="fbclid" 
                     placeholder="Es. fbclid_123456789">
              <div class="form-text text-light opacity-75">Identificativo del click proveniente da Facebook</div>
            </div>
            
            <div class="alert alert-info">
              <i class="bi bi-info-circle me-2"></i>
              Questo aggiornerà lo stato del lead e invierà l'evento selezionato alla Conversion API di Facebook.
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annulla</button>
          <button type="button" class="btn btn-primary" @click="updateLeadStatus" :disabled="isUpdating">
            <span v-if="isUpdating" class="spinner-border spinner-border-sm me-2" role="status"></span>
            Aggiorna e invia evento
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Nuovo design per il modale appuntamenti -->
  <div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content custom-appointment-modal">
        <div class="modal-header">
          <h5 class="modal-title" id="appointmentModalLabel">
            <span v-if="editingAppointment">Modifica Appuntamento</span>
            <span v-else>Nuovo Appuntamento</span>
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
        </div>
        <div class="modal-body">
          <form @submit.prevent="saveAppointment" class="appointment-form">
            <div class="form-group">
              <label for="appointmentTitle" class="form-label">Titolo</label>
              <input type="text" class="form-control" id="appointmentTitle" v-model="currentAppointment.title" required>
            </div>
            
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="appointmentDate" class="form-label">Data</label>
                <input type="date" class="form-control" id="appointmentDate" v-model="currentAppointment.date" required>
              </div>
              <div class="form-group col-md-6">
                <label for="appointmentTime" class="form-label">Ora</label>
                <input type="time" class="form-control" id="appointmentTime" v-model="currentAppointment.time" required>
              </div>
            </div>
            
            <div class="form-row three-columns">
              <div class="form-group">
                <label for="appointmentDuration" class="form-label">Durata</label>
                <select class="form-select" id="appointmentDuration" v-model="currentAppointment.duration">
                  <option value="30">30 minuti</option>
                  <option value="60">1 ora</option>
                  <option value="90">1 ora e 30 min</option>
                  <option value="120">2 ore</option>
                  <option value="180">3 ore</option>
                  <option value="240">4 ore</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="appointmentStatus" class="form-label">Stato</label>
                <select class="form-select" id="appointmentStatus" v-model="currentAppointment.status">
                  <option value="pending">In attesa</option>
                  <option value="confirmed">Confermato</option>
                  <option value="completed">Completato</option>
                  <option value="cancelled">Cancellato</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="appointmentLocation" class="form-label">Luogo</label>
                <select class="form-select" id="appointmentLocation" v-model="currentAppointment.location">
                  <option value="">Seleziona</option>
                  <option value="office">Ufficio</option>
                  <option value="client">Cliente</option>
                  <option value="remote">Remoto</option>
                  <option value="site">Cantiere</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="appointmentClient" class="form-label">Cliente</label>
              <select class="form-select" id="appointmentClient" v-model="currentAppointment.clientId">
                <option value="">Seleziona un cliente</option>
                <option v-for="client in clients" :key="client._id" :value="client._id">
                  {{ client.name }}
                </option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="appointmentDescription" class="form-label">Note</label>
              <textarea class="form-control" id="appointmentDescription" rows="3" v-model="currentAppointment.description"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button v-if="editingAppointment" type="button" class="btn btn-outline-danger" @click="deleteAppointment(currentAppointment)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
            </svg>
            <span class="ms-1">Elimina</span>
          </button>
          <div class="spacer"></div>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annulla</button>
          <button type="button" class="btn btn-primary" @click="saveAppointment" :disabled="isSavingAppointment">
            <span v-if="isSavingAppointment" class="spinner-border spinner-border-sm me-2" role="status"></span>
            <span v-if="editingAppointment">Aggiorna</span>
            <span v-else>Salva</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modale dettagli evento -->
  <div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventDetailsModalLabel">Dettagli evento Facebook</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-3" id="eventDetailsTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="info-tab" data-bs-toggle="tab" 
                      data-bs-target="#info-tab-pane" type="button" role="tab" 
                      aria-controls="info-tab-pane" aria-selected="true">
                <i class="bi bi-info-circle me-1"></i> Info
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="data-tab" data-bs-toggle="tab" 
                      data-bs-target="#data-tab-pane" type="button" role="tab" 
                      aria-controls="data-tab-pane" aria-selected="false">
                <i class="bi bi-code-square me-1"></i> Dati
              </button>
            </li>
            <li class="nav-item" role="presentation" v-if="!currentEvent.success">
              <button class="nav-link" id="error-tab" data-bs-toggle="tab" 
                      data-bs-target="#error-tab-pane" type="button" role="tab" 
                      aria-controls="error-tab-pane" aria-selected="false">
                <i class="bi bi-exclamation-triangle me-1"></i> Errore
              </button>
            </li>
          </ul>
          
          <div class="tab-content" id="eventDetailsTabsContent">
            <!-- Tab Informazioni -->
            <div class="tab-pane fade show active" id="info-tab-pane" role="tabpanel" 
                 aria-labelledby="info-tab" tabindex="0">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-6">
                          <dl class="row">
                            <dt class="col-sm-4">Nome evento:</dt>
                            <dd class="col-sm-8">{{ currentEvent.eventName }}</dd>
                            
                            <dt class="col-sm-4">Data invio:</dt>
                            <dd class="col-sm-8">{{ formatDateTime(currentEvent.createdAt) }}</dd>
                            
                            <dt class="col-sm-4">Tipo lead:</dt>
                            <dd class="col-sm-8">{{ currentEvent.leadType === 'form' ? 'Form contatto' : 'Prenotazione' }}</dd>
                          </dl>
                        </div>
                        <div class="col-md-6">
                          <dl class="row">
                            <dt class="col-sm-4">Stato:</dt>
                            <dd class="col-sm-8">
                              <span v-if="currentEvent.success" class="badge bg-success">
                                <i class="bi bi-check-circle"></i> Inviato con successo
                              </span>
                              <span v-else class="badge bg-danger">
                                <i class="bi bi-x-circle"></i> Errore
                              </span>
                            </dd>
                            
                            <dt class="col-sm-4">Event ID:</dt>
                            <dd class="col-sm-8"><code>{{ currentEvent.eventId || 'N/A' }}</code></dd>
                          </dl>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Tab Dati -->
            <div class="tab-pane fade" id="data-tab-pane" role="tabpanel" 
                 aria-labelledby="data-tab" tabindex="0">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <h6><i class="bi bi-person me-2"></i>Dati utente</h6>
                  <div class="card">
                    <div class="card-body">
                      <pre class="mb-0 code-preview">{{ prettyPrintJson(currentEvent.userData) }}</pre>
                    </div>
                  </div>
                </div>
                
                <div class="col-md-6 mb-3">
                  <h6><i class="bi bi-gear me-2"></i>Dati personalizzati</h6>
                  <div class="card">
                    <div class="card-body">
                      <pre class="mb-0 code-preview">{{ prettyPrintJson(currentEvent.customData) }}</pre>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Tab Errore -->
            <div class="tab-pane fade" id="error-tab-pane" role="tabpanel" 
                 aria-labelledby="error-tab" tabindex="0" v-if="!currentEvent.success">
              <div class="alert alert-danger">
                <h6><i class="bi bi-exclamation-triangle-fill me-2"></i> Dettagli errore</h6>
                <p>{{ currentEvent.error }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Chiudi</button>
          <button v-if="!currentEvent.success" type="button" class="btn btn-primary" @click="retryEvent" :disabled="isRetrying">
            <span v-if="isRetrying" class="spinner-border spinner-border-sm me-2" role="status"></span>
            Riprova invio
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast per notifiche -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header" :class="toastClass">
        <i :class="toastIconClass"></i>
        <strong class="me-auto">{{ toastTitle }}</strong>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Chiudi"></button>
      </div>
      <div class="toast-body">
        {{ toastMessage }}
      </div>
    </div>
  </div>
</div>

<!-- Modale modifica valore lead -->
<div class="modal fade" id="leadValueModal" tabindex="-1" aria-labelledby="leadValueModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="leadValueModalLabel">Modifica dati lead</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
      </div>
      <div class="modal-body">
        <form @submit.prevent="saveLeadValue">
          <div v-if="currentFunnelLead" class="mb-3">
            <p class="mb-1"><strong>{{ currentFunnelLead.name }}</strong></p>
            <p class="text-muted mb-3" style="font-size: 0.8rem;">{{ currentFunnelLead.email }}</p>
            
            <div class="mb-3">
              <label for="leadValue" class="form-label">Valore stimato (€)</label>
              <input type="number" class="form-control" id="leadValue" v-model="newLeadValue" min="0" step="100" placeholder="0">
              <div class="form-text text-light opacity-75">Valore stimato del progetto</div>
            </div>
            
            <div class="mb-3">
              <label for="leadService" class="form-label">Tipo di servizio</label>
              <select class="form-select" id="leadService" v-model="newLeadService">
                <option value="">Seleziona un servizio</option>
                <option v-for="service in leadServiceOptions" :key="service" :value="service">
                  {{ service }}
                </option>
              </select>
              <div class="form-text text-light opacity-75">Categoria di lavoro richiesto</div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annulla</button>
        <button type="button" class="btn btn-primary" @click="saveLeadValue" :disabled="isLoading">
          <span v-if="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          Salva
        </button>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript principale -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Inizializzazione Vue.js
  const { createApp, ref, computed, onMounted, watch } = Vue;
  
  const app = createApp({
    setup() {

      const purchaseValue = ref('');

      const calendarView = ref('day'); // Viste possibili: 'month', 'week', 'day', 'list'

      const sidebarVisible = ref(false);
      const isMobile = ref(window.innerWidth < 768);

      const toggleSidebar = () => {
        sidebarVisible.value = !sidebarVisible.value;
        document.body.style.overflow = sidebarVisible.value && isMobile.value ? 'hidden' : '';
      };

      const closeSidebar = () => {
        sidebarVisible.value = false;
        document.body.style.overflow = '';
      };

      const handleResize = () => {
        isMobile.value = window.innerWidth < 768;
        if (!isMobile.value) {
          closeSidebar();
        }
      };

      // Stato dell'applicazione
      const activeTab = ref('dashboard');
      const windowSize = ref({
        innerWidth: window.innerWidth,
        innerHeight: window.innerHeight
      });
      const searchQuery = ref('');
      const isLoading = ref(false);
      const isUpdating = ref(false);
      const isRetrying = ref(false);
      const passwordVisible = ref(false);

      const logout = async () => {
        try {
          await axios.get('/api/logout');
          // Reindirizza alla pagina di login
          window.location.href = '/';
        } catch (error) {
          console.error('Errore durante il logout:', error);
          // In caso di errore, forza comunque il redirect
          window.location.href = '/';
        }
      };
      
      // Dati per form
      const forms = ref([]);
      const formsPagination = ref({
        total: 0,
        page: 1,
        limit: 10,
        pages: 0
      });
      const formsFilter = ref('');
      
      // Dati per prenotazioni
      const bookings = ref([]);
      const bookingsPagination = ref({
        total: 0,
        page: 1,
        limit: 10,
        pages: 0
      });
      const bookingsFilter = ref('');

      let isScrollLock = false;

      const facebookLeads = ref([]);
      const facebookLeadsPagination = ref({
        total: 0,
        page: 1,
        limit: 10,
        pages: 0
      });
      const facebookLeadsFilter = ref('');
      
      // Dati per eventi
      const events = ref([]);
      const eventsPagination = ref({
        total: 0,
        page: 1,
        limit: 50,
        pages: 0
      });
      const eventsFilter = ref('');
      const recentEvents = ref([]);
      
      // Statistiche
      const stats = ref({
        forms: {
          total: 0,
          converted: 0,
          conversionRate: 0
        },
        bookings: {
          total: 0,
          converted: 0,
          conversionRate: 0
        },
        events: {
          total: 0,
          success: 0,
          successRate: 0
        }
      });
      
      // Dati per modali
      const currentLead = ref({});
      const currentLeadType = ref('');
      const newStatus = ref('');
      const eventName = ref('');
      const eventNote = ref('');
      const hasFbclid = ref(false);
      const fbclid = ref('');
      
      const currentEvent = ref({});
      
      // Impostazioni
      const settings = ref({
        facebookAccessToken: '',
        facebookPixelId: '',
        facebookTestEventCode: '',
        isDevelopment: false
      });
      
      // Toast per notifiche
      const toastTitle = ref('');
      const toastMessage = ref('');
      const toastClass = ref('');
      const toastIconClass = ref('');

      const selectTab = (tab) => {
          activeTab.value = tab;
          // Chiudi la sidebar su mobile indipendentemente dalle dimensioni dello schermo
          sidebarVisible.value = false;
          
          // Solo su mobile, ripristina il normale overflow del body
          if (windowSize.value.innerWidth < 768) {
            document.body.style.overflow = '';
          }
        };
      
      // Funzioni helper
      const formatDate = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('it-IT');
      };
      
      const formatDateTime = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleString('it-IT');
      };
      
      const getStatusBadgeClass = (status) => {
        switch (status) {
          case 'new': return 'bg-secondary';
          case 'contacted': return 'bg-info';
          case 'qualified': return 'bg-primary';
          case 'opportunity': return 'bg-warning';
          case 'customer': return 'bg-success';
          case 'lost': return 'bg-danger';
          case 'pending': return 'bg-secondary';
          case 'confirmed': return 'bg-primary';
          case 'completed': return 'bg-success';
          case 'cancelled': return 'bg-danger';
          default: return 'bg-secondary';
        }
      };
      
      const getStatusLabel = (status) => {
        switch (status) {
          case 'new': return 'Nuovo';
          case 'contacted': return 'Contattato';
          case 'qualified': return 'Qualificato';
          case 'opportunity': return 'Opportunità';
          case 'customer': return 'Cliente';
          case 'lost': return 'Perso';
          case 'pending': return 'In attesa';
          case 'confirmed': return 'Confermato';
          case 'completed': return 'Completato';
          case 'cancelled': return 'Cancellato';
          default: return status;
        }
      };
      
      const getPageNumbers = (total) => {
        if (total <= 5) {
          return Array.from({ length: total }, (_, i) => i + 1);
        }
        
        // Mostra sempre le prime 2, le ultime 2 e quelle intorno alla pagina corrente
        const current = formsPagination.value.page;
        let pages = [1, 2, total - 1, total];
        
        if (current > 2 && current < total - 1) {
          pages.push(current - 1, current, current + 1);
        } else if (current === 2) {
          pages.push(current, current + 1);
        } else if (current === total - 1) {
          pages.push(current - 1, current);
        }
        
        return [...new Set(pages)].sort((a, b) => a - b);
      };
      
      const prettyPrintJson = (obj) => {
        if (!obj) return 'Nessun dato';
        try {
          return JSON.stringify(obj, null, 2);
        } catch (e) {
          return 'Errore nella formattazione JSON';
        }
      };
      
      // Funzioni per le API
      const loadForms = async () => {
        try {
          isLoading.value = true;
          const response = await axios.get(
            `https://api.costruzionedigitale.com/api/leads/forms?page=${formsPagination.value.page}&limit=${formsPagination.value.limit}${formsFilter.value ? `&status=${formsFilter.value}` : ''}${searchQuery.value ? `&search=${searchQuery.value}` : ''}`,
            { withCredentials: true } // Esta es la línea clave que debes agregar
          );
          
          forms.value = response.data.data || [];
          formsPagination.value = response.data.pagination || { total: 0, page: 1, limit: 10, pages: 0 };
          
          // Aggiorna statistiche
          updateStats();
        } catch (error) {
          showToast('Errore', `Impossibile caricare i form: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          console.error('Errore caricamento form:', error);
          
          // Initialize with empty arrays instead of mock data
          forms.value = [];
          formsPagination.value = { total: 0, page: 1, limit: 10, pages: 0 };
          updateStats();
        } finally {
          isLoading.value = false;
        }
      };
      
      const loadBookings = async () => {
        try {
          isLoading.value = true;
          const response = await axios.get(
            `https://api.costruzionedigitale.com/api/leads/bookings?page=${bookingsPagination.value.page}&limit=${bookingsPagination.value.limit}${bookingsFilter.value ? `&status=${bookingsFilter.value}` : ''}${searchQuery.value ? `&search=${searchQuery.value}` : ''}`,
            { withCredentials: true }
          );
          
          bookings.value = response.data.data || [];
          bookingsPagination.value = response.data.pagination || { total: 0, page: 1, limit: 10, pages: 0 };
          
          // Aggiorna statistiche
          updateStats();
        } catch (error) {
          showToast('Errore', `Impossibile caricare le prenotazioni: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          console.error('Errore caricamento prenotazioni:', error);
          
          // Initialize with empty arrays
          bookings.value = [];
          bookingsPagination.value = { total: 0, page: 1, limit: 10, pages: 0 };
          updateStats();
        } finally {
          isLoading.value = false;
        }
      };

      // Implementazioni template per le diverse viste del calendario
      // Queste funzioni creano la struttura HTML con Vue.js
      
      // Template per la vista mensile con composizione strutturata
      const monthViewTemplate = `
      <div class="calendar-month-view">
        <!-- Intestazione giorni settimana -->
        <div class="month-days-header">
          <div v-for="day in ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab']" 
               class="month-day-name">{{ day }}</div>
        </div>
        
        <!-- Griglia giorni -->
        <div class="month-days-grid">
          <div v-for="(cell, index) in monthCells" 
               :key="index" 
               class="month-day-cell"
               :class="{ 
                 'other-month': !cell.isCurrentMonth, 
                 'today-cell': cell.isToday,
                 'selected-cell': cell.isSelected 
               }"
               :data-date="cell.date"
               @click="selectDate(cell.dateObj)">
            
            <!-- Numero del giorno -->
            <div class="day-number">{{ cell.dayNumber }}</div>
            
            <!-- Eventi del giorno (limitati a 3) -->
            <div class="day-events">
              <div v-for="(event, eventIndex) in cell.events.slice(0, 3)" 
                   :key="'event-' + event.id"
                   class="day-event"
                   :class="'event-status-' + event.status"
                   @click.stop="editAppointment(event)">
                {{ event.title }}
              </div>
              
              <!-- Indicatore "più eventi" -->
              <div v-if="cell.events.length > 3" class="day-more-events">
                +{{ cell.events.length - 3 }}
              </div>
            </div>
          </div>
        </div>
      </div>
      `;

      // Template per la vista settimanale con composizione strutturata (continua)
      const weekViewTemplate = `
      <div class="calendar-week-view">
        <!-- Intestazione con giorni -->
        <div class="week-header">
          <!-- Cella angolo vuota -->
          <div class="week-corner-cell"></div>
          
          <!-- Intestazioni giorni -->
          <div v-for="day in weekDays" 
               :key="day.date"
               class="week-day-header"
               :class="{ 
                 'week-today-header': day.isToday,
                 'week-selected-header': day.isSelected 
               }"
               :data-date="day.date"
               @click="selectDateAndView(day.dateObj, 'day')">
            <div class="week-day-name">{{ day.name }}</div>
            <div class="week-day-number">{{ day.number }}</div>
          </div>
        </div>
        
        <!-- Griglia oraria -->
        <div class="week-time-grid">
          <!-- Colonna orari -->
          <template v-for="hour in dailyHours">
            <!-- Etichetta ora -->
            <div class="week-time-label">{{ hour }}:00</div>
            
            <!-- Slot per ogni giorno della settimana -->
            <template v-for="day in weekDays">
              <div class="week-time-slot"
                   :data-hour="hour"
                   :data-date="day.date"
                   @dragover.prevent
                   @drop="handleEventDrop($event, day.dateObj, hour)">
                
                <!-- Eventi che iniziano in questo slot -->
                <div v-for="event in getEventsForDayAndHour(day.dateObj, hour)"
                     class="week-time-event"
                     :class="'event-status-' + event.status"
                     :style="{
                       position: 'absolute',
                       top: '2px',
                       left: '2px', 
                       right: '2px',
                       height: calculateEventHeight(event),
                       backgroundColor: getEventColor(event.status),
                       zIndex: 10
                     }"
                     draggable="true"
                     @dragstart="handleEventDragStart($event, event)"
                     @click="editAppointment(event)">
                  <div class="event-time">{{ formatTime(new Date(event.start)) }}</div>
                  <div class="event-title">{{ event.title }}</div>
                </div>
              </div>
            </template>
          </template>
        </div>
      </div>
      `;
      
      // Template per la vista giornaliera con composizione strutturata
      const dayViewTemplate = `
      <div class="calendar-day-view">
        <!-- Colonna orari -->
        <div class="day-time-column">
          <div v-for="hour in dailyHours" 
               :key="hour"
               class="day-time-slot">
            {{ hour }}:00
          </div>
        </div>
        
        <!-- Colonna eventi -->
        <div class="day-events-column">
          <div v-for="hour in dailyHours"
               :key="hour"
               class="day-event-slot"
               :data-hour="hour"
               :data-date="formatDateForAttribute(selectedDate)"
               @dragover.prevent
               @drop="handleEventDrop($event, selectedDate, hour)">
            
            <!-- Eventi che iniziano in questo slot -->
            <div v-for="event in getEventsForHour(hour)"
                 :key="event.id"
                 class="day-slot-event"
                 :class="'event-status-' + event.status"
                 :style="{
                   position: 'absolute',
                   top: '0',
                   left: '0', 
                   right: '0',
                   height: calculateEventHeight(event),
                   backgroundColor: getEventColor(event.status),
                   zIndex: 10
                 }"
                 :data-event-id="event.id"
                 draggable="true"
                 @dragstart="handleEventDragStart($event, event)"
                 @click="editAppointment(event)">
              <div class="event-time">{{ formatEventTime(event) }}</div>
              <div class="event-title">{{ event.title }}</div>
              <div v-if="event.description" class="event-description">{{ event.description }}</div>
              <div class="event-resize-handle"></div>
            </div>
          </div>
        </div>
      </div>
      `;
      
      // Template per la vista lista con composizione strutturata
      const listViewTemplate = `
      <div class="calendar-list-view">
        <!-- Messaggio se non ci sono eventi -->
        <div v-if="groupedEvents.length === 0" class="list-empty-message">
          Nessun appuntamento programmato
        </div>
        
        <!-- Eventi raggruppati per data -->
        <template v-for="(group, index) in groupedEvents" :key="index">
          <!-- Intestazione data -->
          <div class="list-date-header">
            {{ formatDateHeader(group.date) }}
          </div>
          
          <!-- Eventi del giorno -->
          <div v-for="event in group.events"
               :key="event.id"
               class="list-event-item"
               :class="'event-status-' + event.status"
               @click="editAppointment(event)">
            <div class="list-event-time">{{ formatEventTime(event) }}</div>
            <div class="list-event-details">
              <div class="list-event-title">{{ event.title }}</div>
              <div v-if="event.description" class="list-event-description">{{ event.description }}</div>
            </div>
          </div>
        </template>
      </div>
      `;
      
      // Funzioni di supporto e calcolo per i template
      
      // Calcolo delle celle per la vista mensile
      const calculateMonthCells = () => {
        const year = selectedDate.value.getFullYear();
        const month = selectedDate.value.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        const firstDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();
        const totalDays = 42; // 6 righe di 7 giorni
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const cells = [];
        
        for (let i = 0; i < totalDays; i++) {
          const dayOffset = i - firstDayOfWeek;
          const dayDate = new Date(year, month, dayOffset + 1);
          const isCurrentMonth = dayDate.getMonth() === month;
          
          // Formatta la data per l'attributo data-date
          const dateStr = dayDate.toISOString().split('T')[0];
          
          // Ottieni eventi per questo giorno
          const dayEvents = calendarEvents.value.filter(event => {
            const eventDate = new Date(event.start);
            return eventDate.toISOString().split('T')[0] === dateStr;
          });
          
          cells.push({
            dayNumber: dayDate.getDate(),
            isCurrentMonth,
            isToday: dayDate.toDateString() === today.toDateString(),
            isSelected: dayDate.toDateString() === selectedDate.value.toDateString(),
            date: dateStr,
            dateObj: new Date(dayDate),
            events: dayEvents
          });
        }
        
        return cells;
      };

      // Funzione per formattare l'ora
      const formatTime = (date) => {
        return date.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
      };

      
      // Calcolo dei giorni per la vista settimanale
      const calculateWeekDays = () => {
        const firstDayOfWeek = new Date(selectedDate.value);
        const day = selectedDate.value.getDay();
        firstDayOfWeek.setDate(firstDayOfWeek.getDate() - day);
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const days = [];
        
        for (let i = 0; i < 7; i++) {
          const dayDate = new Date(firstDayOfWeek);
          dayDate.setDate(dayDate.getDate() + i);
          
          days.push({
            name: dayDate.toLocaleDateString('it-IT', { weekday: 'short' }),
            number: dayDate.getDate(),
            isToday: dayDate.toDateString() === today.toDateString(),
            isSelected: dayDate.toDateString() === selectedDate.value.toDateString(),
            date: dayDate.toISOString().split('T')[0],
            dateObj: new Date(dayDate)
          });
        }
        
        return days;
      };
      
      // Raggruppa eventi per data per la vista lista
      const groupEventsByDate = () => {
        // Ordina gli eventi per data
        const sortedEvents = [...calendarEvents.value].sort((a, b) => 
          new Date(a.start) - new Date(b.start)
        );
        
        // Raggruppa per data
        const eventsByDate = {};
        sortedEvents.forEach(event => {
          const date = new Date(event.start);
          const dateKey = date.toISOString().split('T')[0];
          
          if (!eventsByDate[dateKey]) {
            eventsByDate[dateKey] = {
              date: new Date(date),
              events: []
            };
          }
          
          eventsByDate[dateKey].events.push(event);
        });
        
        // Converte in array e ordina per data
        return Object.values(eventsByDate).sort((a, b) => a.date - b.date);
      };
      
      // Ottieni eventi per giorno e ora specifici
      const getEventsForDayAndHour = (date, hour) => {
        const dateStr = date.toISOString().split('T')[0];
        
        const startTime = new Date(date);
        startTime.setHours(hour, 0, 0, 0);
        
        const endTime = new Date(date);
        endTime.setHours(hour, 59, 59, 999);
        
        return calendarEvents.value.filter(event => {
          const eventStart = new Date(event.start);
          const eventDate = eventStart.toISOString().split('T')[0];
          
          if (eventDate !== dateStr) return false;
          
          const eventEnd = new Date(event.end);
          
          // Evento che inizia in quest'ora o copre quest'ora
          return (eventStart >= startTime && eventStart <= endTime) || 
                 (eventEnd >= startTime && eventEnd <= endTime) ||
                 (eventStart <= startTime && eventEnd >= endTime);
        });
      };
      
      // Calcola altezza dell'evento in base alla durata
      const calculateEventHeight = (event) => {
        const start = new Date(event.start);
        const end = new Date(event.end);
        
        // Calcola durata in minuti
        const durationMinutes = (end - start) / (1000 * 60);
        
        // Ogni ora è alta 60px, quindi 1 minuto = 1px
        return `${durationMinutes}px`;
      };
      
      // Formatta data per intestazione nella vista lista
      const formatDateHeader = (date) => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        if (date.toDateString() === today.toDateString()) {
          return 'Oggi';
        } else if (date.toDateString() === tomorrow.toDateString()) {
          return 'Domani';
        } else {
          return date.toLocaleDateString('it-IT', { 
            weekday: 'long', 
            day: 'numeric', 
            month: 'long' 
          });
        }
      };
      
      // Formatta data per attributo data-date
      const formatDateForAttribute = (date) => {
        return date.toISOString().split('T')[0];
      };
      
      // Seleziona data e cambia vista
      const selectDateAndView = (date, view) => {
        selectedDate.value = date;
        updateSelectedDateEvents();
        changeCalendarView(view);
      };
      
      // Funzioni computate da aggiungere al componente Vue
      const monthCells = computed(() => calculateMonthCells());
      const weekDays = computed(() => calculateWeekDays());
      const groupedEvents = computed(() => groupEventsByDate());
      
      const loadEvents = async () => {
        try {
          isLoading.value = true;
          const response = await axios.get(
            `https://api.costruzionedigitale.com/api/events?page=${eventsPagination.value.page}&limit=${eventsPagination.value.limit}${eventsFilter.value ? `&success=${eventsFilter.value}` : ''}${searchQuery.value ? `&search=${searchQuery.value}` : ''}`,
            { withCredentials: true }
          );
          
          events.value = response.data.data || [];
          eventsPagination.value = response.data.pagination || { total: 0, page: 1, limit: 50, pages: 0 };
          
          // Aggiorna statistiche
          updateStats();
        } catch (error) {
          showToast('Errore', `Impossibile caricare gli eventi: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          console.error('Errore caricamento eventi:', error);
          
          // Initialize with empty arrays
          events.value = [];
          eventsPagination.value = { total: 0, page: 1, limit: 50, pages: 0 };
          updateStats();
        } finally {
          isLoading.value = false;
        }
      };
      
      const loadRecentEvents = async () => {
        try {
          const response = await axios.get(
            'https://api.costruzionedigitale.com/api/events?limit=5',
            { withCredentials: true }
          );
          recentEvents.value = response.data.data || [];
        } catch (error) {
          console.error('Errore caricamento eventi recenti:', error);
          recentEvents.value = [];
        }
      };
      
      const updateStats = async () => {
        try {
          // Statistiche form
          stats.value.forms.total = formsPagination.value?.total || 0;
          stats.value.forms.converted = (forms.value || []).filter(f => f.status === 'customer').length;
          stats.value.forms.conversionRate = stats.value.forms.total > 0 
            ? Math.round((stats.value.forms.converted / stats.value.forms.total) * 100) 
            : 0;
          
          // Statistiche prenotazioni
          stats.value.bookings.total = bookingsPagination.value?.total || 0;
          stats.value.bookings.converted = (bookings.value || []).filter(b => b.status === 'customer' || b.status === 'completed').length;
          stats.value.bookings.conversionRate = stats.value.bookings.total > 0 
            ? Math.round((stats.value.bookings.converted / stats.value.bookings.total) * 100) 
            : 0;
          
          // Statistiche eventi
          stats.value.events.total = eventsPagination.value?.total || 0;
          stats.value.events.success = (events.value || []).filter(e => e.success).length;
          stats.value.events.successRate = stats.value.events.total > 0 
            ? Math.round((stats.value.events.success / stats.value.events.total) * 100) 
            : 0;
        } catch (error) {
          console.error('Errore aggiornamento statistiche:', error);
        }
      };
      
      const loadSettings = async () => {
        try {
          // In una implementazione reale, questo dovrebbe caricare le impostazioni dal server
          // Per ora usiamo localStorage come esempio
          const savedSettings = localStorage.getItem('crmSettings');
          if (savedSettings) {
            settings.value = JSON.parse(savedSettings);
          }
        } catch (error) {
          console.error('Errore caricamento impostazioni:', error);
        }
      };
      
      const saveSettings = async () => {
        try {
          isLoading.value = true;
          
          // In una implementazione reale, questo invierebbe le impostazioni al server
          // Per ora usiamo localStorage come esempio
          localStorage.setItem('crmSettings', JSON.stringify(settings.value));
          
          showToast('Successo', 'Impostazioni salvate con successo', 'bg-success', 'bi bi-check-circle-fill me-2');
        } catch (error) {
          showToast('Errore', `Impossibile salvare le impostazioni: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          console.error('Errore salvataggio impostazioni:', error);
        } finally {
          isLoading.value = false;
        }
      };
      
      // Funzioni per i filtri
      const filterFormsByStatus = (status) => {
        formsFilter.value = status;
        formsPagination.value.page = 1;
        loadForms();
      };
      
      const filterBookingsByStatus = (status) => {
        bookingsFilter.value = status;
        bookingsPagination.value.page = 1;
        loadBookings();
      };
      
      const filterEventsBySuccess = (success) => {
        eventsFilter.value = success;
        eventsPagination.value.page = 1;
        loadEvents();
      };
      
      const changePage = (type, page) => {
        if (type === 'forms') {
          formsPagination.value.page = page;
          loadForms();
        } else if (type === 'bookings') {
          bookingsPagination.value.page = page;
          loadBookings();
        } else if (type === 'events') {
          eventsPagination.value.page = page;
          loadEvents();
        }
      };
      
      // Gestione dei modali
      const openLeadModal = (lead, type) => {
        currentLead.value = JSON.parse(JSON.stringify(lead)); // Deep copy
        currentLeadType.value = type;
        newStatus.value = lead.status;
        eventName.value = '';
        eventNote.value = '';
        hasFbclid.value = !!lead.fbclid;
        fbclid.value = lead.fbclid || '';
        
        // Apri modale
        const modal = new bootstrap.Modal(document.getElementById('leadModal'));
        modal.show();
      };
      
      const updateLeadStatus = async () => {
        try {
          if (!newStatus.value || !eventName.value) {
            showToast('Attenzione', 'Seleziona un nuovo stato e un evento', 'bg-warning', 'bi bi-exclamation-triangle-fill me-2');
            return;
          }
          
          isUpdating.value = true;
          
          // Prepara i dati per l'aggiornamento
          const payload = {
            newStatus: newStatus.value,
            eventName: eventName.value,
            eventMetadata: {
              note: eventNote.value
            }
          };

          // Dopo aver creato il payload di base
          if (eventName === 'Purchase') {
            // Validazione: verifica che sia stato inserito un valore
            if (!purchaseValue || isNaN(parseFloat(purchaseValue))) {
              showToast('Attenzione', 'Per gli eventi di acquisto è necessario specificare un valore', 'bg-warning', 'bi bi-exclamation-triangle-fill me-2');
              return;
            }
            
            // Aggiungi il valore al payload
            payload.eventMetadata = {
              ...payload.eventMetadata,
              note: eventNote,
              value: parseFloat(purchaseValue),
              currency: 'EUR',
              content_type: 'product',
              content_name: 'Servizio di consulenza'
            };
          }
          
          // Se è stato specificato un fbclid, aggiungilo
          if (hasFbclid.value && fbclid.value) {
            payload.fbclid = fbclid.value;
          }
          
          // Effettua la richiesta in base al tipo di lead
          let endpoint;
          if (currentLeadType.value === 'form') {
            endpoint = `https://api.costruzionedigitale.com/api/leads/forms/${currentLead.value._id}/update`;
          } else if (currentLeadType.value === 'booking') {
            endpoint = `https://api.costruzionedigitale.com/api/leads/bookings/${currentLead.value._id}/update`;
          } else if (currentLeadType.value === 'facebook') {
            endpoint = `https://api.costruzionedigitale.com/api/leads/facebook/${currentLead.value._id}/update`;
          }         
          
          const response = await axios.post(endpoint, payload, { withCredentials: true });
          
          // Chiudi il modale
          const modal = bootstrap.Modal.getInstance(document.getElementById('leadModal'));
          modal.hide();
          
          // Mostra notifica di successo
          if (response.data.facebookResult && response.data.facebookResult.success) {
            showToast('Successo', `Stato aggiornato e evento "${eventName.value}" inviato a Facebook`, 'bg-success', 'bi bi-check-circle-fill me-2');
          } else {
            const errorMsg = response.data.facebookResult ? response.data.facebookResult.error : 'Errore sconosciuto';
            showToast('Avviso', `Stato aggiornato ma invio a Facebook fallito: ${errorMsg}`, 'bg-warning', 'bi bi-exclamation-triangle-fill me-2');
          }
          
          // Ricarica i dati
          if (currentLeadType.value === 'form') {
            loadForms();
          } else {
            loadBookings();
          }
          loadRecentEvents();
          
        } catch (error) {
          showToast('Errore', `Impossibile aggiornare il lead: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          console.error('Errore aggiornamento lead:', error);
        } finally {
          isUpdating.value = false;
        }
      };

      const viewEvents = (leadId, type) => {
          // Nella versione completa, qui si vedrebbero solo gli eventi per il lead specifico
          activeTab.value = 'events';
          
          // Filtra gli eventi per questo lead
          // Implementazione: loadEvents(leadId, type);
        };
        
        const openEventDetailsModal = (event) => {
          currentEvent.value = JSON.parse(JSON.stringify(event)); // Deep copy
          
          // Apri modale
          const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
          modal.show();
        };
        
        const retryEvent = async () => {
          try {
            isRetrying.value = true;
            
            // In una implementazione reale, questa funzione invierebbe nuovamente l'evento a Facebook
            setTimeout(() => {
              showToast('Successo', 'Evento re-inviato con successo', 'bg-success', 'bi bi-check-circle-fill me-2');
              
              // Chiudi il modale
              const modal = bootstrap.Modal.getInstance(document.getElementById('eventDetailsModal'));
              modal.hide();
              
              // Ricarica gli eventi
              loadEvents();
              loadRecentEvents();
            }, 1500);
            
          } catch (error) {
            showToast('Errore', `Impossibile re-inviare l'evento: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
            console.error('Errore re-invio evento:', error);
          } finally {
            isRetrying.value = false;
          }
        };

        const loadFacebookLeads = async () => {
          try {
            isLoading.value = true;
            const response = await axios.get(
              `https://api.costruzionedigitale.com/api/leads/facebook?page=${facebookLeadsPagination.value.page}&limit=${facebookLeadsPagination.value.limit}${facebookLeadsFilter.value ? `&status=${facebookLeadsFilter.value}` : ''}${searchQuery.value ? `&search=${searchQuery.value}` : ''}`,
              { withCredentials: true }
            );
            
            facebookLeads.value = response.data.data || [];
            facebookLeadsPagination.value = response.data.pagination || { total: 0, page: 1, limit: 10, pages: 0 };
            
            // Aggiorna statistiche
            updateStats();
          } catch (error) {
            showToast('Errore', `Impossibile caricare i lead Facebook: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
            console.error('Errore caricamento lead Facebook:', error);
            
            // Initialize with empty arrays
            facebookLeads.value = [];
            facebookLeadsPagination.value = { total: 0, page: 1, limit: 10, pages: 0 };
          } finally {
            isLoading.value = false;
          }
        };
        
        const filterFacebookLeadsByStatus = (status) => {
          facebookLeadsFilter.value = status;
          facebookLeadsPagination.value.page = 1;
          loadFacebookLeads();
        };

        // Dati Sales Funnel
        const funnelData = ref({
          new: [],
          contacted: [],
          qualified: [],
          opportunity: [],
          proposal: [],
          customer: [],
          lost: []
        });
        
        const funnelStats = ref({
          totalLeads: 0,
          conversionRate: 0,
          potentialValue: 0,
          realizedValue: 0,
          lostValue: 0,
          serviceDistribution: {}
        });
        
        // Modale per modifica valore lead
        const currentFunnelLead = ref(null);
        const editLeadModal = ref(null);
        const newLeadValue = ref('');
        const leadServiceOptions = ref([
          'Ristrutturazione completa',
          'Ristrutturazione bagno',
          'Ristrutturazione cucina',
          'Rifacimento tetto',
          'Impianto elettrico',
          'Impianto idraulico',
          'Cappotto termico',
          'Infissi e serramenti',
          'Rifacimento pavimenti',
          'Ampliamento casa'
        ]);
        const newLeadService = ref('');
        
        // Charts instances
        let conversionChart = null;
        let servicesChart = null;
        
        // Funzione per formato denaro
        const formatMoney = (value) => {
          if (!value) return '0';
          return parseFloat(value).toLocaleString('it-IT', {
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
          });
        };
        
        // Carica dati funnel
        const showLoading = ref(false);

        // Modifica la funzione loadFunnelData così
        const loadFunnelData = async () => {
          try {
            showLoading.value = true;
            isLoading.value = true;
            
            // Categoria "Nuovo"
            const newLeads = [
              ...(forms.value || []).filter(form => form.status === 'new'),
              ...(bookings.value || []).filter(booking => booking.status === 'new' || booking.status === 'pending'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'new')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Contattato"
            const contactedLeads = [
              ...(forms.value || []).filter(form => form.status === 'contacted'),
              ...(bookings.value || []).filter(booking => booking.status === 'contacted'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'contacted')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Qualificato"
            const qualifiedLeads = [
              ...(forms.value || []).filter(form => form.status === 'qualified'),
              ...(bookings.value || []).filter(booking => booking.status === 'qualified'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'qualified')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Opportunità"
            const opportunityLeads = [
              ...(forms.value || []).filter(form => form.status === 'opportunity'),
              ...(bookings.value || []).filter(booking => booking.status === 'opportunity'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'opportunity')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Preventivo"
            const proposalLeads = [
              ...(forms.value || []).filter(form => form.status === 'proposal'),
              ...(bookings.value || []).filter(booking => booking.status === 'proposal'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'proposal')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Cliente"
            const customerLeads = [
              ...(forms.value || []).filter(form => form.status === 'customer'),
              ...(bookings.value || []).filter(booking => booking.status === 'customer' || booking.status === 'completed'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'customer')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Categoria "Perso"
            const lostLeads = [
              ...(forms.value || []).filter(form => form.status === 'lost'),
              ...(bookings.value || []).filter(booking => booking.status === 'lost' || booking.status === 'cancelled'),
              ...(facebookLeads.value || []).filter(lead => lead.status === 'lost')
            ].map(lead => ({
              ...lead,
              type: lead.bookingTime ? 'booking' : (lead.formId ? 'facebook' : 'form'),
              value: lead.value || '',
              service: lead.service || ''
            }));
            
            // Aggiorna i dati
            funnelData.value = {
              new: newLeads,
              contacted: contactedLeads,
              qualified: qualifiedLeads,
              opportunity: opportunityLeads,
              proposal: proposalLeads,
              customer: customerLeads,
              lost: lostLeads
            };
            
            // Calcolo statistiche
            calculateFunnelStats();
            
            // Inizializza o aggiorna i grafici
            initCharts();
            
          } catch (error) {
            console.error('Errore caricamento dati funnel:', error);
            showToast('Errore', 'Impossibile caricare i dati del funnel di vendita', 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          } finally {
            isLoading.value = false;
            // Nascondi l'overlay di caricamento dopo un breve ritardo per assicurarti che tutto sia renderizzato
            setTimeout(() => {
              showLoading.value = false;
            }, 300);
          }
        };
        
        // Calcola le statistiche del funnel
        const calculateFunnelStats = () => {
          // Totale lead
          const allLeads = [
            ...funnelData.value.new,
            ...funnelData.value.contacted,
            ...funnelData.value.qualified,
            ...funnelData.value.opportunity,
            ...funnelData.value.proposal,
            ...funnelData.value.customer,
            ...funnelData.value.lost
          ];
          
          funnelStats.value.totalLeads = allLeads.length;
          
          // Tasso di conversione (clienti / totale lead esclusi quelli nelle fasi iniziali)
          const leadsInPipeline = funnelData.value.contacted.length + 
                                  funnelData.value.qualified.length + 
                                  funnelData.value.opportunity.length + 
                                  funnelData.value.proposal.length + 
                                  funnelData.value.customer.length + 
                                  funnelData.value.lost.length;
          
          if (leadsInPipeline > 0) {
            funnelStats.value.conversionRate = Math.round((funnelData.value.customer.length / leadsInPipeline) * 100);
          } else {
            funnelStats.value.conversionRate = 0;
          }
          
          // Valore potenziale (tutti i lead in pipeline con valore)
          funnelStats.value.potentialValue = allLeads.reduce((total, lead) => {
            return total + (parseFloat(lead.value) || 0);
          }, 0);
          
          // Valore realizzato (clienti con valore)
          funnelStats.value.realizedValue = funnelData.value.customer.reduce((total, lead) => {
            return total + (parseFloat(lead.value) || 0);
          }, 0);
          
          // Valore perso (lead persi con valore)
          funnelStats.value.lostValue = funnelData.value.lost.reduce((total, lead) => {
            return total + (parseFloat(lead.value) || 0);
          }, 0);
          
          // Distribuzione per servizio
          const serviceDistribution = {};
          
          // Considera solo clienti acquisiti
          funnelData.value.customer.forEach(lead => {
            if (lead.service) {
              if (!serviceDistribution[lead.service]) {
                serviceDistribution[lead.service] = 0;
              }
              serviceDistribution[lead.service]++;
            }
          });
          
          funnelStats.value.serviceDistribution = serviceDistribution;
        };
        
        // Inizializza i grafici
        const initCharts = () => {
          // Distruggi i grafici esistenti per evitare perdite di memoria
          if (conversionChart) {
            conversionChart.destroy();
          }
          
          if (servicesChart) {
            servicesChart.destroy();
          }
          
          // Grafico tasso di conversione
          const conversionCtx = document.getElementById('conversionChart');
          if (conversionCtx) {
            const wonRate = funnelStats.value.conversionRate;
            const lostRate = 100 - wonRate;
            
            conversionChart = new Chart(conversionCtx, {
              type: 'doughnut',
              data: {
                labels: ['Acquisiti', 'Persi'],
                datasets: [{
                  data: [wonRate, lostRate],
                  backgroundColor: [
                    '#27ae60',
                    '#e74c3c'
                  ],
                  borderWidth: 0
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: 'bottom',
                    labels: {
                      color: 'rgba(255, 255, 255, 0.7)',
                      font: {
                        size: 10
                      },
                      boxWidth: 12
                    }
                  },
                  tooltip: {
                    callbacks: {
                      label: function(tooltipItem) {
                        return tooltipItem.label + ': ' + tooltipItem.raw + '%';
                      }
                    }
                  }
                },
                cutout: '70%'
              }
            });
          }
          
          // Grafico servizi
          const servicesCtx = document.getElementById('servicesChart');
          if (servicesCtx) {
            const serviceDistribution = funnelStats.value.serviceDistribution;
            const labels = Object.keys(serviceDistribution);
            const data = Object.values(serviceDistribution);
            
            // Colori per ogni servizio
            const colors = [
              '#FF6B00', '#3498db', '#e67e22', '#27ae60',
              '#9b59b6', '#f1c40f', '#e74c3c', '#1abc9c',
              '#34495e', '#2ecc71'
            ];
            
            servicesChart = new Chart(servicesCtx, {
              type: 'pie',
              data: {
                labels: labels.length > 0 ? labels : ['Nessun dato'],
                datasets: [{
                  data: data.length > 0 ? data : [1],
                  backgroundColor: data.length > 0 
                    ? labels.map((_, i) => colors[i % colors.length]) 
                    : ['rgba(0, 0, 0, 0.2)'],
                  borderWidth: 0
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    position: 'bottom',
                    labels: {
                      color: 'rgba(255, 255, 255, 0.7)',
                      font: {
                        size: 9
                      },
                      boxWidth: 10
                    }
                  }
                }
              }
            });
          }
        };
        
        // Drag and drop
        const onDragStart = (event, lead, sourceColumn) => {
          // Salva i dati del lead e la colonna di origine
          event.dataTransfer.setData('text/plain', JSON.stringify({
            lead: lead,
            sourceColumn: sourceColumn
          }));
          
          // Aggiunge la classe per lo stile durante il trascinamento
          event.target.classList.add('dragging');
        };
        
        const onDrop = async (event, targetColumn) => {
          event.preventDefault();
          
          // Rimuove la classe di highlight da tutte le colonne
          document.querySelectorAll('.funnel-body').forEach(column => {
            column.classList.remove('drag-over');
          });
          
          // Ottiene i dati del lead trascinato
          const data = JSON.parse(event.dataTransfer.getData('text/plain'));
          const draggedLead = data.lead;
          const sourceColumn = data.sourceColumn;
          
          // Se il lead è stato trascinato nella stessa colonna, non fare nulla
          if (sourceColumn === targetColumn) {
            return;
          }
          
          try {
            // Cambia lo stato del lead
            const newStatus = targetColumn;
            const leadType = draggedLead.type;
            const leadId = draggedLead._id;
            
            // Prepara i dati per l'aggiornamento
            const eventName = getEventNameForStatus(targetColumn);
            const payload = {
              newStatus,
              eventName,
              eventMetadata: {
                note: `Stato aggiornato tramite funnel di vendita`
              }
            };
            
            if (draggedLead.value) {
              payload.value = parseFloat(draggedLead.value);
            }
            
            // Seleziona l'endpoint in base al tipo di lead
            let endpoint;
            if (leadType === 'form') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/forms/${leadId}/update`;
            } else if (leadType === 'booking') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/bookings/${leadId}/update`;
            } else if (leadType === 'facebook') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/facebook/${leadId}/update`;
            }
            
            // Invia la richiesta di aggiornamento
            if (endpoint) {
              const response = await axios.post(endpoint, payload, { withCredentials: true });
              
              // Aggiorna il funnel localmente
              // Rimuovi il lead dalla colonna di origine
              funnelData.value[sourceColumn] = funnelData.value[sourceColumn].filter(
                lead => lead._id !== draggedLead._id
              );
              
              // Aggiungi il lead alla colonna di destinazione
              funnelData.value[targetColumn].push({
                ...draggedLead,
                status: newStatus
              });
              
              // Ricalcola le statistiche
              calculateFunnelStats();
              
              // Aggiorna i grafici
              initCharts();
              
              // Mostra notifica
              if (response.data.facebookResult && response.data.facebookResult.success) {
                showToast('Successo', `Lead spostato e evento "${eventName}" inviato a Facebook`, 'bg-success', 'bi bi-check-circle-fill me-2');
              } else {
                showToast('Avviso', `Lead spostato ma invio a Facebook fallito`, 'bg-warning', 'bi bi-exclamation-triangle-fill me-2');
              }
            }
          } catch (error) {
            console.error('Errore durante lo spostamento del lead:', error);
            showToast('Errore', 'Impossibile aggiornare lo stato del lead', 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          }
        };
        
        // Evidenzia colonna durante drag over
        const onDragOver = (event, targetColumn) => {
          event.preventDefault();
          
          // Aggiunge evidenziazione solo alla colonna target
          document.querySelectorAll('.funnel-body').forEach(column => {
            column.classList.remove('drag-over');
          });
          
          event.currentTarget.classList.add('drag-over');
        };
        
        // Rimuovi evidenziazione al drag leave
        const onDragLeave = (event) => {
          event.currentTarget.classList.remove('drag-over');
        };
        
        // Rimuovi stile dal lead quando termina il drag
        const onDragEnd = (event) => {
          event.target.classList.remove('dragging');
          
          // Rimuovi evidenziazione da tutte le colonne
          document.querySelectorAll('.funnel-body').forEach(column => {
            column.classList.remove('drag-over');
          });
        };
        
        // Ottieni il nome dell'evento da inviare a Facebook in base allo stato
        const getEventNameForStatus = (status) => {
          switch(status) {
            case 'contacted': return 'Contact';
            case 'qualified': return 'QualifiedLead';
            case 'opportunity': return 'Opportunity';
            case 'proposal': return 'ProposalSent';
            case 'customer': return 'Purchase';
            case 'lost': return 'Lost';
            default: return 'CustomEvent';
          }
        };
        
        // Modifica valore e servizio di un lead
        const editLeadValue = (lead) => {
          currentFunnelLead.value = lead;
          newLeadValue.value = lead.value ? lead.value.toString() : '';
          newLeadService.value = lead.service || '';
          
          // Mostra modale
          const modal = new bootstrap.Modal(document.getElementById('leadValueModal'));
          modal.show();
        };
        
        // Salva il valore e il servizio del lead
        const saveLeadValue = async () => {
          if (!currentFunnelLead.value) return;
          
          try {
            isLoading.value = true;
            
            const leadType = currentFunnelLead.value.type;
            const leadId = currentFunnelLead.value._id;
            const leadColumn = currentFunnelLead.value.status;
            
            // Prepara i dati per l'aggiornamento
            const payload = {
              value: newLeadValue.value ? parseFloat(newLeadValue.value) : null,
              service: newLeadService.value
            };
            
            // Seleziona l'endpoint in base al tipo di lead
            let endpoint;
            if (leadType === 'form') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/forms/${leadId}/update-metadata`;
            } else if (leadType === 'booking') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/bookings/${leadId}/update-metadata`;
            } else if (leadType === 'facebook') {
              endpoint = `https://api.costruzionedigitale.com/api/leads/facebook/${leadId}/update-metadata`;
            }
            
            // Invia la richiesta di aggiornamento
            if (endpoint) {
              await axios.post(endpoint, payload, { withCredentials: true });
              
              // Aggiorna il lead nel funnel localmente
              const leadIndex = funnelData.value[leadColumn].findIndex(
                lead => lead._id === leadId
              );
              
              if (leadIndex !== -1) {
                funnelData.value[leadColumn][leadIndex].value = newLeadValue.value;
                funnelData.value[leadColumn][leadIndex].service = newLeadService.value;
              }
              
              // Ricalcola le statistiche
              calculateFunnelStats();
              
              // Aggiorna i grafici
              initCharts();
              
              // Chiudi modale
              const modal = bootstrap.Modal.getInstance(document.getElementById('leadValueModal'));
              modal.hide();
              
              // Mostra notifica
              showToast('Successo', 'Dati del lead aggiornati', 'bg-success', 'bi bi-check-circle-fill me-2');
            }
          } catch (error) {
            console.error('Errore durante l\'aggiornamento del lead:', error);
            showToast('Errore', 'Impossibile aggiornare i dati del lead', 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
          } finally {
            isLoading.value = false;
          }
        };
        
        const viewLeadDetails = (lead) => {
          // Mostra i dettagli completi del lead Facebook
          // Puoi implementare una visualizzazione più dettagliata qui
          const details = {
            ...lead,
            customFields: lead.customFields || {},
            rawData: lead.rawData || {}
          };
          
          currentEvent.value = {
            eventName: 'Dettagli Lead Facebook',
            createdAt: lead.createdAt,
            userData: {
              name: lead.name,
              email: lead.email,
              phone: lead.phone
            },
            customData: {
              leadId: lead.leadId,
              formId: lead.formId,
              adId: lead.adId,
              customFields: lead.customFields
            },
            success: true
          };
          
          // Usa il modale dei dettagli evento per mostrare i dettagli del lead
          const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
          modal.show();
        };
        
        const togglePasswordVisibility = () => {
          passwordVisible.value = !passwordVisible.value;
        };
        
        const showToast = (title, message, colorClass, iconClass) => {
          toastTitle.value = title;
          toastMessage.value = message;
          toastClass.value = colorClass;
          toastIconClass.value = iconClass;
          
          const toastEl = document.getElementById('notificationToast');
          const toast = new bootstrap.Toast(toastEl);
          toast.show();
        };

        // Supporto per interazioni touch
        const touchState = ref({
          longPressTimer: null,
          isLongPress: false,
          startX: 0,
          startY: 0,
          currentCell: null,
          startTime: null,
          draggedEvent: null,
          resizingEvent: null,
          initialEventHeight: 0,
          startClientY: 0,
          isResizing: false,
          isDragging: false,
          touchFeedbackElement: null
        });

        // Gestore del long press (circa riga 2265, dopo handleEventDrop)
        const handleLongPress = (element, date, hour) => {
          // Resetta eventuali stati precedenti
          if (touchState.value.touchFeedbackElement) {
            touchState.value.touchFeedbackElement.classList.remove('touch-feedback');
          }
          
          touchState.value.isLongPress = true;
          touchState.value.currentCell = element;
          
          // Aggiungi feedback visivo
          element.classList.add('touch-feedback');
          touchState.value.touchFeedbackElement = element;
          
          // Mostra prompt per nuovo appuntamento
          const appointmentTime = new Date(date);
          appointmentTime.setHours(hour, 0, 0, 0);
          
          // Imposta i valori per il nuovo appuntamento
          const dateStr = appointmentTime.toISOString().split('T')[0];
          const timeStr = `${hour.toString().padStart(2, '0')}:00`;
          
          currentAppointment.value = {
            title: '',
            date: dateStr,
            time: timeStr,
            duration: '60',
            status: 'pending',
            clientId: '',
            description: ''
          };
          
          // Apri modale nuovo appuntamento
          editingAppointment.value = false;
          const modal = new bootstrap.Modal(document.getElementById('appointmentModal'));
          modal.show();
          
          // Rimuovi il feedback dopo l'apertura del modale
          setTimeout(() => {
            if (touchState.value.touchFeedbackElement) {
              touchState.value.touchFeedbackElement.classList.remove('touch-feedback');
              touchState.value.touchFeedbackElement = null;
            }
          }, 300);
        };
        
        // Gestore inizio touch (circa riga 2310)
        const handleTouchStart = (e, element, date, hour) => {
          if (e.touches.length !== 1) return; // Solo touch singolo
          
          const touch = e.touches[0];
          touchState.value.startX = touch.clientX;
          touchState.value.startY = touch.clientY;
          touchState.value.startTime = Date.now();
          
          // Controlla se è su un evento esistente o su una cella vuota
          const eventElement = e.target.closest('.calendar-day-event');
          
          if (eventElement) {
            // Touch su un evento esistente
            const eventId = eventElement.getAttribute('data-event-id');
            touchState.value.draggedEvent = calendarEvents.value.find(ev => ev.id === eventId);
            
            // Controlla se il touch è sul handle di resize
            const resizeHandle = e.target.closest('.event-resize-handle');
            if (resizeHandle) {
              touchState.value.isResizing = true;
              touchState.value.resizingEvent = touchState.value.draggedEvent;
              touchState.value.initialEventHeight = eventElement.offsetHeight;
              touchState.value.startClientY = touch.clientY;
              
              // Feedback visivo
              eventElement.classList.add('event-dragging');
            } else {
              // Prepara per drag
              touchState.value.longPressTimer = setTimeout(() => {
                touchState.value.isDragging = true;
                eventElement.classList.add('event-dragging');
              }, 500);
            }
          } else {
            // Touch su una cella vuota (long press per nuovo appuntamento)
            touchState.value.longPressTimer = setTimeout(() => {
              handleLongPress(element, date, hour);
            }, 800); // 800ms per long press
          }
        };
        
        // Gestore movimento touch (circa riga 2370)
        const handleTouchMove = (e) => {
          if (!touchState.value.isLongPress && !touchState.value.isDragging && !touchState.value.isResizing) {
            // Cancella timer se l'utente sta scorrendo
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - touchState.value.startX);
            const deltaY = Math.abs(touch.clientY - touchState.value.startY);
            
            // Se il movimento è significativo, cancella il timer di long press
            if (deltaX > 10 || deltaY > 10) {
              clearTimeout(touchState.value.longPressTimer);
            }
            return;
          }
          
          // Previeni scroll durante drag o resize
          e.preventDefault();
          
          if (touchState.value.isResizing && touchState.value.resizingEvent) {
            // Logica di resize
            const touch = e.touches[0];
            const deltaY = touch.clientY - touchState.value.startClientY;
            
            // Calcola la nuova durata in base al movimento
            const pixelsPerMinute = touchState.value.initialEventHeight / (parseInt(touchState.value.resizingEvent.duration) || 60);
            const additionalMinutes = Math.round(deltaY / pixelsPerMinute);
            const newDuration = Math.max(30, (parseInt(touchState.value.resizingEvent.duration) || 60) + additionalMinutes);
            
            // Trova l'elemento dell'evento e aggiorna l'altezza visivamente
            const eventElement = document.querySelector(`.calendar-day-event[data-event-id="${touchState.value.resizingEvent.id}"]`);
            if (eventElement) {
              const newHeight = (newDuration / 60) * 60; // 60px per ora
              eventElement.style.height = `${newHeight}px`;
            }
          } else if (touchState.value.isDragging && touchState.value.draggedEvent) {
            // Logica di drag
            const touch = e.touches[0];
            
            // Trova la cella sotto il punto di touch corrente
            const elementsAtPoint = document.elementsFromPoint(touch.clientX, touch.clientY);
            const targetCell = elementsAtPoint.find(el => el.classList.contains('calendar-events-cell'));
            
            if (targetCell) {
              // Evidenzia la cella di destinazione per il feedback visivo
              document.querySelectorAll('.calendar-events-cell').forEach(cell => {
                cell.classList.remove('event-drop-highlight');
              });
              targetCell.classList.add('event-drop-highlight');
              
              // Snap to grid - trovare l'ora più vicina
              const cellHour = parseInt(targetCell.getAttribute('data-hour') || '0');
              touchState.value.currentDropHour = cellHour;
            }
          }
        };
        
        // Gestore fine touch
        const handleTouchEnd = async (e) => {
          // Cancella sempre il timer di long press
          clearTimeout(touchState.value.longPressTimer);
          
          // Rimuovi tutti i feedback visivi
          if (touchState.value.touchFeedbackElement) {
            touchState.value.touchFeedbackElement.classList.remove('touch-feedback');
          }
          
          document.querySelectorAll('.calendar-events-cell').forEach(cell => {
            cell.classList.remove('event-drop-highlight', 'snap-target');
          });
          
          try {
            // Gestione del drag & drop di un evento
            if (touchState.value.isDragging && touchState.value.draggedEvent && touchState.value.currentDropHour) {
              const eventElement = document.querySelector(`.calendar-day-event[data-event-id="${touchState.value.draggedEvent.id}"]`);
              if (eventElement) {
                eventElement.classList.remove('event-dragging');
                
                // Calcola nuova ora di inizio
                const originalStart = new Date(touchState.value.draggedEvent.start);
                const originalHour = originalStart.getHours();
                
                // Se l'ora è cambiata, aggiorna l'evento
                if (originalHour !== touchState.value.currentDropHour) {
                  const newStart = new Date(originalStart);
                  newStart.setHours(touchState.value.currentDropHour);
                  
                  // Calcola nuova ora di fine mantenendo la durata
                  const duration = parseInt(touchState.value.draggedEvent.duration) || 60;
                  const newEnd = new Date(newStart.getTime() + duration * 60000);
                  
                  try {
                    // Invia al server l'aggiornamento
                    await axios.put(
                      `https://api.costruzionedigitale.com/api/appointments/${touchState.value.draggedEvent.id}`, 
                      {
                        start: newStart,
                        end: newEnd
                      },
                      { withCredentials: true }
                    );
                    
                    // Aggiorna localmente dopo il successo
                    const index = calendarEvents.value.findIndex(e => e.id === touchState.value.draggedEvent.id);
                    if (index !== -1) {
                      calendarEvents.value[index].start = newStart;
                      calendarEvents.value[index].end = newEnd;
                    }
                    
                    // Aggiorna la vista
                    document.querySelectorAll('.calendar-day-event').forEach(el => el.remove());
                    renderCalendarEvents();
                    updateSelectedDateEvents();
                    
                    // Feedback visivo dell'aggiornamento
                    showToast('Successo', 'Appuntamento spostato', 'bg-success', 'bi bi-check-circle-fill me-2');
                  } catch (error) {
                    console.error('Errore durante l\'aggiornamento dell\'evento:', error);
                    showToast('Errore', 'Impossibile aggiornare l\'appuntamento', 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
                  }
                }
              }
            }
            
            // Gestione del resize di un evento
            if (touchState.value.isResizing && touchState.value.resizingEvent) {
              const eventElement = document.querySelector(`.calendar-day-event[data-event-id="${touchState.value.resizingEvent.id}"]`);
              if (eventElement) {
                eventElement.classList.remove('event-dragging');
                
                // Calcola la nuova durata in base all'altezza finale
                const heightPx = parseFloat(eventElement.style.height);
                const newDuration = Math.round(heightPx / 60 * 60); // 60px per ora, converte in minuti
                
                // Aggiorna l'evento solo se la durata è cambiata
                if (newDuration !== parseInt(touchState.value.resizingEvent.duration)) {
                  const newStart = new Date(touchState.value.resizingEvent.start);
                  const newEnd = new Date(newStart.getTime() + newDuration * 60000);
                  
                  try {
                    // Invia al server
                    await axios.put(
                      `https://api.costruzionedigitale.com/api/appointments/${touchState.value.resizingEvent.id}`, 
                      {
                        start: newStart,
                        end: newEnd,
                        duration: newDuration
                      },
                      { withCredentials: true }
                    );
                    
                    // Aggiorna localmente
                    const index = calendarEvents.value.findIndex(e => e.id === touchState.value.resizingEvent.id);
                    if (index !== -1) {
                      calendarEvents.value[index].end = newEnd;
                      calendarEvents.value[index].duration = newDuration.toString();
                    }
                    
                    // Aggiorna la vista
                    document.querySelectorAll('.calendar-day-event').forEach(el => el.remove());
                    renderCalendarEvents();
                    updateSelectedDateEvents();
                    
                    // Feedback visivo
                    showToast('Successo', 'Durata appuntamento modificata', 'bg-success', 'bi bi-check-circle-fill me-2');
                  } catch (error) {
                    console.error('Errore durante l\'aggiornamento della durata:', error);
                    showToast('Errore', 'Impossibile aggiornare la durata', 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
                  }
                }
              }
            }
          } catch (error) {
            console.error('Errore nella gestione degli eventi touch:', error);
          }
          
          // Reset dello stato
          touchState.value = {
            longPressTimer: null,
            isLongPress: false,
            startX: 0,
            startY: 0,
            currentCell: null,
            startTime: null,
            draggedEvent: null,
            resizingEvent: null,
            initialEventHeight: 0,
            startClientY: 0,
            isResizing: false,
            isDragging: false,
            touchFeedbackElement: null,
            currentDropHour: null
          };
        };

        const calendarEl = ref(null);
        const calendarInstance = ref(null);
        const calendarEvents = ref([]);
        const selectedDate = ref(new Date());
        const selectedDateEvents = ref([]);
        const currentAppointment = ref({
          title: '',
          date: '',
          time: '09:00',
          duration: '60',
          status: 'pending',
          clientId: '',
          description: ''
        });
        const editingAppointment = ref(false);
        const isSavingAppointment = ref(false);
        const clients = ref([]);
        const dailyHours = ref([9, 10, 11, 12, 13, 14, 15, 16, 17, 18]);
        
        // Sostituisci la funzione initCalendar con questa versione
        const initCalendar = () => {
          if (!calendarEl.value) return;
          
          // Pulisci eventuali contenuti esistenti
          calendarEl.value.innerHTML = '';
          
          // Crea la vista del calendario in base alla vista selezionata
          if (calendarView.value === 'month') {
            createMonthView();
          } else if (calendarView.value === 'week') {
            createWeekView();
          } else if (calendarView.value === 'day') {
            createDayView();
          } else if (calendarView.value === 'list') {
            createListView();
          }
          
          // Renderizza gli eventi
          renderCalendarEvents();
        };

        // Funzione per creare la vista mensile
        const createMonthView = () => {
          const monthView = document.createElement('div');
          monthView.className = 'calendar-month-view';
          
          // Intestazione giorni della settimana
          const daysHeader = document.createElement('div');
          daysHeader.className = 'month-days-header';
          
          const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
          dayNames.forEach(dayName => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'month-day-name';
            dayHeader.textContent = dayName;
            daysHeader.appendChild(dayHeader);
          });
          
          monthView.appendChild(daysHeader);
          
          // Griglia dei giorni
          const daysGrid = document.createElement('div');
          daysGrid.className = 'month-days-grid';
          
          // Calcola il primo e l'ultimo giorno del mese
          const year = selectedDate.value.getFullYear();
          const month = selectedDate.value.getMonth();
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          
          // Calcola il numero di giorni da mostrare
          const firstDayOfWeek = firstDay.getDay();
          const daysInMonth = lastDay.getDate();
          const totalDays = 42; // 6 righe di 7 giorni ciascuna
          
          // Giorno corrente per confronto
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          
          // Genera le celle dei giorni
          for (let i = 0; i < totalDays; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'month-day-cell';
            
            const dayOffset = i - firstDayOfWeek;
            const dayDate = new Date(year, month, dayOffset + 1);
            const isCurrentMonth = dayDate.getMonth() === month;
            
            if (!isCurrentMonth) {
              dayCell.classList.add('other-month');
            }
            
            // Giorno corrente
            if (dayDate.toDateString() === today.toDateString()) {
              dayCell.classList.add('today-cell');
            }
            
            // Giorno selezionato
            if (dayDate.toDateString() === selectedDate.value.toDateString()) {
              dayCell.classList.add('selected-cell');
            }
            
            // Numero del giorno
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = dayDate.getDate();
            dayCell.appendChild(dayNumber);
            
            // Contenitore per gli eventi
            const dayEvents = document.createElement('div');
            dayEvents.className = 'day-events';
            dayCell.appendChild(dayEvents);
            
            // Data dell'evento come attributo
            dayCell.setAttribute('data-date', dayDate.toISOString().split('T')[0]);
            
            // Click sul giorno per selezionarlo
            dayCell.addEventListener('click', () => {
              selectedDate.value = new Date(dayDate);
              updateSelectedDateEvents();
              initCalendar();
            });
            
            daysGrid.appendChild(dayCell);
          }
          
          monthView.appendChild(daysGrid);
          calendarEl.value.appendChild(monthView);
        };
        
        // Funzione per creare la vista settimanale
        const createWeekView = () => {
          const weekView = document.createElement('div');
          weekView.className = 'calendar-week-view';
          
          // Calcola il primo giorno della settimana (domenica)
          const firstDayOfWeek = new Date(selectedDate.value);
          const day = selectedDate.value.getDay();
          firstDayOfWeek.setDate(firstDayOfWeek.getDate() - day);
          
          // Intestazione
          const weekHeader = document.createElement('div');
          weekHeader.className = 'week-header';
          
          // Cella vuota nell'angolo
          const cornerCell = document.createElement('div');
          cornerCell.className = 'week-corner-cell';
          weekHeader.appendChild(cornerCell);
          
          // Giorno corrente per confronto
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          
          // Celle intestazione per ogni giorno
          for (let i = 0; i < 7; i++) {
            const dayDate = new Date(firstDayOfWeek);
            dayDate.setDate(dayDate.getDate() + i);
            
            const dayHeader = document.createElement('div');
            dayHeader.className = 'week-day-header';
            
            // Controlla se è oggi o il giorno selezionato
            if (dayDate.toDateString() === today.toDateString()) {
              dayHeader.classList.add('week-today-header');
            }
            
            if (dayDate.toDateString() === selectedDate.value.toDateString()) {
              dayHeader.classList.add('week-selected-header');
            }
            
            // Formatta intestazione giorno
            const dayName = dayDate.toLocaleDateString('it-IT', { weekday: 'short' });
            const dayNum = dayDate.getDate();
            
            dayHeader.innerHTML = `
              <div class="week-day-name">${dayName}</div>
              <div class="week-day-number">${dayNum}</div>
            `;
            
            // Attributo data
            dayHeader.setAttribute('data-date', dayDate.toISOString().split('T')[0]);
            
            // Click sul giorno per selezionarlo
            dayHeader.addEventListener('click', () => {
              selectedDate.value = new Date(dayDate);
              updateSelectedDateEvents();
              changeCalendarView('day');
            });
            
            weekHeader.appendChild(dayHeader);
          }
          
          weekView.appendChild(weekHeader);
          
          // Griglia degli orari
          const timeGrid = document.createElement('div');
          timeGrid.className = 'week-time-grid';
          
          // Genera le righe per ogni ora
          for (let hour = 8; hour < 20; hour++) {
            // Etichetta dell'ora
            const timeLabel = document.createElement('div');
            timeLabel.className = 'week-time-label';
            timeLabel.textContent = `${hour}:00`;
            timeGrid.appendChild(timeLabel);
            
            // Celle per ogni giorno della settimana
            for (let day = 0; day < 7; day++) {
              const dayDate = new Date(firstDayOfWeek);
              dayDate.setDate(dayDate.getDate() + day);
              
              const timeSlot = document.createElement('div');
              timeSlot.className = 'week-time-slot';
              timeSlot.setAttribute('data-hour', hour);
              timeSlot.setAttribute('data-date', dayDate.toISOString().split('T')[0]);
              
              timeGrid.appendChild(timeSlot);
            }
          }
          
          weekView.appendChild(timeGrid);
          calendarEl.value.appendChild(weekView);
        };
        
        // Funzione per creare la vista giornaliera
        const createDayView = () => {
          const dayView = document.createElement('div');
          dayView.className = 'calendar-day-view';
          
          // Colonna delle ore
          const timeColumn = document.createElement('div');
          timeColumn.className = 'day-time-column';
          
          // Colonna degli eventi
          const eventsColumn = document.createElement('div');
          eventsColumn.className = 'day-events-column';
          
          // Genera righe per ogni ora
          for (let hour = 8; hour < 20; hour++) {
            // Etichetta dell'ora
            const timeSlot = document.createElement('div');
            timeSlot.className = 'day-time-slot';
            timeSlot.textContent = `${hour}:00`;
            timeColumn.appendChild(timeSlot);
            
            // Slot per gli eventi
            const eventSlot = document.createElement('div');
            eventSlot.className = 'day-event-slot';
            eventSlot.setAttribute('data-hour', hour);
            eventSlot.setAttribute('data-date', selectedDate.value.toISOString().split('T')[0]);
            
            // Aggiungi i listener per il drag & drop e touch
            eventSlot.addEventListener('touchstart', (e) => handleTouchStart(e, eventSlot, selectedDate.value, hour));
            eventSlot.addEventListener('dragover', (e) => e.preventDefault());
            eventSlot.addEventListener('drop', (e) => handleEventDrop(e, selectedDate.value, hour));
            
            eventsColumn.appendChild(eventSlot);
          }
          
          dayView.appendChild(timeColumn);
          dayView.appendChild(eventsColumn);
          calendarEl.value.appendChild(dayView);
        };
        
        // Aggiungi questa funzione per creare la struttura del calendario
        const createCustomCalendar = () => {
          // Crea l'intestazione del calendario
          const header = document.createElement('div');
          header.className = 'calendar-header d-flex justify-content-between align-items-center';
          
          // Pulsanti di navigazione
          const navButtons = document.createElement('div');
          navButtons.className = 'btn-group';
          
          const prevButton = document.createElement('button');
          prevButton.className = 'btn btn-outline-primary';
          prevButton.innerHTML = '&laquo; Prec';
          prevButton.onclick = () => navigateCalendar('prev');
          
          const todayButton = document.createElement('button');
          todayButton.className = 'btn btn-outline-primary mx-2';
          todayButton.textContent = 'Oggi';
          todayButton.onclick = () => navigateCalendar('today');
          
          const nextButton = document.createElement('button');
          nextButton.className = 'btn btn-outline-primary';
          nextButton.innerHTML = 'Succ &raquo;';
          nextButton.onclick = () => navigateCalendar('next');
          
          navButtons.appendChild(prevButton);
          navButtons.appendChild(todayButton);
          navButtons.appendChild(nextButton);
          
          // Titolo del mese
          const title = document.createElement('h4');
          title.className = 'calendar-title m-0';
          title.textContent = formatMonthTitle(selectedDate.value);
          
          // Controlli di visualizzazione
          const viewControls = document.createElement('div');
          viewControls.className = 'btn-group';
          
          const monthBtn = document.createElement('button');
          monthBtn.className = 'btn btn-outline-primary';
          monthBtn.textContent = 'Mese';
          monthBtn.onclick = () => changeCalendarView('month');
          
          const dayBtn = document.createElement('button');
          dayBtn.className = 'btn btn-outline-primary mx-2';
          dayBtn.textContent = 'Giorno';
          dayBtn.onclick = () => changeCalendarView('day');
          
          const listBtn = document.createElement('button');
          listBtn.className = 'btn btn-outline-primary';
          listBtn.textContent = 'Lista';
          listBtn.onclick = () => changeCalendarView('list');
          
          viewControls.appendChild(monthBtn);
          viewControls.appendChild(dayBtn);
          viewControls.appendChild(listBtn);
          
          // Assembla l'header
          header.appendChild(navButtons);
          header.appendChild(title);
          header.appendChild(viewControls);
          
          // Contenitore del calendario
          const calendarContainer = document.createElement('div');
          calendarContainer.className = 'calendar-container';
          
          // Crea griglia dei giorni (vista giorno predefinita)
          const dayGrid = createDayGrid(selectedDate.value);
          
          // Aggiungi tutto al container principale
          calendarEl.value.appendChild(header);
          calendarEl.value.appendChild(calendarContainer);
          calendarContainer.appendChild(dayGrid);
          
          // Salva i riferimenti importanti nell'istanza del calendario
          calendarInstance.value = {
            header,
            container: calendarContainer,
            view: {
              type: 'day' // Vista predefinita: giorno
            },
            updateTitle: () => {
              title.textContent = formatMonthTitle(selectedDate.value);
            },
            updateView: () => {
              calendarContainer.innerHTML = '';
              
              if (calendarInstance.value.view.type === 'month') {
                calendarContainer.appendChild(createMonthGrid(selectedDate.value));
              } else if (calendarInstance.value.view.type === 'day') {
                calendarContainer.appendChild(createDayGrid(selectedDate.value));
              } else if (calendarInstance.value.view.type === 'list') {
                calendarContainer.appendChild(createListView(selectedDate.value));
              }
              
              // Renderizza gli eventi nella nuova vista
              renderCalendarEvents();
            },
            changeView: (viewType, date) => {
              selectedDate.value = date || selectedDate.value;
              calendarInstance.value.view.type = viewType;
              calendarInstance.value.updateTitle();
              calendarInstance.value.updateView();
            }
          };
        };

        const createListView = () => {
          const listView = document.createElement('div');
          listView.className = 'calendar-list-view';
          
          // Ordina gli eventi per data
          const sortedEvents = [...calendarEvents.value].sort((a, b) => 
            new Date(a.start) - new Date(b.start)
          );
          
          // Raggruppa gli eventi per data
          const eventsByDate = {};
          sortedEvents.forEach(event => {
            const date = new Date(event.start);
            const dateKey = date.toISOString().split('T')[0];
            
            if (!eventsByDate[dateKey]) {
              eventsByDate[dateKey] = [];
            }
            
            eventsByDate[dateKey].push(event);
          });
          
          // Se non ci sono eventi, mostra messaggio
          if (Object.keys(eventsByDate).length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'list-empty-message';
            emptyMessage.textContent = 'Nessun appuntamento programmato';
            listView.appendChild(emptyMessage);
          } else {
            // Genera sezioni per ogni data
            Object.keys(eventsByDate).sort().forEach(dateKey => {
              const date = new Date(dateKey);
              
              // Intestazione data
              const dateHeader = document.createElement('div');
              dateHeader.className = 'list-date-header';
              
              // Controlla se è oggi
              const today = new Date();
              today.setHours(0, 0, 0, 0);
              const isToday = date.toDateString() === today.toDateString();
              
              // Formatta data
              const formattedDate = isToday ? 
                'Oggi' : 
                date.toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' });
              
              dateHeader.textContent = formattedDate;
              listView.appendChild(dateHeader);
              
              // Aggiungi eventi per questa data
              eventsByDate[dateKey].forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = `list-event-item event-status-${event.status}`;
                
                // Formatta ora
                const startTime = new Date(event.start);
                const endTime = new Date(event.end);
                const formattedTime = `${formatTime(startTime)} - ${formatTime(endTime)}`;
                
                // Struttura dell'evento
                eventItem.innerHTML = `
                  <div class="list-event-time">${formattedTime}</div>
                  <div class="list-event-details">
                    <div class="list-event-title">${event.title}</div>
                    ${event.description ? `<div class="list-event-description">${event.description}</div>` : ''}
                  </div>
                `;
                
                // Click sull'evento per modificarlo
                eventItem.addEventListener('click', () => {
                  editAppointment(event);
                });
                
                listView.appendChild(eventItem);
              });
            });
          }
          
          calendarEl.value.appendChild(listView);
        };
        
        // Funzione per formattare il titolo del mese
        const formatMonthTitle = (date) => {
          const options = { month: 'long', year: 'numeric' };
          return date.toLocaleDateString('it-IT', options);
        };

        // Funzione per formattare la data selezionata
        const formatSelectedDate = (date) => {
          const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
          return date.toLocaleDateString('it-IT', options);
        };
        
        const createMonthGrid = (date) => {
          const grid = document.createElement('div');
          grid.className = 'calendar-month-grid';
          
          // Crea intestazione giorni della settimana
          const daysHeader = document.createElement('div');
          daysHeader.className = 'calendar-days-header';
          
          const dayNames = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
          dayNames.forEach(day => {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day-name';
            dayCell.textContent = day;
            daysHeader.appendChild(dayCell);
          });
          
          grid.appendChild(daysHeader);
          
          // Crea griglia giornaliera
          const monthDays = document.createElement('div');
          monthDays.className = 'calendar-month-days';
          
          // Calcola il primo giorno del mese e l'ultimo
          const year = date.getFullYear();
          const month = date.getMonth();
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          
          // Calcola il numero di celle da mostrare (inclusi i giorni del mese precedente/successivo)
          const firstDayOfWeek = firstDay.getDay();
          const daysInMonth = lastDay.getDate();
          const totalCells = Math.ceil((firstDayOfWeek + daysInMonth) / 7) * 7;
          
          // Riempie la griglia con i giorni
          for (let i = 0; i < totalCells; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day';
            
            const dayNumber = i - firstDayOfWeek + 1;
            const currentDate = new Date(year, month, dayNumber);
            
            // Verifica se il giorno fa parte del mese corrente
            if (dayNumber <= 0 || dayNumber > daysInMonth) {
              dayCell.classList.add('calendar-other-month');
            } else {
              // Aggiunge la data effettiva come attributo
              dayCell.setAttribute('data-date', currentDate.toISOString().split('T')[0]);
              
              // Controllo se è oggi
              const today = new Date();
              if (currentDate.getDate() === today.getDate() && 
                  currentDate.getMonth() === today.getMonth() && 
                  currentDate.getFullYear() === today.getFullYear()) {
                dayCell.classList.add('calendar-today');
              }
              
              // Controllo se è il giorno selezionato
              if (currentDate.getDate() === selectedDate.value.getDate() && 
                  currentDate.getMonth() === selectedDate.value.getMonth() && 
                  currentDate.getFullYear() === selectedDate.value.getFullYear()) {
                dayCell.classList.add('calendar-selected');
              }
              
              // Aggiunge l'evento click per selezionare la data
              dayCell.addEventListener('click', () => {
                selectedDate.value = new Date(currentDate);
                updateSelectedDateEvents();
                
                // Se siamo in vista mensile, non cambiamo vista
                calendarInstance.value.updateTitle();
                calendarInstance.value.updateView();
              });
            }
            
            // Aggiunge il numero del giorno
            const dayLabel = document.createElement('div');
            dayLabel.className = 'calendar-day-label';
            dayLabel.textContent = currentDate.getDate();
            dayCell.appendChild(dayLabel);
            
            // Aggiunge il contenitore per gli eventi
            const eventsContainer = document.createElement('div');
            eventsContainer.className = 'calendar-day-events';
            dayCell.appendChild(eventsContainer);
            
            monthDays.appendChild(dayCell);
          }
          
          grid.appendChild(monthDays);
          return grid;
        };
        
        const createWeekGrid = (date) => {
          const grid = document.createElement('div');
          grid.className = 'calendar-week-grid';
          
          // Calcola il primo giorno della settimana (domenica o lunedì)
          const weekStart = new Date(date);
          const dayOfWeek = weekStart.getDay();
          weekStart.setDate(weekStart.getDate() - dayOfWeek); // Imposta a domenica
          
          // Crea intestazione giorni della settimana
          const daysHeader = document.createElement('div');
          daysHeader.className = 'calendar-week-header';
          
          // Crea slot per le ore
          const timeColumn = document.createElement('div');
          timeColumn.className = 'calendar-time-column';
          
          // Aggiunge l'intestazione vuota per la colonna delle ore
          const timeHeader = document.createElement('div');
          timeHeader.className = 'calendar-time-header';
          timeColumn.appendChild(timeHeader);
          
          // Aggiunge le celle delle ore
          for (let hour = 8; hour < 20; hour++) {
            const timeCell = document.createElement('div');
            timeCell.className = 'calendar-time-cell';
            timeCell.textContent = `${hour}:00`;
            timeColumn.appendChild(timeCell);
          }
          
          daysHeader.appendChild(timeColumn);
          
          // Crea colonne per i giorni
          const daysColumns = [];
          for (let i = 0; i < 7; i++) {
            const dayDate = new Date(weekStart);
            dayDate.setDate(dayDate.getDate() + i);
            
            const dayColumn = document.createElement('div');
            dayColumn.className = 'calendar-day-column';
            dayColumn.setAttribute('data-date', dayDate.toISOString().split('T')[0]);
            
            // Aggiunge l'intestazione del giorno
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header day-header-selectable';
            
            // Controlla se è oggi o il giorno selezionato
            const today = new Date();
            if (dayDate.getDate() === today.getDate() && 
                dayDate.getMonth() === today.getMonth() && 
                dayDate.getFullYear() === today.getFullYear()) {
              dayHeader.classList.add('calendar-today');
            }
            
            if (dayDate.getDate() === selectedDate.value.getDate() && 
                dayDate.getMonth() === selectedDate.value.getMonth() && 
                dayDate.getFullYear() === selectedDate.value.getFullYear()) {
              dayHeader.classList.add('day-selected');
            }
            
            // Aggiunge evento click per cambiare giorno
            dayHeader.addEventListener('click', () => {
              selectedDate.value = new Date(dayDate);
              updateSelectedDateEvents();
              calendarInstance.value.changeView('day', dayDate);
            });
            
            // Formatta il titolo del giorno
            const dayName = dayDate.toLocaleDateString('it-IT', { weekday: 'short' });
            const dayNum = dayDate.getDate();
            dayHeader.innerHTML = `${dayName} <span class="calendar-day-number">${dayNum}</span>`;
            
            dayColumn.appendChild(dayHeader);
            
            // Aggiunge le celle delle ore per questo giorno
            for (let hour = 8; hour < 20; hour++) {
              const hourCell = document.createElement('div');
              hourCell.className = 'calendar-hour-cell';
              hourCell.setAttribute('data-hour', hour);
              hourCell.setAttribute('data-date', dayDate.toISOString().split('T')[0]);
              
              dayColumn.appendChild(hourCell);
            }
            
            daysHeader.appendChild(dayColumn);
            daysColumns.push(dayColumn);
          }
          
          grid.appendChild(daysHeader);
          return grid;
        };
        
        const createDayGrid = (date) => {
          const grid = document.createElement('div');
          grid.className = 'calendar-day-grid';
          
          // Crea intestazione del giorno
          const dayHeader = document.createElement('div');
          dayHeader.className = 'calendar-single-day-header';
          
          // Formatta il titolo del giorno
          const dayTitle = document.createElement('h5');
          dayTitle.className = 'm-0';
          dayTitle.textContent = date.toLocaleDateString('it-IT', { 
            weekday: 'long', 
            day: 'numeric', 
            month: 'long' 
          });
          dayHeader.appendChild(dayTitle);
          
          grid.appendChild(dayHeader);
          
          // Crea la griglia oraria
          const hoursGrid = document.createElement('div');
          hoursGrid.className = 'calendar-hours-grid';
          
          // Aggiunge le celle delle ore
          for (let hour = 8; hour < 20; hour++) {
            const hourRow = document.createElement('div');
            hourRow.className = 'calendar-hour-row';
            
            // Cella dell'ora
            const timeCell = document.createElement('div');
            timeCell.className = 'calendar-time-label';
            timeCell.textContent = `${hour}:00`;
            hourRow.appendChild(timeCell);
            
            // Cella degli eventi
            const eventsCell = document.createElement('div');
            eventsCell.className = 'calendar-events-cell';
            eventsCell.setAttribute('data-hour', hour);
            eventsCell.setAttribute('data-date', date.toISOString().split('T')[0]);
            hourRow.appendChild(eventsCell);
            
            hoursGrid.appendChild(hourRow);
          }
          
          grid.appendChild(hoursGrid);
          return grid;
        };
        
        // Funzione per navigare nel calendario
        const navigateCalendar = (direction) => {
          const date = new Date(selectedDate.value);
          
          if (direction === 'prev') {
            if (calendarView.value === 'month') {
              date.setMonth(date.getMonth() - 1);
            } else if (calendarView.value === 'week') {
              date.setDate(date.getDate() - 7);
            } else if (calendarView.value === 'day') {
              date.setDate(date.getDate() - 1);
            } else if (calendarView.value === 'list') {
              date.setDate(date.getDate() - 30);
            }
          } else if (direction === 'next') {
            if (calendarView.value === 'month') {
              date.setMonth(date.getMonth() + 1);
            } else if (calendarView.value === 'week') {
              date.setDate(date.getDate() + 7);
            } else if (calendarView.value === 'day') {
              date.setDate(date.getDate() + 1);
            } else if (calendarView.value === 'list') {
              date.setDate(date.getDate() + 30);
            }
          } else if (direction === 'today') {
            const today = new Date();
            date.setTime(today.getTime());
          }
          
          selectedDate.value = date;
          updateSelectedDateEvents();
          initCalendar();
        };
        
        // Cambia la vista del calendario
        const changeCalendarView = (viewType) => {
          calendarView.value = viewType;
          initCalendar();
          updateSelectedDateEvents();
        };
        
        // Funzione per renderizzare gli eventi nelle viste
        const renderCalendarEvents = () => {
          if (calendarView.value === 'month') {
            renderMonthViewEvents();
          } else if (calendarView.value === 'week') {
            renderWeekViewEvents();
          } else if (calendarView.value === 'day') {
            renderDayViewEvents();
          }
          // La vista lista genera già gli eventi durante la creazione
        };

        // Renderizza eventi nella vista mensile
        const renderMonthViewEvents = () => {
          // Raggruppa gli eventi per data
          const eventsByDate = {};
          
          calendarEvents.value.forEach(event => {
            const date = new Date(event.start);
            const dateKey = date.toISOString().split('T')[0];
            
            if (!eventsByDate[dateKey]) {
              eventsByDate[dateKey] = [];
            }
            
            eventsByDate[dateKey].push(event);
          });
          
          // Aggiungi eventi alle celle dei giorni
          Object.keys(eventsByDate).forEach(dateKey => {
            const dayCell = calendarEl.value.querySelector(`.month-day-cell[data-date="${dateKey}"]`);
            if (!dayCell) return;
            
            const dayEvents = dayCell.querySelector('.day-events');
            if (!dayEvents) return;
            
            // Limita a massimo 3 eventi per cella
            const events = eventsByDate[dateKey];
            const visibleEvents = events.slice(0, 3);
            
            visibleEvents.forEach(event => {
              const eventEl = document.createElement('div');
              eventEl.className = `day-event event-status-${event.status}`;
              eventEl.textContent = event.title;
              
              // Click per modificare l'evento
              eventEl.addEventListener('click', (e) => {
                e.stopPropagation(); // Evita che il click sul giorno si attivi
                editAppointment(event);
              });
              
              dayEvents.appendChild(eventEl);
            });
            
            // Indicatore "più eventi"
            if (events.length > 3) {
              const moreIndicator = document.createElement('div');
              moreIndicator.className = 'day-more-events';
              moreIndicator.textContent = `+${events.length - 3}`;
              dayEvents.appendChild(moreIndicator);
            }
          });
        };
        
        // Renderizza eventi nella vista settimanale
        const renderWeekViewEvents = () => {
          calendarEvents.value.forEach(event => {
            const startDate = new Date(event.start);
            const dateKey = startDate.toISOString().split('T')[0];
            const hour = startDate.getHours();
            
            // Trova la cella corrispondente
            const timeSlot = calendarEl.value.querySelector(`.week-time-slot[data-date="${dateKey}"][data-hour="${hour}"]`);
            if (!timeSlot) return;
            
            // Calcola durata dell'evento
            const endTime = new Date(event.end);
            const durationHours = (endTime - startDate) / (1000 * 60 * 60);
            
            // Crea elemento dell'evento
            const eventEl = document.createElement('div');
            eventEl.className = `week-event event-status-${event.status}`;
            eventEl.style.position = 'absolute';
            eventEl.style.left = '2px';
            eventEl.style.right = '2px';
            eventEl.style.top = '2px';
            eventEl.style.height = `calc(${durationHours * 100}% - 4px)`;
            eventEl.style.backgroundColor = getEventColor(event.status);
            eventEl.style.borderRadius = '3px';
            eventEl.style.padding = '4px';
            eventEl.style.fontSize = '0.75rem';
            eventEl.style.overflow = 'hidden';
            eventEl.style.cursor = 'pointer';
            eventEl.style.zIndex = '10';
            
            // Formatta ora
            const formattedTime = formatTime(startDate);
            
            eventEl.innerHTML = `
              <div style="font-size: 0.7rem; opacity: 0.7;">${formattedTime}</div>
              <div style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${event.title}</div>
            `;
            
            // Click per modificare l'evento
            eventEl.addEventListener('click', () => {
              editAppointment(event);
            });
            
            timeSlot.style.position = 'relative';
            timeSlot.appendChild(eventEl);
          });
        };
        
        // Renderizza eventi nella vista giornaliera
        const renderDayViewEvents = () => {
          const dateKey = selectedDate.value.toISOString().split('T')[0];
          
          // Filtra eventi per il giorno selezionato
          const dayEvents = calendarEvents.value.filter(event => {
            const eventDate = new Date(event.start);
            return eventDate.toISOString().split('T')[0] === dateKey;
          });
          
          // Ordina per ora di inizio
          dayEvents.sort((a, b) => new Date(a.start) - new Date(b.start));
          
          // Renderizza ogni evento nella cella corrispondente
          dayEvents.forEach(event => {
            const startTime = new Date(event.start);
            const hour = startTime.getHours();
            
            // Trova lo slot corrispondente
            const eventSlot = calendarEl.value.querySelector(`.day-event-slot[data-hour="${hour}"]`);
            if (!eventSlot) return;
            
            // Calcola durata dell'evento
            const endTime = new Date(event.end);
            const durationHours = (endTime - startTime) / (1000 * 60 * 60);
            
            // Crea elemento dell'evento
            const eventEl = document.createElement('div');
            eventEl.className = `day-slot-event event-status-${event.status}`;
            eventEl.style.position = 'absolute';
            eventEl.style.left = '0';
            eventEl.style.right = '0';
            eventEl.style.top = '0';
            eventEl.style.height = `${durationHours * 100}%`;
            eventEl.style.backgroundColor = getEventColor(event.status);
            eventEl.style.borderRadius = '4px';
            eventEl.style.padding = '8px';
            eventEl.style.overflow = 'hidden';
            eventEl.style.cursor = 'pointer';
            eventEl.style.zIndex = '10';
            
            // Aggiungi attributo ID per riferimento
            eventEl.setAttribute('data-event-id', event.id);
            
            // Formatta ora
            const formattedStart = formatTime(startTime);
            const formattedEnd = formatTime(endTime);
            
            eventEl.innerHTML = `
              <div style="font-size: 0.8rem; opacity: 0.8;">${formattedStart} - ${formattedEnd}</div>
              <div style="font-weight: 600; margin: 4px 0;">${event.title}</div>
              <div style="font-size: 0.8rem; opacity: 0.7;">${event.description || ''}</div>
              <div class="event-resize-handle" style="position: absolute; bottom: 0; left: 0; right: 0; height: 5px; cursor: ns-resize;"></div>
            `;
            
            // Click per modificare l'evento
            eventEl.addEventListener('click', (e) => {
              // Non attivare su click sul handle di resize
              if (!e.target.closest('.event-resize-handle')) {
                editAppointment(event);
              }
            });
            
            // Aggiungi gestori touch e drag
            eventEl.setAttribute('draggable', 'true');
            eventEl.addEventListener('dragstart', (e) => handleEventDragStart(e, event));
            
            eventSlot.style.position = 'relative';
            eventSlot.appendChild(eventEl);
          });
        };
        
        // Funzione per tornare alla vista settimanale
        const backToWeekView = () => {
          if (calendarInstance.value) {
            calendarInstance.value.changeView('week', selectedDate.value);
          }
        };
        
        const dayHeaderClickHandler = (event) => {
          // Ottieni la data dal testo del giorno della settimana
          const headerText = event.currentTarget.getAttribute('data-date');
          if (headerText) {
            // Imposta la data selezionata
            selectedDate.value = new Date(headerText);
            updateSelectedDateEvents();
            
            // Passa alla vista giornaliera
            if (calendarInstance.value) {
              calendarInstance.value.changeView('timeGridDay', headerText);
            }
          }
        };

        const loadCalendarEvents = async () => {
          try {
            isLoading.value = true;
            // In una implementazione reale, caricare gli eventi dal server
            // Per esempio: const response = await axios.get('/api/appointments');
            
            // Usiamo dati di esempio
            const exampleEvents = [
              {
                id: '1',
                title: 'Consulenza Sig. Rossi',
                start: new Date(new Date().setHours(10, 0, 0, 0)),
                end: new Date(new Date().setHours(11, 0, 0, 0)),
                backgroundColor: '#FF6B00',
                borderColor: '#FF6B00',
                status: 'confirmed',
                description: 'Consulenza per ristrutturazione casa',
                clientId: '12345'
              },
              {
                id: '2',
                title: 'Sopralluogo Bianchi',
                start: new Date(new Date().setHours(14, 0, 0, 0)),
                end: new Date(new Date().setHours(16, 0, 0, 0)),
                backgroundColor: '#e67e22',
                borderColor: '#e67e22',
                status: 'pending',
                description: 'Sopralluogo per preventivo',
                clientId: '67890'
              },
              {
                id: '3',
                title: 'Meeting fornitori',
                start: new Date(new Date().setDate(new Date().getDate() + 1)).setHours(11, 0, 0, 0),
                end: new Date(new Date().setDate(new Date().getDate() + 1)).setHours(12, 30, 0, 0),
                backgroundColor: '#3498db',
                borderColor: '#3498db',
                status: 'confirmed',
                description: 'Incontro con fornitori materiali',
                clientId: ''
              }
            ];
            
            calendarEvents.value = exampleEvents;
            
            // Aggiorna eventi del giorno selezionato
            updateSelectedDateEvents();
            
            // Se il calendario è già inizializzato, aggiorna la vista
            if (calendarInstance.value) {
              renderCalendarEvents();
            } else {
              // Altrimenti inizializza il calendario
              initCalendar();
            }
            
          } catch (error) {
            showToast('Errore', `Impossibile caricare gli appuntamenti: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
            console.error('Errore caricamento appuntamenti:', error);
          } finally {
            isLoading.value = false;
          }
        };
        
        const loadClients = async () => {
          try {
            // In una implementazione reale, caricare i clienti dal server
            // Per esempio: const response = await axios.get('/api/clients');
            
            // Usiamo dati di esempio
            clients.value = [
              { _id: '12345', name: 'Mario Rossi', email: 'mario.rossi@example.com' },
              { _id: '67890', name: 'Giuseppe Bianchi', email: 'giuseppe.bianchi@example.com' },
              { _id: '24680', name: 'Anna Verdi', email: 'anna.verdi@example.com' }
            ];
          } catch (error) {
            console.error('Errore caricamento clienti:', error);
          }
        };
        
        // Funzione per aggiornare la lista degli eventi del giorno selezionato
        const updateSelectedDateEvents = () => {
          if (!selectedDate.value) return;
          
          const startDate = new Date(selectedDate.value);
          startDate.setHours(0, 0, 0, 0);
          
          const endDate = new Date(selectedDate.value);
          endDate.setHours(23, 59, 59, 999);
          
          selectedDateEvents.value = calendarEvents.value.filter(event => {
            const eventStart = new Date(event.start);
            return eventStart >= startDate && eventStart <= endDate;
          });
          
          // Ordina per ora di inizio
          selectedDateEvents.value.sort((a, b) => new Date(a.start) - new Date(b.start));
        };
        
        const formatEventTime = (event) => {
          const start = new Date(event.start);
          const end = new Date(event.end);
          return `${formatTime(start)} - ${formatTime(end)}`;
        };

        // Funzione per ottenere il colore in base allo stato
        const getEventColor = (status) => {
          switch (status) {
            case 'confirmed': return 'var(--primary-color)';
            case 'pending': return 'var(--warning-color)';
            case 'completed': return 'var(--success-color)';
            case 'cancelled': return 'var(--danger-color)';
            default: return 'var(--primary-color)';
          }
        };
        
        // Gestisce l'inizio del trascinamento di un evento
        const handleEventDragStart = (e, event) => {
          e.dataTransfer.setData('text/plain', JSON.stringify({
            eventId: event.id,
            originalDate: event.start
          }));
          
          e.target.classList.add('dragging');
        };

        const getEventsForHour = (hour) => {
          if (!selectedDate.value) return [];
          
          const startTime = new Date(selectedDate.value);
          startTime.setHours(hour, 0, 0, 0);
          
          const endTime = new Date(selectedDate.value);
          endTime.setHours(hour, 59, 59, 999);
          
          return calendarEvents.value.filter(event => {
            const eventStart = new Date(event.start);
            const eventEnd = new Date(event.end);
            
            // Evento che inizia in quest'ora, o copre quest'ora
            return (eventStart >= startTime && eventStart <= endTime) || 
                   (eventEnd >= startTime && eventEnd <= endTime) ||
                   (eventStart <= startTime && eventEnd >= endTime);
          });
        };
        
        const openNewAppointmentModal = () => {
          editingAppointment.value = false;
          
          // Inizializza con data e ora correnti
          const now = new Date();
          const dateStr = now.toISOString().split('T')[0];
          const hours = now.getHours().toString().padStart(2, '0');
          const minutes = Math.ceil(now.getMinutes() / 15) * 15;
          const timeStr = `${hours}:${minutes === 60 ? '00' : minutes.toString().padStart(2, '0')}`;
          
          currentAppointment.value = {
            title: '',
            date: dateStr,
            time: timeStr,
            duration: '60',
            status: 'pending',
            clientId: '',
            description: ''
          };
          
          const modal = new bootstrap.Modal(document.getElementById('appointmentModal'));
          modal.show();
        };
        
        const editAppointment = (event) => {
          editingAppointment.value = true;
          
          // Estrai le date
          const start = new Date(event.start);
          const dateStr = start.toISOString().split('T')[0];
          const hours = start.getHours().toString().padStart(2, '0');
          const minutes = start.getMinutes().toString().padStart(2, '0');
          const timeStr = `${hours}:${minutes}`;
          
          // Calcola durata
          const end = new Date(event.end);
          const durationMinutes = Math.round((end - start) / 60000); // millisecondi a minuti
          
          currentAppointment.value = {
            id: event.id,
            title: event.title,
            date: dateStr,
            time: timeStr,
            duration: durationMinutes.toString(),
            status: event.status || 'pending',
            clientId: event.clientId || '',
            description: event.description || ''
          };
          
          const modal = new bootstrap.Modal(document.getElementById('appointmentModal'));
          modal.show();
        };
        
        const saveAppointment = async () => {
          try {
            isSavingAppointment.value = true;
            
            const { title, date, time, duration, status, clientId, description } = currentAppointment.value;
            
            // Valida i campi richiesti
            if (!title || !date || !time) {
              showToast('Errore', 'Compila tutti i campi obbligatori', 'bg-warning', 'bi bi-exclamation-triangle-fill me-2');
              return;
            }
            
            // Crea oggetti Date per inizio e fine
            const start = new Date(`${date}T${time}`);
            const end = new Date(start.getTime() + parseInt(duration) * 60000);
            
            // Determina il colore in base allo stato
            let backgroundColor;
            switch (status) {
              case 'pending': backgroundColor = '#e67e22'; break;
              case 'confirmed': backgroundColor = '#FF6B00'; break;
              case 'completed': backgroundColor = '#27ae60'; break;
              case 'cancelled': backgroundColor = '#e74c3c'; break;
              default: backgroundColor = '#FF6B00';
            }
            
            const eventData = {
              title,
              start,
              end,
              backgroundColor,
              borderColor: backgroundColor,
              status,
              clientId,
              description
            };
            
            let response;
            
            if (editingAppointment.value && currentAppointment.value.id) {
              // Aggiorna evento esistente
              eventData.id = currentAppointment.value.id;
              
              // Invia al server
              response = await axios.put(
                `https://api.costruzionedigitale.com/api/appointments/${eventData.id}`, 
                eventData,
                { withCredentials: true }
              );
              
              // Aggiorna evento nel calendario
              const index = calendarEvents.value.findIndex(e => e.id === eventData.id);
              if (index !== -1) {
                calendarEvents.value[index] = {...calendarEvents.value[index], ...eventData};
              }
              
              showToast('Successo', 'Appuntamento aggiornato', 'bg-success', 'bi bi-check-circle-fill me-2');
            } else {
              // Nuovo evento
              // Invia al server
              response = await axios.post(
                'https://api.costruzionedigitale.com/api/appointments', 
                eventData,
                { withCredentials: true }
              );
              
              // Usa l'ID restituito dal server
              eventData.id = response.data.data.id || Date.now().toString();
              
              // Aggiungi all'array locale
              calendarEvents.value.push(eventData);
              
              showToast('Successo', 'Appuntamento creato', 'bg-success', 'bi bi-check-circle-fill me-2');
            }
            
            // Aggiorna eventi del giorno selezionato
            updateSelectedDateEvents();
            
            // Aggiorna la vista del calendario
            if (calendarInstance.value) {
              // Rimuovi tutti gli eventi dalle celle
              document.querySelectorAll('.calendar-day-event').forEach(el => el.remove());
              
              // Ricrea la vista
              calendarInstance.value.updateView();
            }
            
            // Chiudi modale
            const modal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
            if (modal) modal.hide();
            
          } catch (error) {
            showToast('Errore', `Impossibile salvare l'appuntamento: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
            console.error('Errore salvataggio appuntamento:', error);
          } finally {
            isSavingAppointment.value = false;
          }
        };
        
        const deleteAppointment = async (event) => {
          if (!confirm('Sei sicuro di voler eliminare questo appuntamento?')) return;
          
          try {
            isLoading.value = true;
            
            // Invia al server
            await axios.delete(
              `https://api.costruzionedigitale.com/api/appointments/${event.id}`,
              { withCredentials: true }
            );
            
            // Rimuovi dall'array locale
            const index = calendarEvents.value.findIndex(e => e.id === event.id);
            if (index !== -1) {
              calendarEvents.value.splice(index, 1);
            }
            
            // Aggiorna eventi del giorno selezionato
            updateSelectedDateEvents();
            
            // Aggiorna la vista del calendario
            if (calendarInstance.value) {
              // Rimuovi tutti gli eventi dalle celle
              document.querySelectorAll('.calendar-day-event').forEach(el => el.remove());
              
              // Ricrea la vista
              calendarInstance.value.updateView();
            }
            
            showToast('Successo', 'Appuntamento eliminato', 'bg-success', 'bi bi-check-circle-fill me-2');
          } catch (error) {
            showToast('Errore', `Impossibile eliminare l'appuntamento: ${error.message}`, 'bg-danger', 'bi bi-exclamation-triangle-fill me-2');
            console.error('Errore eliminazione appuntamento:', error);
          } finally {
            isLoading.value = false;
          }
        };
        
        // Gestisce il rilascio di un evento su uno slot
        const handleEventDrop = (e, date, hour) => {
          e.preventDefault();
          
          try {
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const { eventId, originalDate } = data;
            
            // Trova l'evento
            const eventIndex = calendarEvents.value.findIndex(event => event.id === eventId);
            if (eventIndex === -1) return;
            
            const event = calendarEvents.value[eventIndex];
            
            // Calcola nuove date
            const original = new Date(originalDate);
            const newDate = new Date(date);
            newDate.setHours(hour, 0, 0, 0);
            
            // Calcola differenza di tempo
            const timeDiff = newDate.getTime() - original.getTime();
            
            // Aggiorna date di inizio e fine
            const newStart = new Date(event.start);
            newStart.setTime(newStart.getTime() + timeDiff);
            
            const newEnd = new Date(event.end);
            newEnd.setTime(newEnd.getTime() + timeDiff);
            
            // Aggiorna evento
            handleEventDrop(eventId, newStart, newEnd);
            
            // Rimuovi classe di trascinamento
            document.querySelectorAll('.dragging').forEach(el => el.classList.remove('dragging'));
            
          } catch (error) {
            console.error('Errore nel drop dell\'evento:', error);
          }
        };

        
        const updateCalendarView = () => {
          if (!calendarInstance.value) return;
          
          // Cambia vista solo se necessario
          if (window.innerWidth < 768 && calendarInstance.value.view.type !== 'listWeek') {
            calendarInstance.value.changeView('listWeek');
            calendarEl.value.classList.add('calendar-mobile');
          } else if (window.innerWidth >= 768 && calendarInstance.value.view.type !== 'dayGridMonth') {
            calendarInstance.value.changeView('dayGridMonth');
            calendarEl.value.classList.remove('calendar-mobile');
          }
        };
        
        // Aggiungi questa sezione per reagire al cambio della data selezionata
        watch(selectedDate, () => {
          updateSelectedDateEvents();
        });

        // Debounce per la ricerca
        let searchTimeout;
        const debounceSearch = () => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            if (activeTab.value === 'forms') {
              formsPagination.value.page = 1;
              loadForms();
            } else if (activeTab.value === 'bookings') {
              bookingsPagination.value.page = 1;
              loadBookings();
            } else if (activeTab.value === 'events') {
              eventsPagination.value.page = 1;
              loadEvents();
            } else if (activeTab.value === 'facebookLeads') {
              facebookLeadsPagination.value.page = 1;
              loadFacebookLeads();
            }
          }, 500);
        };
        
        // Watch per cambiamenti di tab
        watch(activeTab, (newTab) => {
          searchQuery.value = '';
          
          if (newTab === 'forms') {
            loadForms();
          } else if (newTab === 'bookings') {
            loadBookings();
          } else if (newTab === 'events') {
            loadEvents();
          } else if (newTab === 'settings') {
            loadSettings();
          } else if (newTab === 'dashboard') {
            loadForms();
            loadBookings();
            loadEvents();
            loadRecentEvents();
          } else if (newTab === 'facebookLeads') {
            loadFacebookLeads();
          } else if (newTab === 'calendar') {
            // Carica clienti solo se non sono stati caricati
            if (clients.value.length === 0) {
              loadClients();
            }
            
            // Carica eventi e inizializza calendario
            loadCalendarEvents();
            
            // Imposta timer per rendere il calendario dopo che il DOM è aggiornato
            setTimeout(() => {
              initCalendar();
            }, 100);
          } else if (newTab === 'salesFunnel') {
            showLoading.value = true;
            loadForms();
            loadBookings();
            loadFacebookLeads();
            setTimeout(() => {
              loadFunnelData();
            }, 500);
          }
        });
        
        // Al montaggio dell'app
        onMounted(() => {
          window.addEventListener('resize', handleResize);
          handleResize();
          
          // Carica i dati iniziali
          loadForms();
          loadBookings();
          loadEvents();
          loadRecentEvents();
          loadSettings();

          // Aggiungi questa variabile all'inizio della tua sezione setup
          const lastWidth = ref(window.innerWidth);
          
          // Sostituisci gli event listener resize con questo
          window.addEventListener('resize', () => {
            // Verifica se la larghezza è cambiata, ignorando i cambiamenti di altezza
            if (lastWidth.value !== window.innerWidth) {
              lastWidth.value = window.innerWidth;
              handleResize();
              
              if (activeTab.value === 'calendar' && calendarInstance.value) {
                updateCalendarView();
              }
            }
          });
          
          // Inizializza popovers
          const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
          popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
          });
        });

        return {
          // Stato
          activeTab,
          sidebarVisible,
          searchQuery,
          isLoading,
          isUpdating,
          isRetrying,
          selectTab,
          passwordVisible,
          windowSize,
          showLoading,

          // Funnel di vendita
          funnelData,
          funnelStats,
          currentFunnelLead,
          newLeadValue,
          newLeadService,
          leadServiceOptions,
          formatMoney,
          loadFunnelData,
          onDragStart,
          onDragOver,
          onDragLeave,
          onDragEnd,
          onDrop,
          editLeadValue,
          saveLeadValue,
                    
          // Dati
          forms,
          formsPagination,
          formsFilter,
          bookings,
          bookingsPagination,
          bookingsFilter,
          events,
          eventsPagination,
          eventsFilter,
          recentEvents,
          stats,
          
          // Modali
          currentLead,
          currentLeadType,
          newStatus,
          eventName,
          eventNote,
          hasFbclid,
          fbclid,
          currentEvent,
          
          // Impostazioni
          settings,
          
          // Toast
          toastTitle,
          toastMessage,
          toastClass,
          toastIconClass,
        
          facebookLeads,
          facebookLeadsPagination, 
          facebookLeadsFilter,
          loadFacebookLeads,
          filterFacebookLeadsByStatus,
          viewLeadDetails,
          
          // Funzioni
          touchState,
          formatDate,
          formatDateTime,
          getStatusBadgeClass,
          getStatusLabel,
          getPageNumbers,
          prettyPrintJson,
          loadForms,
          loadBookings,
          loadEvents,
          loadRecentEvents,
          updateStats,
          loadSettings,
          saveSettings,
          filterFormsByStatus,
          filterBookingsByStatus,
          filterEventsBySuccess,
          changePage,
          openLeadModal,
          updateLeadStatus,
          viewEvents,
          openEventDetailsModal,
          retryEvent,
          toggleSidebar,
          togglePasswordVisibility,
          showToast,
          debounceSearch,
          logout,
          closeSidebar,
          isMobile,
          
          // Calendario (aggiungi queste righe)
          calendarEl,
          calendarInstance,
          calendarEvents,
          selectedDate,
          selectedDateEvents,
          currentAppointment,
          editingAppointment,
          isSavingAppointment,
          clients,
          dailyHours,
          loadCalendarEvents,
          loadClients,
          updateSelectedDateEvents,
          formatEventTime,
          getEventsForHour,
          openNewAppointmentModal,
          editAppointment,
          saveAppointment,
          deleteAppointment,
          handleEventDrop,
          updateCalendarView,
          backToWeekView,

          // Nuove proprietà computate
          monthCells,
          weekDays,
          groupedEvents,
          
          // Nuove funzioni helper
          calculateMonthCells,
          calculateWeekDays,
          groupEventsByDate,
          getEventsForDayAndHour,
          calculateEventHeight,
          formatDateHeader,
          formatDateForAttribute,
          selectDateAndView,

          calendarView,
          initCalendar,
          changeCalendarView,
          createMonthView,
          createWeekView,
          createDayView,
          createListView,
          renderCalendarEvents,
          renderMonthViewEvents,
          renderWeekViewEvents,
          renderDayViewEvents,
          navigateCalendar,
          formatMonthTitle,
          formatSelectedDate,
          formatTime,
          getEventColor,
          handleEventDragStart,
          handleEventDrop,
          updateSelectedDateEvents,
          formatEventTime,
          getEventsForHour,

          // Nuove proprietà computate
          monthCells,
          weekDays,
          groupedEvents,
          
          // Nuove funzioni helper
          calculateMonthCells,
          calculateWeekDays,
          groupEventsByDate,
          getEventsForDayAndHour,
          calculateEventHeight,
          formatDateHeader,
          formatDateForAttribute,
          selectDateAndView
        };
      }
    });
    
    // Monta l'app
    app.mount('#app');
  </script>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script per effetti aggiuntivi e miglioramenti UX -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Aggiungi classe fade-in ad elementi con animazione
      const animateElements = document.querySelectorAll('.card, .btn-group, .table');
      animateElements.forEach(element => {
        if (!element.classList.contains('fade-in')) {
          element.classList.add('fade-in');
        }
      });
      
      // Effetto hover per le card
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px)';
          this.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.3)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = '';
          this.style.boxShadow = '';
        });
      });
      
      // Effetto per le righe delle tabelle
      const tableRows = document.querySelectorAll('tbody tr');
      tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
          this.style.backgroundColor = 'rgba(255, 107, 0, 0.05)';
        });
        
        row.addEventListener('mouseleave', function() {
          this.style.backgroundColor = '';
        });
      });
      
      // Esegui al caricamento e al resize
      checkAndFixOverflow();
      window.addEventListener('resize', checkAndFixOverflow);
      
      // Supporto per tema dark
      function setThemeColors() {
        // Il tema è già dark per default, ma qui puoi aggiungere logica per temi alternativi
        document.documentElement.setAttribute('data-theme', 'dark');
      }
      
      setThemeColors();
    });
  </script>
</body>
</html>